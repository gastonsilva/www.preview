import{f as le,a as ie,c as be,d as Ne}from"../chunks/nF3buy4g.js";import{i as lt}from"../chunks/cv0wPrLS.js";import{Q as Qe,h as Ce,H as ei,a as ot,O as ti,j as ii,v as F,aD as ri,ax as si,a7 as ni,ag as pt,a1 as et,e as Ke,$ as oi,av as ai,ae as vt,c as hi,b as at,s as li,aL as Et,at as xt,aM as ci,aN as kt,aO as Lt,W as di,a3 as gt,aP as ui,r as Dt,p as fi,aQ as tt,a6 as _i,aR as pi,a0 as vi,aS as gi,aT as mi,as as Si,d as wi,aU as Me,aV as We,X as se,R as Z,aE as Le,z as ge,C as me,D as X,G as ee,F as G,B as _e,af as He,u as ht,A as ye,Z as De,aW as Rt,aX as Ci}from"../chunks/DqV1RPTs.js";import{s as ct,a as fe}from"../chunks/bMfgoBal.js";import{_ as bi,b as yi,i as de,p as At,c as Ei}from"../chunks/B-WuPcJC.js";import{o as $e,a as xi}from"../chunks/DxI8HWOi.js";import{b as Mt}from"../chunks/CmByV_s3.js";import{s as he,d as Ve,e as Bt}from"../chunks/BAvSmmpa.js";function dt(k,S){return S}function ki(k,S,C){for(var y=[],E=S.length,D=0;D<E;D++)gi(S[D].e,y,!0);mi(y,()=>{var b=y.length===0&&C!==null;if(b){var i=C,n=i.parentNode;Si(n),n.append(i),k.items.clear(),we(k,S[0].prev,S[E-1].next)}for(var a=0;a<E;a++){var l=S[a];b||(k.items.delete(l.k),we(k,l.prev,l.next)),wi(l.e,!b)}k.first===S[0]&&(k.first=S[0].prev)})}function Ue(k,S,C,y,E,D=null){var b=k,i=new Map,n=null,a=(S&Et)!==0,l=(S&kt)!==0,o=(S&Lt)!==0;if(a){var c=k;b=Ce?Qe(ei(c)):c.appendChild(ot())}Ce&&ti();var f=null,v=ri(()=>{var h=C();return ci(h)?h:h==null?[]:xt(h)}),d,t=!0;function s(){Li(r,d,b,S,y),f!==null&&(d.length===0?(f.fragment?(b.before(f.fragment),f.fragment=null):Dt(f.effect),e.first=f.effect):fi(f.effect,()=>{f=null}))}var e=ii(()=>{d=F(v);var h=d.length;let _=!1;if(Ce){var p=si(b)===ni;p!==(h===0)&&(b=pt(),Qe(b),et(!1),_=!0)}for(var g=new Set,u=hi,m=null,B=li(),A=0;A<h;A+=1){Ce&&Ke.nodeType===oi&&Ke.data===ai&&(b=Ke,_=!0,et(!1));var O=d[A],L=y(O,A),T=t?null:i.get(L);T?(l&&vt(T.v,O),o?vt(T.i,A):T.i=A,B&&u.skipped_effects.delete(T.e)):(T=Di(t?b:null,m,O,L,A,E,S,C),t&&(T.o=!0,m===null?n=T:m.next=T,m=T),i.set(L,T)),g.add(L)}if(h===0&&D&&!f)if(t)f={fragment:null,effect:at(()=>D(b))};else{var H=document.createDocumentFragment(),$=ot();H.append($),f={fragment:H,effect:at(()=>D($))}}if(Ce&&h>0&&Qe(pt()),!t)if(B){for(const[j,U]of i)g.has(j)||u.skipped_effects.add(U.e);u.oncommit(s),u.ondiscard(()=>{})}else s();_&&et(!0),F(v)}),r={effect:e,items:i,first:n};t=!1,Ce&&(b=Ke)}function Li(k,S,C,y,E){var D=(y&pi)!==0,b=S.length,i=k.items,n=k.first,a,l=null,o,c=[],f=[],v,d,t,s;if(D)for(s=0;s<b;s+=1)v=S[s],d=E(v,s),t=i.get(d),t.a?.measure(),(o??=new Set).add(t);for(s=0;s<b;s+=1){if(v=S[s],d=E(v,s),t=i.get(d),k.first??=t,!t.o){t.o=!0;var e=l?l.next:n;we(k,l,t),we(k,t,e),it(t,e,C),l=t,c=[],f=[],n=l.next;continue}if((t.e.f&tt)!==0&&(Dt(t.e),D&&(t.a?.unfix(),(o??=new Set).delete(t))),t!==n){if(a!==void 0&&a.has(t)){if(c.length<f.length){var r=f[0],h;l=r.prev;var _=c[0],p=c[c.length-1];for(h=0;h<c.length;h+=1)it(c[h],r,C);for(h=0;h<f.length;h+=1)a.delete(f[h]);we(k,_.prev,p.next),we(k,l,_),we(k,p,r),n=r,l=p,s-=1,c=[],f=[]}else a.delete(t),it(t,n,C),we(k,t.prev,t.next),we(k,t,l===null?k.first:l.next),we(k,l,t),l=t;continue}for(c=[],f=[];n!==null&&n.k!==d;)(n.e.f&tt)===0&&(a??=new Set).add(n),f.push(n),n=n.next;if(n===null)continue;t=n}c.push(t),l=t,n=t.next}if(n!==null||a!==void 0){for(var g=a===void 0?[]:xt(a);n!==null;)(n.e.f&tt)===0&&g.push(n),n=n.next;var u=g.length;if(u>0){var m=(y&Et)!==0&&b===0?C:null;if(D){for(s=0;s<u;s+=1)g[s].a?.measure();for(s=0;s<u;s+=1)g[s].a?.fix()}ki(k,g,m)}}D&&_i(()=>{if(o!==void 0)for(t of o)t.a?.apply()})}function Di(k,S,C,y,E,D,b,i){var n=(b&kt)!==0,a=(b&ui)===0,l=n?a?di(C,!1,!1):gt(C):C,o=(b&Lt)===0?E:gt(E),c={i:o,v:l,k:y,a:null,e:null,o:!1,prev:S,next:null};try{if(k===null){var f=document.createDocumentFragment();f.append(k=ot())}return c.e=at(()=>D(k,l,o,i)),S!==null&&(S.next=c),c}finally{}}function it(k,S,C){for(var y=k.next?k.next.e.nodes_start:C,E=S?S.e.nodes_start:C,D=k.e.nodes_start;D!==null&&D!==y;){var b=vi(D);E.before(D),D=b}}function we(k,S,C){S===null?(k.first=C,k.effect.first=C&&C.e):(S.e.next&&(S.e.next.prev=null),S.next=C,S.e.next=C&&C.e),C===null?k.effect.last=S&&S.e:(C.e.prev&&(C.e.prev.next=null),C.prev=S,C.e.prev=S&&S.e)}function Tt(k){var S,C,y="";if(typeof k=="string"||typeof k=="number")y+=k;else if(typeof k=="object")if(Array.isArray(k)){var E=k.length;for(S=0;S<E;S++)k[S]&&(C=Tt(k[S]))&&(y&&(y+=" "),y+=C)}else for(C in k)k[C]&&(y&&(y+=" "),y+=C);return y}function Ri(){for(var k,S,C=0,y="",E=arguments.length;C<E;C++)(k=arguments[C])&&(S=Tt(k))&&(y&&(y+=" "),y+=S);return y}function Ai(k){return typeof k=="object"?Ri(k):k??""}const mt=[...` 	
\r\f \v\uFEFF`];function Mi(k,S,C){var y=k==null?"":""+k;if(S&&(y=y?y+" "+S:S),C){for(var E in C)if(C[E])y=y?y+" "+E:E;else if(y.length)for(var D=E.length,b=0;(b=y.indexOf(E,b))>=0;){var i=b+D;(b===0||mt.includes(y[b-1]))&&(i===y.length||mt.includes(y[i]))?y=(b===0?"":y.substring(0,b))+y.substring(i+1):b=i}}return y===""?null:y}function Bi(k,S){return k==null?null:String(k)}function Fe(k,S,C,y,E,D){var b=k.__className;if(Ce||b!==C||b===void 0){var i=Mi(C,y,D);(!Ce||i!==k.getAttribute("class"))&&(i==null?k.removeAttribute("class"):S?k.className=i:k.setAttribute("class",i)),k.__className=C}else if(D&&E!==D)for(var n in D){var a=!!D[n];(E==null||a!==!!E[n])&&k.classList.toggle(n,a)}return D}function ut(k,S,C,y){var E=k.__style;if(Ce||E!==S){var D=Bi(S);(!Ce||D!==k.getAttribute("style"))&&(D==null?k.removeAttribute("style"):k.style.cssText=D),k.__style=S}return y}const Ot={viewBox:"0 0 24 24",paths:[{element:"rect",x:"2",y:"4",width:"20",height:"16",rx:"2",strokeWidth:"2"},{d:"M8 9l3 3-3 3m5 0h3",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2"}]},It={viewBox:"0 0 24 24",paths:[{d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2"}]},Ti={viewBox:"0 0 24 24",paths:[{d:"M4 6h16M4 12h16M4 18h16",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2"}]},Oi={viewBox:"0 0 24 24",paths:[{d:"M13 10V3L4 14h7v7l9-11h-7z",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2"}]};var rt={exports:{}},St;function Ii(){return St||(St=1,(function(k,S){(function(C,y){k.exports=y()})(globalThis,(()=>(()=>{var C={4567:function(b,i,n){var a=this&&this.__decorate||function(e,r,h,_){var p,g=arguments.length,u=g<3?r:_===null?_=Object.getOwnPropertyDescriptor(r,h):_;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(e,r,h,_);else for(var m=e.length-1;m>=0;m--)(p=e[m])&&(u=(g<3?p(u):g>3?p(r,h,u):p(r,h))||u);return g>3&&u&&Object.defineProperty(r,h,u),u},l=this&&this.__param||function(e,r){return function(h,_){r(h,_,e)}};Object.defineProperty(i,"__esModule",{value:!0}),i.AccessibilityManager=void 0;const o=n(9042),c=n(9924),f=n(844),v=n(4725),d=n(2585),t=n(3656);let s=i.AccessibilityManager=class extends f.Disposable{constructor(e,r,h,_){super(),this._terminal=e,this._coreBrowserService=h,this._renderService=_,this._rowColumns=new WeakMap,this._liveRegionLineCount=0,this._charsToConsume=[],this._charsToAnnounce="",this._accessibilityContainer=this._coreBrowserService.mainDocument.createElement("div"),this._accessibilityContainer.classList.add("xterm-accessibility"),this._rowContainer=this._coreBrowserService.mainDocument.createElement("div"),this._rowContainer.setAttribute("role","list"),this._rowContainer.classList.add("xterm-accessibility-tree"),this._rowElements=[];for(let p=0;p<this._terminal.rows;p++)this._rowElements[p]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[p]);if(this._topBoundaryFocusListener=p=>this._handleBoundaryFocus(p,0),this._bottomBoundaryFocusListener=p=>this._handleBoundaryFocus(p,1),this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions(),this._accessibilityContainer.appendChild(this._rowContainer),this._liveRegion=this._coreBrowserService.mainDocument.createElement("div"),this._liveRegion.classList.add("live-region"),this._liveRegion.setAttribute("aria-live","assertive"),this._accessibilityContainer.appendChild(this._liveRegion),this._liveRegionDebouncer=this.register(new c.TimeBasedDebouncer(this._renderRows.bind(this))),!this._terminal.element)throw new Error("Cannot enable accessibility before Terminal.open");this._terminal.element.insertAdjacentElement("afterbegin",this._accessibilityContainer),this.register(this._terminal.onResize((p=>this._handleResize(p.rows)))),this.register(this._terminal.onRender((p=>this._refreshRows(p.start,p.end)))),this.register(this._terminal.onScroll((()=>this._refreshRows()))),this.register(this._terminal.onA11yChar((p=>this._handleChar(p)))),this.register(this._terminal.onLineFeed((()=>this._handleChar(`
`)))),this.register(this._terminal.onA11yTab((p=>this._handleTab(p)))),this.register(this._terminal.onKey((p=>this._handleKey(p.key)))),this.register(this._terminal.onBlur((()=>this._clearLiveRegion()))),this.register(this._renderService.onDimensionsChange((()=>this._refreshRowsDimensions()))),this.register((0,t.addDisposableDomListener)(document,"selectionchange",(()=>this._handleSelectionChange()))),this.register(this._coreBrowserService.onDprChange((()=>this._refreshRowsDimensions()))),this._refreshRows(),this.register((0,f.toDisposable)((()=>{this._accessibilityContainer.remove(),this._rowElements.length=0})))}_handleTab(e){for(let r=0;r<e;r++)this._handleChar(" ")}_handleChar(e){this._liveRegionLineCount<21&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==e&&(this._charsToAnnounce+=e):this._charsToAnnounce+=e,e===`
`&&(this._liveRegionLineCount++,this._liveRegionLineCount===21&&(this._liveRegion.textContent+=o.tooMuchOutput)))}_clearLiveRegion(){this._liveRegion.textContent="",this._liveRegionLineCount=0}_handleKey(e){this._clearLiveRegion(),new RegExp("\\p{Control}","u").test(e)||this._charsToConsume.push(e)}_refreshRows(e,r){this._liveRegionDebouncer.refresh(e,r,this._terminal.rows)}_renderRows(e,r){const h=this._terminal.buffer,_=h.lines.length.toString();for(let p=e;p<=r;p++){const g=h.lines.get(h.ydisp+p),u=[],m=g?.translateToString(!0,void 0,void 0,u)||"",B=(h.ydisp+p+1).toString(),A=this._rowElements[p];A&&(m.length===0?(A.innerText=" ",this._rowColumns.set(A,[0,1])):(A.textContent=m,this._rowColumns.set(A,u)),A.setAttribute("aria-posinset",B),A.setAttribute("aria-setsize",_))}this._announceCharacters()}_announceCharacters(){this._charsToAnnounce.length!==0&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}_handleBoundaryFocus(e,r){const h=e.target,_=this._rowElements[r===0?1:this._rowElements.length-2];if(h.getAttribute("aria-posinset")===(r===0?"1":`${this._terminal.buffer.lines.length}`)||e.relatedTarget!==_)return;let p,g;if(r===0?(p=h,g=this._rowElements.pop(),this._rowContainer.removeChild(g)):(p=this._rowElements.shift(),g=h,this._rowContainer.removeChild(p)),p.removeEventListener("focus",this._topBoundaryFocusListener),g.removeEventListener("focus",this._bottomBoundaryFocusListener),r===0){const u=this._createAccessibilityTreeNode();this._rowElements.unshift(u),this._rowContainer.insertAdjacentElement("afterbegin",u)}else{const u=this._createAccessibilityTreeNode();this._rowElements.push(u),this._rowContainer.appendChild(u)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(r===0?-1:1),this._rowElements[r===0?1:this._rowElements.length-2].focus(),e.preventDefault(),e.stopImmediatePropagation()}_handleSelectionChange(){if(this._rowElements.length===0)return;const e=document.getSelection();if(!e)return;if(e.isCollapsed)return void(this._rowContainer.contains(e.anchorNode)&&this._terminal.clearSelection());if(!e.anchorNode||!e.focusNode)return void console.error("anchorNode and/or focusNode are null");let r={node:e.anchorNode,offset:e.anchorOffset},h={node:e.focusNode,offset:e.focusOffset};if((r.node.compareDocumentPosition(h.node)&Node.DOCUMENT_POSITION_PRECEDING||r.node===h.node&&r.offset>h.offset)&&([r,h]=[h,r]),r.node.compareDocumentPosition(this._rowElements[0])&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_FOLLOWING)&&(r={node:this._rowElements[0].childNodes[0],offset:0}),!this._rowContainer.contains(r.node))return;const _=this._rowElements.slice(-1)[0];if(h.node.compareDocumentPosition(_)&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_PRECEDING)&&(h={node:_,offset:_.textContent?.length??0}),!this._rowContainer.contains(h.node))return;const p=({node:m,offset:B})=>{const A=m instanceof Text?m.parentNode:m;let O=parseInt(A?.getAttribute("aria-posinset"),10)-1;if(isNaN(O))return console.warn("row is invalid. Race condition?"),null;const L=this._rowColumns.get(A);if(!L)return console.warn("columns is null. Race condition?"),null;let T=B<L.length?L[B]:L.slice(-1)[0]+1;return T>=this._terminal.cols&&(++O,T=0),{row:O,column:T}},g=p(r),u=p(h);if(g&&u){if(g.row>u.row||g.row===u.row&&g.column>=u.column)throw new Error("invalid range");this._terminal.select(g.column,g.row,(u.row-g.row)*this._terminal.cols-g.column+u.column)}}_handleResize(e){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(let r=this._rowContainer.children.length;r<this._terminal.rows;r++)this._rowElements[r]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[r]);for(;this._rowElements.length>e;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}_createAccessibilityTreeNode(){const e=this._coreBrowserService.mainDocument.createElement("div");return e.setAttribute("role","listitem"),e.tabIndex=-1,this._refreshRowDimensions(e),e}_refreshRowsDimensions(){if(this._renderService.dimensions.css.cell.height){this._accessibilityContainer.style.width=`${this._renderService.dimensions.css.canvas.width}px`,this._rowElements.length!==this._terminal.rows&&this._handleResize(this._terminal.rows);for(let e=0;e<this._terminal.rows;e++)this._refreshRowDimensions(this._rowElements[e])}}_refreshRowDimensions(e){e.style.height=`${this._renderService.dimensions.css.cell.height}px`}};i.AccessibilityManager=s=a([l(1,d.IInstantiationService),l(2,v.ICoreBrowserService),l(3,v.IRenderService)],s)},3614:(b,i)=>{function n(c){return c.replace(/\r?\n/g,"\r")}function a(c,f){return f?"\x1B[200~"+c+"\x1B[201~":c}function l(c,f,v,d){c=a(c=n(c),v.decPrivateModes.bracketedPasteMode&&d.rawOptions.ignoreBracketedPasteMode!==!0),v.triggerDataEvent(c,!0),f.value=""}function o(c,f,v){const d=v.getBoundingClientRect(),t=c.clientX-d.left-10,s=c.clientY-d.top-10;f.style.width="20px",f.style.height="20px",f.style.left=`${t}px`,f.style.top=`${s}px`,f.style.zIndex="1000",f.focus()}Object.defineProperty(i,"__esModule",{value:!0}),i.rightClickHandler=i.moveTextAreaUnderMouseCursor=i.paste=i.handlePasteEvent=i.copyHandler=i.bracketTextForPaste=i.prepareTextForTerminal=void 0,i.prepareTextForTerminal=n,i.bracketTextForPaste=a,i.copyHandler=function(c,f){c.clipboardData&&c.clipboardData.setData("text/plain",f.selectionText),c.preventDefault()},i.handlePasteEvent=function(c,f,v,d){c.stopPropagation(),c.clipboardData&&l(c.clipboardData.getData("text/plain"),f,v,d)},i.paste=l,i.moveTextAreaUnderMouseCursor=o,i.rightClickHandler=function(c,f,v,d,t){o(c,f,v),t&&d.rightClickSelect(c),f.value=d.selectionText,f.select()}},7239:(b,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.ColorContrastCache=void 0;const a=n(1505);i.ColorContrastCache=class{constructor(){this._color=new a.TwoKeyMap,this._css=new a.TwoKeyMap}setCss(l,o,c){this._css.set(l,o,c)}getCss(l,o){return this._css.get(l,o)}setColor(l,o,c){this._color.set(l,o,c)}getColor(l,o){return this._color.get(l,o)}clear(){this._color.clear(),this._css.clear()}}},3656:(b,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.addDisposableDomListener=void 0,i.addDisposableDomListener=function(n,a,l,o){n.addEventListener(a,l,o);let c=!1;return{dispose:()=>{c||(c=!0,n.removeEventListener(a,l,o))}}}},3551:function(b,i,n){var a=this&&this.__decorate||function(s,e,r,h){var _,p=arguments.length,g=p<3?e:h===null?h=Object.getOwnPropertyDescriptor(e,r):h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(s,e,r,h);else for(var u=s.length-1;u>=0;u--)(_=s[u])&&(g=(p<3?_(g):p>3?_(e,r,g):_(e,r))||g);return p>3&&g&&Object.defineProperty(e,r,g),g},l=this&&this.__param||function(s,e){return function(r,h){e(r,h,s)}};Object.defineProperty(i,"__esModule",{value:!0}),i.Linkifier=void 0;const o=n(3656),c=n(8460),f=n(844),v=n(2585),d=n(4725);let t=i.Linkifier=class extends f.Disposable{get currentLink(){return this._currentLink}constructor(s,e,r,h,_){super(),this._element=s,this._mouseService=e,this._renderService=r,this._bufferService=h,this._linkProviderService=_,this._linkCacheDisposables=[],this._isMouseOut=!0,this._wasResized=!1,this._activeLine=-1,this._onShowLinkUnderline=this.register(new c.EventEmitter),this.onShowLinkUnderline=this._onShowLinkUnderline.event,this._onHideLinkUnderline=this.register(new c.EventEmitter),this.onHideLinkUnderline=this._onHideLinkUnderline.event,this.register((0,f.getDisposeArrayDisposable)(this._linkCacheDisposables)),this.register((0,f.toDisposable)((()=>{this._lastMouseEvent=void 0,this._activeProviderReplies?.clear()}))),this.register(this._bufferService.onResize((()=>{this._clearCurrentLink(),this._wasResized=!0}))),this.register((0,o.addDisposableDomListener)(this._element,"mouseleave",(()=>{this._isMouseOut=!0,this._clearCurrentLink()}))),this.register((0,o.addDisposableDomListener)(this._element,"mousemove",this._handleMouseMove.bind(this))),this.register((0,o.addDisposableDomListener)(this._element,"mousedown",this._handleMouseDown.bind(this))),this.register((0,o.addDisposableDomListener)(this._element,"mouseup",this._handleMouseUp.bind(this)))}_handleMouseMove(s){this._lastMouseEvent=s;const e=this._positionFromMouseEvent(s,this._element,this._mouseService);if(!e)return;this._isMouseOut=!1;const r=s.composedPath();for(let h=0;h<r.length;h++){const _=r[h];if(_.classList.contains("xterm"))break;if(_.classList.contains("xterm-hover"))return}this._lastBufferCell&&e.x===this._lastBufferCell.x&&e.y===this._lastBufferCell.y||(this._handleHover(e),this._lastBufferCell=e)}_handleHover(s){if(this._activeLine!==s.y||this._wasResized)return this._clearCurrentLink(),this._askForLink(s,!1),void(this._wasResized=!1);this._currentLink&&this._linkAtPosition(this._currentLink.link,s)||(this._clearCurrentLink(),this._askForLink(s,!0))}_askForLink(s,e){this._activeProviderReplies&&e||(this._activeProviderReplies?.forEach((h=>{h?.forEach((_=>{_.link.dispose&&_.link.dispose()}))})),this._activeProviderReplies=new Map,this._activeLine=s.y);let r=!1;for(const[h,_]of this._linkProviderService.linkProviders.entries())e?this._activeProviderReplies?.get(h)&&(r=this._checkLinkProviderResult(h,s,r)):_.provideLinks(s.y,(p=>{if(this._isMouseOut)return;const g=p?.map((u=>({link:u})));this._activeProviderReplies?.set(h,g),r=this._checkLinkProviderResult(h,s,r),this._activeProviderReplies?.size===this._linkProviderService.linkProviders.length&&this._removeIntersectingLinks(s.y,this._activeProviderReplies)}))}_removeIntersectingLinks(s,e){const r=new Set;for(let h=0;h<e.size;h++){const _=e.get(h);if(_)for(let p=0;p<_.length;p++){const g=_[p],u=g.link.range.start.y<s?0:g.link.range.start.x,m=g.link.range.end.y>s?this._bufferService.cols:g.link.range.end.x;for(let B=u;B<=m;B++){if(r.has(B)){_.splice(p--,1);break}r.add(B)}}}}_checkLinkProviderResult(s,e,r){if(!this._activeProviderReplies)return r;const h=this._activeProviderReplies.get(s);let _=!1;for(let p=0;p<s;p++)this._activeProviderReplies.has(p)&&!this._activeProviderReplies.get(p)||(_=!0);if(!_&&h){const p=h.find((g=>this._linkAtPosition(g.link,e)));p&&(r=!0,this._handleNewLink(p))}if(this._activeProviderReplies.size===this._linkProviderService.linkProviders.length&&!r)for(let p=0;p<this._activeProviderReplies.size;p++){const g=this._activeProviderReplies.get(p)?.find((u=>this._linkAtPosition(u.link,e)));if(g){r=!0,this._handleNewLink(g);break}}return r}_handleMouseDown(){this._mouseDownLink=this._currentLink}_handleMouseUp(s){if(!this._currentLink)return;const e=this._positionFromMouseEvent(s,this._element,this._mouseService);e&&this._mouseDownLink===this._currentLink&&this._linkAtPosition(this._currentLink.link,e)&&this._currentLink.link.activate(s,this._currentLink.link.text)}_clearCurrentLink(s,e){this._currentLink&&this._lastMouseEvent&&(!s||!e||this._currentLink.link.range.start.y>=s&&this._currentLink.link.range.end.y<=e)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,(0,f.disposeArray)(this._linkCacheDisposables))}_handleNewLink(s){if(!this._lastMouseEvent)return;const e=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);e&&this._linkAtPosition(s.link,e)&&(this._currentLink=s,this._currentLink.state={decorations:{underline:s.link.decorations===void 0||s.link.decorations.underline,pointerCursor:s.link.decorations===void 0||s.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,s.link,this._lastMouseEvent),s.link.decorations={},Object.defineProperties(s.link.decorations,{pointerCursor:{get:()=>this._currentLink?.state?.decorations.pointerCursor,set:r=>{this._currentLink?.state&&this._currentLink.state.decorations.pointerCursor!==r&&(this._currentLink.state.decorations.pointerCursor=r,this._currentLink.state.isHovered&&this._element.classList.toggle("xterm-cursor-pointer",r))}},underline:{get:()=>this._currentLink?.state?.decorations.underline,set:r=>{this._currentLink?.state&&this._currentLink?.state?.decorations.underline!==r&&(this._currentLink.state.decorations.underline=r,this._currentLink.state.isHovered&&this._fireUnderlineEvent(s.link,r))}}}),this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange((r=>{if(!this._currentLink)return;const h=r.start===0?0:r.start+1+this._bufferService.buffer.ydisp,_=this._bufferService.buffer.ydisp+1+r.end;if(this._currentLink.link.range.start.y>=h&&this._currentLink.link.range.end.y<=_&&(this._clearCurrentLink(h,_),this._lastMouseEvent)){const p=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);p&&this._askForLink(p,!1)}}))))}_linkHover(s,e,r){this._currentLink?.state&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(e,!0),this._currentLink.state.decorations.pointerCursor&&s.classList.add("xterm-cursor-pointer")),e.hover&&e.hover(r,e.text)}_fireUnderlineEvent(s,e){const r=s.range,h=this._bufferService.buffer.ydisp,_=this._createLinkUnderlineEvent(r.start.x-1,r.start.y-h-1,r.end.x,r.end.y-h-1,void 0);(e?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(_)}_linkLeave(s,e,r){this._currentLink?.state&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(e,!1),this._currentLink.state.decorations.pointerCursor&&s.classList.remove("xterm-cursor-pointer")),e.leave&&e.leave(r,e.text)}_linkAtPosition(s,e){const r=s.range.start.y*this._bufferService.cols+s.range.start.x,h=s.range.end.y*this._bufferService.cols+s.range.end.x,_=e.y*this._bufferService.cols+e.x;return r<=_&&_<=h}_positionFromMouseEvent(s,e,r){const h=r.getCoords(s,e,this._bufferService.cols,this._bufferService.rows);if(h)return{x:h[0],y:h[1]+this._bufferService.buffer.ydisp}}_createLinkUnderlineEvent(s,e,r,h,_){return{x1:s,y1:e,x2:r,y2:h,cols:this._bufferService.cols,fg:_}}};i.Linkifier=t=a([l(1,d.IMouseService),l(2,d.IRenderService),l(3,v.IBufferService),l(4,d.ILinkProviderService)],t)},9042:(b,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.tooMuchOutput=i.promptLabel=void 0,i.promptLabel="Terminal input",i.tooMuchOutput="Too much output to announce, navigate to rows manually to read"},3730:function(b,i,n){var a=this&&this.__decorate||function(d,t,s,e){var r,h=arguments.length,_=h<3?t:e===null?e=Object.getOwnPropertyDescriptor(t,s):e;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(d,t,s,e);else for(var p=d.length-1;p>=0;p--)(r=d[p])&&(_=(h<3?r(_):h>3?r(t,s,_):r(t,s))||_);return h>3&&_&&Object.defineProperty(t,s,_),_},l=this&&this.__param||function(d,t){return function(s,e){t(s,e,d)}};Object.defineProperty(i,"__esModule",{value:!0}),i.OscLinkProvider=void 0;const o=n(511),c=n(2585);let f=i.OscLinkProvider=class{constructor(d,t,s){this._bufferService=d,this._optionsService=t,this._oscLinkService=s}provideLinks(d,t){const s=this._bufferService.buffer.lines.get(d-1);if(!s)return void t(void 0);const e=[],r=this._optionsService.rawOptions.linkHandler,h=new o.CellData,_=s.getTrimmedLength();let p=-1,g=-1,u=!1;for(let m=0;m<_;m++)if(g!==-1||s.hasContent(m)){if(s.loadCell(m,h),h.hasExtendedAttrs()&&h.extended.urlId){if(g===-1){g=m,p=h.extended.urlId;continue}u=h.extended.urlId!==p}else g!==-1&&(u=!0);if(u||g!==-1&&m===_-1){const B=this._oscLinkService.getLinkData(p)?.uri;if(B){const A={start:{x:g+1,y:d},end:{x:m+(u||m!==_-1?0:1),y:d}};let O=!1;if(!r?.allowNonHttpProtocols)try{const L=new URL(B);["http:","https:"].includes(L.protocol)||(O=!0)}catch{O=!0}O||e.push({text:B,range:A,activate:(L,T)=>r?r.activate(L,T,A):v(0,T),hover:(L,T)=>r?.hover?.(L,T,A),leave:(L,T)=>r?.leave?.(L,T,A)})}u=!1,h.hasExtendedAttrs()&&h.extended.urlId?(g=m,p=h.extended.urlId):(g=-1,p=-1)}}t(e)}};function v(d,t){if(confirm(`Do you want to navigate to ${t}?

WARNING: This link could potentially be dangerous`)){const s=window.open();if(s){try{s.opener=null}catch{}s.location.href=t}else console.warn("Opening link blocked as opener could not be cleared")}}i.OscLinkProvider=f=a([l(0,c.IBufferService),l(1,c.IOptionsService),l(2,c.IOscLinkService)],f)},6193:(b,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.RenderDebouncer=void 0,i.RenderDebouncer=class{constructor(n,a){this._renderCallback=n,this._coreBrowserService=a,this._refreshCallbacks=[]}dispose(){this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}addRefreshCallback(n){return this._refreshCallbacks.push(n),this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._innerRefresh()))),this._animationFrame}refresh(n,a,l){this._rowCount=l,n=n!==void 0?n:0,a=a!==void 0?a:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,n):n,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,a):a,this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._innerRefresh())))}_innerRefresh(){if(this._animationFrame=void 0,this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return void this._runRefreshCallbacks();const n=Math.max(this._rowStart,0),a=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(n,a),this._runRefreshCallbacks()}_runRefreshCallbacks(){for(const n of this._refreshCallbacks)n(0);this._refreshCallbacks=[]}}},3236:(b,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Terminal=void 0;const a=n(3614),l=n(3656),o=n(3551),c=n(9042),f=n(3730),v=n(1680),d=n(3107),t=n(5744),s=n(2950),e=n(1296),r=n(428),h=n(4269),_=n(5114),p=n(8934),g=n(3230),u=n(9312),m=n(4725),B=n(6731),A=n(8055),O=n(8969),L=n(8460),T=n(844),H=n(6114),$=n(8437),j=n(2584),U=n(7399),w=n(5941),M=n(9074),R=n(2585),I=n(5435),W=n(4567),K=n(779);class Y extends O.CoreTerminal{get onFocus(){return this._onFocus.event}get onBlur(){return this._onBlur.event}get onA11yChar(){return this._onA11yCharEmitter.event}get onA11yTab(){return this._onA11yTabEmitter.event}get onWillOpen(){return this._onWillOpen.event}constructor(P={}){super(P),this.browser=H,this._keyDownHandled=!1,this._keyDownSeen=!1,this._keyPressHandled=!1,this._unprocessedDeadKey=!1,this._accessibilityManager=this.register(new T.MutableDisposable),this._onCursorMove=this.register(new L.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onKey=this.register(new L.EventEmitter),this.onKey=this._onKey.event,this._onRender=this.register(new L.EventEmitter),this.onRender=this._onRender.event,this._onSelectionChange=this.register(new L.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onTitleChange=this.register(new L.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onBell=this.register(new L.EventEmitter),this.onBell=this._onBell.event,this._onFocus=this.register(new L.EventEmitter),this._onBlur=this.register(new L.EventEmitter),this._onA11yCharEmitter=this.register(new L.EventEmitter),this._onA11yTabEmitter=this.register(new L.EventEmitter),this._onWillOpen=this.register(new L.EventEmitter),this._setup(),this._decorationService=this._instantiationService.createInstance(M.DecorationService),this._instantiationService.setService(R.IDecorationService,this._decorationService),this._linkProviderService=this._instantiationService.createInstance(K.LinkProviderService),this._instantiationService.setService(m.ILinkProviderService,this._linkProviderService),this._linkProviderService.registerLinkProvider(this._instantiationService.createInstance(f.OscLinkProvider)),this.register(this._inputHandler.onRequestBell((()=>this._onBell.fire()))),this.register(this._inputHandler.onRequestRefreshRows(((x,N)=>this.refresh(x,N)))),this.register(this._inputHandler.onRequestSendFocus((()=>this._reportFocus()))),this.register(this._inputHandler.onRequestReset((()=>this.reset()))),this.register(this._inputHandler.onRequestWindowsOptionsReport((x=>this._reportWindowsOptions(x)))),this.register(this._inputHandler.onColor((x=>this._handleColorEvent(x)))),this.register((0,L.forwardEvent)(this._inputHandler.onCursorMove,this._onCursorMove)),this.register((0,L.forwardEvent)(this._inputHandler.onTitleChange,this._onTitleChange)),this.register((0,L.forwardEvent)(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this.register((0,L.forwardEvent)(this._inputHandler.onA11yTab,this._onA11yTabEmitter)),this.register(this._bufferService.onResize((x=>this._afterResize(x.cols,x.rows)))),this.register((0,T.toDisposable)((()=>{this._customKeyEventHandler=void 0,this.element?.parentNode?.removeChild(this.element)})))}_handleColorEvent(P){if(this._themeService)for(const x of P){let N,z="";switch(x.index){case 256:N="foreground",z="10";break;case 257:N="background",z="11";break;case 258:N="cursor",z="12";break;default:N="ansi",z="4;"+x.index}switch(x.type){case 0:const V=A.color.toColorRGB(N==="ansi"?this._themeService.colors.ansi[x.index]:this._themeService.colors[N]);this.coreService.triggerDataEvent(`${j.C0.ESC}]${z};${(0,w.toRgbString)(V)}${j.C1_ESCAPED.ST}`);break;case 1:if(N==="ansi")this._themeService.modifyColors((q=>q.ansi[x.index]=A.channels.toColor(...x.color)));else{const q=N;this._themeService.modifyColors((te=>te[q]=A.channels.toColor(...x.color)))}break;case 2:this._themeService.restoreColor(x.index)}}}_setup(){super._setup(),this._customKeyEventHandler=void 0}get buffer(){return this.buffers.active}focus(){this.textarea&&this.textarea.focus({preventScroll:!0})}_handleScreenReaderModeOptionChange(P){P?!this._accessibilityManager.value&&this._renderService&&(this._accessibilityManager.value=this._instantiationService.createInstance(W.AccessibilityManager,this)):this._accessibilityManager.clear()}_handleTextAreaFocus(P){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(j.C0.ESC+"[I"),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}blur(){return this.textarea?.blur()}_handleTextAreaBlur(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(j.C0.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}_syncTextArea(){if(!this.textarea||!this.buffer.isCursorInViewport||this._compositionHelper.isComposing||!this._renderService)return;const P=this.buffer.ybase+this.buffer.y,x=this.buffer.lines.get(P);if(!x)return;const N=Math.min(this.buffer.x,this.cols-1),z=this._renderService.dimensions.css.cell.height,V=x.getWidth(N),q=this._renderService.dimensions.css.cell.width*V,te=this.buffer.y*this._renderService.dimensions.css.cell.height,ne=N*this._renderService.dimensions.css.cell.width;this.textarea.style.left=ne+"px",this.textarea.style.top=te+"px",this.textarea.style.width=q+"px",this.textarea.style.height=z+"px",this.textarea.style.lineHeight=z+"px",this.textarea.style.zIndex="-5"}_initGlobal(){this._bindKeys(),this.register((0,l.addDisposableDomListener)(this.element,"copy",(x=>{this.hasSelection()&&(0,a.copyHandler)(x,this._selectionService)})));const P=x=>(0,a.handlePasteEvent)(x,this.textarea,this.coreService,this.optionsService);this.register((0,l.addDisposableDomListener)(this.textarea,"paste",P)),this.register((0,l.addDisposableDomListener)(this.element,"paste",P)),H.isFirefox?this.register((0,l.addDisposableDomListener)(this.element,"mousedown",(x=>{x.button===2&&(0,a.rightClickHandler)(x,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)}))):this.register((0,l.addDisposableDomListener)(this.element,"contextmenu",(x=>{(0,a.rightClickHandler)(x,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)}))),H.isLinux&&this.register((0,l.addDisposableDomListener)(this.element,"auxclick",(x=>{x.button===1&&(0,a.moveTextAreaUnderMouseCursor)(x,this.textarea,this.screenElement)})))}_bindKeys(){this.register((0,l.addDisposableDomListener)(this.textarea,"keyup",(P=>this._keyUp(P)),!0)),this.register((0,l.addDisposableDomListener)(this.textarea,"keydown",(P=>this._keyDown(P)),!0)),this.register((0,l.addDisposableDomListener)(this.textarea,"keypress",(P=>this._keyPress(P)),!0)),this.register((0,l.addDisposableDomListener)(this.textarea,"compositionstart",(()=>this._compositionHelper.compositionstart()))),this.register((0,l.addDisposableDomListener)(this.textarea,"compositionupdate",(P=>this._compositionHelper.compositionupdate(P)))),this.register((0,l.addDisposableDomListener)(this.textarea,"compositionend",(()=>this._compositionHelper.compositionend()))),this.register((0,l.addDisposableDomListener)(this.textarea,"input",(P=>this._inputEvent(P)),!0)),this.register(this.onRender((()=>this._compositionHelper.updateCompositionElements())))}open(P){if(!P)throw new Error("Terminal requires a parent element.");if(P.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),this.element?.ownerDocument.defaultView&&this._coreBrowserService)return void(this.element.ownerDocument.defaultView!==this._coreBrowserService.window&&(this._coreBrowserService.window=this.element.ownerDocument.defaultView));this._document=P.ownerDocument,this.options.documentOverride&&this.options.documentOverride instanceof Document&&(this._document=this.optionsService.rawOptions.documentOverride),this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),P.appendChild(this.element);const x=this._document.createDocumentFragment();this._viewportElement=this._document.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),x.appendChild(this._viewportElement),this._viewportScrollArea=this._document.createElement("div"),this._viewportScrollArea.classList.add("xterm-scroll-area"),this._viewportElement.appendChild(this._viewportScrollArea),this.screenElement=this._document.createElement("div"),this.screenElement.classList.add("xterm-screen"),this.register((0,l.addDisposableDomListener)(this.screenElement,"mousemove",(N=>this.updateCursorStyle(N)))),this._helperContainer=this._document.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),x.appendChild(this.screenElement),this.textarea=this._document.createElement("textarea"),this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",c.promptLabel),H.isChromeOS||this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this._coreBrowserService=this.register(this._instantiationService.createInstance(_.CoreBrowserService,this.textarea,P.ownerDocument.defaultView??window,this._document??typeof window<"u"?window.document:null)),this._instantiationService.setService(m.ICoreBrowserService,this._coreBrowserService),this.register((0,l.addDisposableDomListener)(this.textarea,"focus",(N=>this._handleTextAreaFocus(N)))),this.register((0,l.addDisposableDomListener)(this.textarea,"blur",(()=>this._handleTextAreaBlur()))),this._helperContainer.appendChild(this.textarea),this._charSizeService=this._instantiationService.createInstance(r.CharSizeService,this._document,this._helperContainer),this._instantiationService.setService(m.ICharSizeService,this._charSizeService),this._themeService=this._instantiationService.createInstance(B.ThemeService),this._instantiationService.setService(m.IThemeService,this._themeService),this._characterJoinerService=this._instantiationService.createInstance(h.CharacterJoinerService),this._instantiationService.setService(m.ICharacterJoinerService,this._characterJoinerService),this._renderService=this.register(this._instantiationService.createInstance(g.RenderService,this.rows,this.screenElement)),this._instantiationService.setService(m.IRenderService,this._renderService),this.register(this._renderService.onRenderedViewportChange((N=>this._onRender.fire(N)))),this.onResize((N=>this._renderService.resize(N.cols,N.rows))),this._compositionView=this._document.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(s.CompositionHelper,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this._mouseService=this._instantiationService.createInstance(p.MouseService),this._instantiationService.setService(m.IMouseService,this._mouseService),this.linkifier=this.register(this._instantiationService.createInstance(o.Linkifier,this.screenElement)),this.element.appendChild(x);try{this._onWillOpen.fire(this.element)}catch{}this._renderService.hasRenderer()||this._renderService.setRenderer(this._createRenderer()),this.viewport=this._instantiationService.createInstance(v.Viewport,this._viewportElement,this._viewportScrollArea),this.viewport.onRequestScrollLines((N=>this.scrollLines(N.amount,N.suppressScrollEvent,1))),this.register(this._inputHandler.onRequestSyncScrollBar((()=>this.viewport.syncScrollArea()))),this.register(this.viewport),this.register(this.onCursorMove((()=>{this._renderService.handleCursorMove(),this._syncTextArea()}))),this.register(this.onResize((()=>this._renderService.handleResize(this.cols,this.rows)))),this.register(this.onBlur((()=>this._renderService.handleBlur()))),this.register(this.onFocus((()=>this._renderService.handleFocus()))),this.register(this._renderService.onDimensionsChange((()=>this.viewport.syncScrollArea()))),this._selectionService=this.register(this._instantiationService.createInstance(u.SelectionService,this.element,this.screenElement,this.linkifier)),this._instantiationService.setService(m.ISelectionService,this._selectionService),this.register(this._selectionService.onRequestScrollLines((N=>this.scrollLines(N.amount,N.suppressScrollEvent)))),this.register(this._selectionService.onSelectionChange((()=>this._onSelectionChange.fire()))),this.register(this._selectionService.onRequestRedraw((N=>this._renderService.handleSelectionChanged(N.start,N.end,N.columnSelectMode)))),this.register(this._selectionService.onLinuxMouseSelection((N=>{this.textarea.value=N,this.textarea.focus(),this.textarea.select()}))),this.register(this._onScroll.event((N=>{this.viewport.syncScrollArea(),this._selectionService.refresh()}))),this.register((0,l.addDisposableDomListener)(this._viewportElement,"scroll",(()=>this._selectionService.refresh()))),this.register(this._instantiationService.createInstance(d.BufferDecorationRenderer,this.screenElement)),this.register((0,l.addDisposableDomListener)(this.element,"mousedown",(N=>this._selectionService.handleMouseDown(N)))),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager.value=this._instantiationService.createInstance(W.AccessibilityManager,this)),this.register(this.optionsService.onSpecificOptionChange("screenReaderMode",(N=>this._handleScreenReaderModeOptionChange(N)))),this.options.overviewRulerWidth&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(t.OverviewRulerRenderer,this._viewportElement,this.screenElement))),this.optionsService.onSpecificOptionChange("overviewRulerWidth",(N=>{!this._overviewRulerRenderer&&N&&this._viewportElement&&this.screenElement&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(t.OverviewRulerRenderer,this._viewportElement,this.screenElement)))})),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}_createRenderer(){return this._instantiationService.createInstance(e.DomRenderer,this,this._document,this.element,this.screenElement,this._viewportElement,this._helperContainer,this.linkifier)}bindMouse(){const P=this,x=this.element;function N(q){const te=P._mouseService.getMouseReportCoords(q,P.screenElement);if(!te)return!1;let ne,oe;switch(q.overrideType||q.type){case"mousemove":oe=32,q.buttons===void 0?(ne=3,q.button!==void 0&&(ne=q.button<3?q.button:3)):ne=1&q.buttons?0:4&q.buttons?1:2&q.buttons?2:3;break;case"mouseup":oe=0,ne=q.button<3?q.button:3;break;case"mousedown":oe=1,ne=q.button<3?q.button:3;break;case"wheel":if(P._customWheelEventHandler&&P._customWheelEventHandler(q)===!1||P.viewport.getLinesScrolled(q)===0)return!1;oe=q.deltaY<0?0:1,ne=4;break;default:return!1}return!(oe===void 0||ne===void 0||ne>4)&&P.coreMouseService.triggerMouseEvent({col:te.col,row:te.row,x:te.x,y:te.y,button:ne,action:oe,ctrl:q.ctrlKey,alt:q.altKey,shift:q.shiftKey})}const z={mouseup:null,wheel:null,mousedrag:null,mousemove:null},V={mouseup:q=>(N(q),q.buttons||(this._document.removeEventListener("mouseup",z.mouseup),z.mousedrag&&this._document.removeEventListener("mousemove",z.mousedrag)),this.cancel(q)),wheel:q=>(N(q),this.cancel(q,!0)),mousedrag:q=>{q.buttons&&N(q)},mousemove:q=>{q.buttons||N(q)}};this.register(this.coreMouseService.onProtocolChange((q=>{q?(this.optionsService.rawOptions.logLevel==="debug"&&this._logService.debug("Binding to mouse events:",this.coreMouseService.explainEvents(q)),this.element.classList.add("enable-mouse-events"),this._selectionService.disable()):(this._logService.debug("Unbinding from mouse events."),this.element.classList.remove("enable-mouse-events"),this._selectionService.enable()),8&q?z.mousemove||(x.addEventListener("mousemove",V.mousemove),z.mousemove=V.mousemove):(x.removeEventListener("mousemove",z.mousemove),z.mousemove=null),16&q?z.wheel||(x.addEventListener("wheel",V.wheel,{passive:!1}),z.wheel=V.wheel):(x.removeEventListener("wheel",z.wheel),z.wheel=null),2&q?z.mouseup||(z.mouseup=V.mouseup):(this._document.removeEventListener("mouseup",z.mouseup),z.mouseup=null),4&q?z.mousedrag||(z.mousedrag=V.mousedrag):(this._document.removeEventListener("mousemove",z.mousedrag),z.mousedrag=null)}))),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this.register((0,l.addDisposableDomListener)(x,"mousedown",(q=>{if(q.preventDefault(),this.focus(),this.coreMouseService.areMouseEventsActive&&!this._selectionService.shouldForceSelection(q))return N(q),z.mouseup&&this._document.addEventListener("mouseup",z.mouseup),z.mousedrag&&this._document.addEventListener("mousemove",z.mousedrag),this.cancel(q)}))),this.register((0,l.addDisposableDomListener)(x,"wheel",(q=>{if(!z.wheel){if(this._customWheelEventHandler&&this._customWheelEventHandler(q)===!1)return!1;if(!this.buffer.hasScrollback){const te=this.viewport.getLinesScrolled(q);if(te===0)return;const ne=j.C0.ESC+(this.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(q.deltaY<0?"A":"B");let oe="";for(let ce=0;ce<Math.abs(te);ce++)oe+=ne;return this.coreService.triggerDataEvent(oe,!0),this.cancel(q,!0)}return this.viewport.handleWheel(q)?this.cancel(q):void 0}}),{passive:!1})),this.register((0,l.addDisposableDomListener)(x,"touchstart",(q=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchStart(q),this.cancel(q)}),{passive:!0})),this.register((0,l.addDisposableDomListener)(x,"touchmove",(q=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchMove(q)?void 0:this.cancel(q)}),{passive:!1}))}refresh(P,x){this._renderService?.refreshRows(P,x)}updateCursorStyle(P){this._selectionService?.shouldColumnSelect(P)?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}_showCursor(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}scrollLines(P,x,N=0){N===1?(super.scrollLines(P,x,N),this.refresh(0,this.rows-1)):this.viewport?.scrollLines(P)}paste(P){(0,a.paste)(P,this.textarea,this.coreService,this.optionsService)}attachCustomKeyEventHandler(P){this._customKeyEventHandler=P}attachCustomWheelEventHandler(P){this._customWheelEventHandler=P}registerLinkProvider(P){return this._linkProviderService.registerLinkProvider(P)}registerCharacterJoiner(P){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");const x=this._characterJoinerService.register(P);return this.refresh(0,this.rows-1),x}deregisterCharacterJoiner(P){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");this._characterJoinerService.deregister(P)&&this.refresh(0,this.rows-1)}get markers(){return this.buffer.markers}registerMarker(P){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+P)}registerDecoration(P){return this._decorationService.registerDecoration(P)}hasSelection(){return!!this._selectionService&&this._selectionService.hasSelection}select(P,x,N){this._selectionService.setSelection(P,x,N)}getSelection(){return this._selectionService?this._selectionService.selectionText:""}getSelectionPosition(){if(this._selectionService&&this._selectionService.hasSelection)return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}clearSelection(){this._selectionService?.clearSelection()}selectAll(){this._selectionService?.selectAll()}selectLines(P,x){this._selectionService?.selectLines(P,x)}_keyDown(P){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&this._customKeyEventHandler(P)===!1)return!1;const x=this.browser.isMac&&this.options.macOptionIsMeta&&P.altKey;if(!x&&!this._compositionHelper.keydown(P))return this.options.scrollOnUserInput&&this.buffer.ybase!==this.buffer.ydisp&&this.scrollToBottom(),!1;x||P.key!=="Dead"&&P.key!=="AltGraph"||(this._unprocessedDeadKey=!0);const N=(0,U.evaluateKeyboardEvent)(P,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(P),N.type===3||N.type===2){const z=this.rows-1;return this.scrollLines(N.type===2?-z:z),this.cancel(P,!0)}return N.type===1&&this.selectAll(),!!this._isThirdLevelShift(this.browser,P)||(N.cancel&&this.cancel(P,!0),!N.key||!!(P.key&&!P.ctrlKey&&!P.altKey&&!P.metaKey&&P.key.length===1&&P.key.charCodeAt(0)>=65&&P.key.charCodeAt(0)<=90)||(this._unprocessedDeadKey?(this._unprocessedDeadKey=!1,!0):(N.key!==j.C0.ETX&&N.key!==j.C0.CR||(this.textarea.value=""),this._onKey.fire({key:N.key,domEvent:P}),this._showCursor(),this.coreService.triggerDataEvent(N.key,!0),!this.optionsService.rawOptions.screenReaderMode||P.altKey||P.ctrlKey?this.cancel(P,!0):void(this._keyDownHandled=!0))))}_isThirdLevelShift(P,x){const N=P.isMac&&!this.options.macOptionIsMeta&&x.altKey&&!x.ctrlKey&&!x.metaKey||P.isWindows&&x.altKey&&x.ctrlKey&&!x.metaKey||P.isWindows&&x.getModifierState("AltGraph");return x.type==="keypress"?N:N&&(!x.keyCode||x.keyCode>47)}_keyUp(P){this._keyDownSeen=!1,this._customKeyEventHandler&&this._customKeyEventHandler(P)===!1||((function(x){return x.keyCode===16||x.keyCode===17||x.keyCode===18})(P)||this.focus(),this.updateCursorStyle(P),this._keyPressHandled=!1)}_keyPress(P){let x;if(this._keyPressHandled=!1,this._keyDownHandled||this._customKeyEventHandler&&this._customKeyEventHandler(P)===!1)return!1;if(this.cancel(P),P.charCode)x=P.charCode;else if(P.which===null||P.which===void 0)x=P.keyCode;else{if(P.which===0||P.charCode===0)return!1;x=P.which}return!(!x||(P.altKey||P.ctrlKey||P.metaKey)&&!this._isThirdLevelShift(this.browser,P)||(x=String.fromCharCode(x),this._onKey.fire({key:x,domEvent:P}),this._showCursor(),this.coreService.triggerDataEvent(x,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,0))}_inputEvent(P){if(P.data&&P.inputType==="insertText"&&(!P.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;const x=P.data;return this.coreService.triggerDataEvent(x,!0),this.cancel(P),!0}return!1}resize(P,x){P!==this.cols||x!==this.rows?super.resize(P,x):this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure()}_afterResize(P,x){this._charSizeService?.measure(),this.viewport?.syncScrollArea(!0)}clear(){if(this.buffer.ybase!==0||this.buffer.y!==0){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let P=1;P<this.rows;P++)this.buffer.lines.push(this.buffer.getBlankLine($.DEFAULT_ATTR_DATA));this._onScroll.fire({position:this.buffer.ydisp,source:0}),this.viewport?.reset(),this.refresh(0,this.rows-1)}}reset(){this.options.rows=this.rows,this.options.cols=this.cols;const P=this._customKeyEventHandler;this._setup(),super.reset(),this._selectionService?.reset(),this._decorationService.reset(),this.viewport?.reset(),this._customKeyEventHandler=P,this.refresh(0,this.rows-1)}clearTextureAtlas(){this._renderService?.clearTextureAtlas()}_reportFocus(){this.element?.classList.contains("focus")?this.coreService.triggerDataEvent(j.C0.ESC+"[I"):this.coreService.triggerDataEvent(j.C0.ESC+"[O")}_reportWindowsOptions(P){if(this._renderService)switch(P){case I.WindowsOptionsReportType.GET_WIN_SIZE_PIXELS:const x=this._renderService.dimensions.css.canvas.width.toFixed(0),N=this._renderService.dimensions.css.canvas.height.toFixed(0);this.coreService.triggerDataEvent(`${j.C0.ESC}[4;${N};${x}t`);break;case I.WindowsOptionsReportType.GET_CELL_SIZE_PIXELS:const z=this._renderService.dimensions.css.cell.width.toFixed(0),V=this._renderService.dimensions.css.cell.height.toFixed(0);this.coreService.triggerDataEvent(`${j.C0.ESC}[6;${V};${z}t`)}}cancel(P,x){if(this.options.cancelEvents||x)return P.preventDefault(),P.stopPropagation(),!1}}i.Terminal=Y},9924:(b,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.TimeBasedDebouncer=void 0,i.TimeBasedDebouncer=class{constructor(n,a=1e3){this._renderCallback=n,this._debounceThresholdMS=a,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}dispose(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}refresh(n,a,l){this._rowCount=l,n=n!==void 0?n:0,a=a!==void 0?a:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,n):n,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,a):a;const o=Date.now();if(o-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=o,this._innerRefresh();else if(!this._additionalRefreshRequested){const c=o-this._lastRefreshMs,f=this._debounceThresholdMS-c;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout((()=>{this._lastRefreshMs=Date.now(),this._innerRefresh(),this._additionalRefreshRequested=!1,this._refreshTimeoutID=void 0}),f)}}_innerRefresh(){if(this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return;const n=Math.max(this._rowStart,0),a=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(n,a)}}},1680:function(b,i,n){var a=this&&this.__decorate||function(s,e,r,h){var _,p=arguments.length,g=p<3?e:h===null?h=Object.getOwnPropertyDescriptor(e,r):h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(s,e,r,h);else for(var u=s.length-1;u>=0;u--)(_=s[u])&&(g=(p<3?_(g):p>3?_(e,r,g):_(e,r))||g);return p>3&&g&&Object.defineProperty(e,r,g),g},l=this&&this.__param||function(s,e){return function(r,h){e(r,h,s)}};Object.defineProperty(i,"__esModule",{value:!0}),i.Viewport=void 0;const o=n(3656),c=n(4725),f=n(8460),v=n(844),d=n(2585);let t=i.Viewport=class extends v.Disposable{constructor(s,e,r,h,_,p,g,u){super(),this._viewportElement=s,this._scrollArea=e,this._bufferService=r,this._optionsService=h,this._charSizeService=_,this._renderService=p,this._coreBrowserService=g,this.scrollBarWidth=0,this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._wheelPartialScroll=0,this._refreshAnimationFrame=null,this._ignoreNextScrollEvent=!1,this._smoothScrollState={startTime:0,origin:-1,target:-1},this._onRequestScrollLines=this.register(new f.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this.scrollBarWidth=this._viewportElement.offsetWidth-this._scrollArea.offsetWidth||15,this.register((0,o.addDisposableDomListener)(this._viewportElement,"scroll",this._handleScroll.bind(this))),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate((m=>this._activeBuffer=m.activeBuffer))),this._renderDimensions=this._renderService.dimensions,this.register(this._renderService.onDimensionsChange((m=>this._renderDimensions=m))),this._handleThemeChange(u.colors),this.register(u.onChangeColors((m=>this._handleThemeChange(m)))),this.register(this._optionsService.onSpecificOptionChange("scrollback",(()=>this.syncScrollArea()))),setTimeout((()=>this.syncScrollArea()))}_handleThemeChange(s){this._viewportElement.style.backgroundColor=s.background.css}reset(){this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._coreBrowserService.window.requestAnimationFrame((()=>this.syncScrollArea()))}_refresh(s){if(s)return this._innerRefresh(),void(this._refreshAnimationFrame!==null&&this._coreBrowserService.window.cancelAnimationFrame(this._refreshAnimationFrame));this._refreshAnimationFrame===null&&(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._innerRefresh())))}_innerRefresh(){if(this._charSizeService.height>0){this._currentRowHeight=this._renderDimensions.device.cell.height/this._coreBrowserService.dpr,this._currentDeviceCellHeight=this._renderDimensions.device.cell.height,this._lastRecordedViewportHeight=this._viewportElement.offsetHeight;const e=Math.round(this._currentRowHeight*this._lastRecordedBufferLength)+(this._lastRecordedViewportHeight-this._renderDimensions.css.canvas.height);this._lastRecordedBufferHeight!==e&&(this._lastRecordedBufferHeight=e,this._scrollArea.style.height=this._lastRecordedBufferHeight+"px")}const s=this._bufferService.buffer.ydisp*this._currentRowHeight;this._viewportElement.scrollTop!==s&&(this._ignoreNextScrollEvent=!0,this._viewportElement.scrollTop=s),this._refreshAnimationFrame=null}syncScrollArea(s=!1){if(this._lastRecordedBufferLength!==this._bufferService.buffer.lines.length)return this._lastRecordedBufferLength=this._bufferService.buffer.lines.length,void this._refresh(s);this._lastRecordedViewportHeight===this._renderService.dimensions.css.canvas.height&&this._lastScrollTop===this._activeBuffer.ydisp*this._currentRowHeight&&this._renderDimensions.device.cell.height===this._currentDeviceCellHeight||this._refresh(s)}_handleScroll(s){if(this._lastScrollTop=this._viewportElement.scrollTop,!this._viewportElement.offsetParent)return;if(this._ignoreNextScrollEvent)return this._ignoreNextScrollEvent=!1,void this._onRequestScrollLines.fire({amount:0,suppressScrollEvent:!0});const e=Math.round(this._lastScrollTop/this._currentRowHeight)-this._bufferService.buffer.ydisp;this._onRequestScrollLines.fire({amount:e,suppressScrollEvent:!0})}_smoothScroll(){if(this._isDisposed||this._smoothScrollState.origin===-1||this._smoothScrollState.target===-1)return;const s=this._smoothScrollPercent();this._viewportElement.scrollTop=this._smoothScrollState.origin+Math.round(s*(this._smoothScrollState.target-this._smoothScrollState.origin)),s<1?this._coreBrowserService.window.requestAnimationFrame((()=>this._smoothScroll())):this._clearSmoothScrollState()}_smoothScrollPercent(){return this._optionsService.rawOptions.smoothScrollDuration&&this._smoothScrollState.startTime?Math.max(Math.min((Date.now()-this._smoothScrollState.startTime)/this._optionsService.rawOptions.smoothScrollDuration,1),0):1}_clearSmoothScrollState(){this._smoothScrollState.startTime=0,this._smoothScrollState.origin=-1,this._smoothScrollState.target=-1}_bubbleScroll(s,e){const r=this._viewportElement.scrollTop+this._lastRecordedViewportHeight;return!(e<0&&this._viewportElement.scrollTop!==0||e>0&&r<this._lastRecordedBufferHeight)||(s.cancelable&&s.preventDefault(),!1)}handleWheel(s){const e=this._getPixelsScrolled(s);return e!==0&&(this._optionsService.rawOptions.smoothScrollDuration?(this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target===-1?this._smoothScrollState.target=this._viewportElement.scrollTop+e:this._smoothScrollState.target+=e,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()):this._viewportElement.scrollTop+=e,this._bubbleScroll(s,e))}scrollLines(s){if(s!==0)if(this._optionsService.rawOptions.smoothScrollDuration){const e=s*this._currentRowHeight;this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target=this._smoothScrollState.origin+e,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()}else this._onRequestScrollLines.fire({amount:s,suppressScrollEvent:!1})}_getPixelsScrolled(s){if(s.deltaY===0||s.shiftKey)return 0;let e=this._applyScrollModifier(s.deltaY,s);return s.deltaMode===WheelEvent.DOM_DELTA_LINE?e*=this._currentRowHeight:s.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(e*=this._currentRowHeight*this._bufferService.rows),e}getBufferElements(s,e){let r,h="";const _=[],p=e??this._bufferService.buffer.lines.length,g=this._bufferService.buffer.lines;for(let u=s;u<p;u++){const m=g.get(u);if(!m)continue;const B=g.get(u+1)?.isWrapped;if(h+=m.translateToString(!B),!B||u===g.length-1){const A=document.createElement("div");A.textContent=h,_.push(A),h.length>0&&(r=A),h=""}}return{bufferElements:_,cursorElement:r}}getLinesScrolled(s){if(s.deltaY===0||s.shiftKey)return 0;let e=this._applyScrollModifier(s.deltaY,s);return s.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(e/=this._currentRowHeight+0,this._wheelPartialScroll+=e,e=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):s.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(e*=this._bufferService.rows),e}_applyScrollModifier(s,e){const r=this._optionsService.rawOptions.fastScrollModifier;return r==="alt"&&e.altKey||r==="ctrl"&&e.ctrlKey||r==="shift"&&e.shiftKey?s*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:s*this._optionsService.rawOptions.scrollSensitivity}handleTouchStart(s){this._lastTouchY=s.touches[0].pageY}handleTouchMove(s){const e=this._lastTouchY-s.touches[0].pageY;return this._lastTouchY=s.touches[0].pageY,e!==0&&(this._viewportElement.scrollTop+=e,this._bubbleScroll(s,e))}};i.Viewport=t=a([l(2,d.IBufferService),l(3,d.IOptionsService),l(4,c.ICharSizeService),l(5,c.IRenderService),l(6,c.ICoreBrowserService),l(7,c.IThemeService)],t)},3107:function(b,i,n){var a=this&&this.__decorate||function(d,t,s,e){var r,h=arguments.length,_=h<3?t:e===null?e=Object.getOwnPropertyDescriptor(t,s):e;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(d,t,s,e);else for(var p=d.length-1;p>=0;p--)(r=d[p])&&(_=(h<3?r(_):h>3?r(t,s,_):r(t,s))||_);return h>3&&_&&Object.defineProperty(t,s,_),_},l=this&&this.__param||function(d,t){return function(s,e){t(s,e,d)}};Object.defineProperty(i,"__esModule",{value:!0}),i.BufferDecorationRenderer=void 0;const o=n(4725),c=n(844),f=n(2585);let v=i.BufferDecorationRenderer=class extends c.Disposable{constructor(d,t,s,e,r){super(),this._screenElement=d,this._bufferService=t,this._coreBrowserService=s,this._decorationService=e,this._renderService=r,this._decorationElements=new Map,this._altBufferIsActive=!1,this._dimensionsChanged=!1,this._container=document.createElement("div"),this._container.classList.add("xterm-decoration-container"),this._screenElement.appendChild(this._container),this.register(this._renderService.onRenderedViewportChange((()=>this._doRefreshDecorations()))),this.register(this._renderService.onDimensionsChange((()=>{this._dimensionsChanged=!0,this._queueRefresh()}))),this.register(this._coreBrowserService.onDprChange((()=>this._queueRefresh()))),this.register(this._bufferService.buffers.onBufferActivate((()=>{this._altBufferIsActive=this._bufferService.buffer===this._bufferService.buffers.alt}))),this.register(this._decorationService.onDecorationRegistered((()=>this._queueRefresh()))),this.register(this._decorationService.onDecorationRemoved((h=>this._removeDecoration(h)))),this.register((0,c.toDisposable)((()=>{this._container.remove(),this._decorationElements.clear()})))}_queueRefresh(){this._animationFrame===void 0&&(this._animationFrame=this._renderService.addRefreshCallback((()=>{this._doRefreshDecorations(),this._animationFrame=void 0})))}_doRefreshDecorations(){for(const d of this._decorationService.decorations)this._renderDecoration(d);this._dimensionsChanged=!1}_renderDecoration(d){this._refreshStyle(d),this._dimensionsChanged&&this._refreshXPosition(d)}_createElement(d){const t=this._coreBrowserService.mainDocument.createElement("div");t.classList.add("xterm-decoration"),t.classList.toggle("xterm-decoration-top-layer",d?.options?.layer==="top"),t.style.width=`${Math.round((d.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,t.style.height=(d.options.height||1)*this._renderService.dimensions.css.cell.height+"px",t.style.top=(d.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.css.cell.height+"px",t.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`;const s=d.options.x??0;return s&&s>this._bufferService.cols&&(t.style.display="none"),this._refreshXPosition(d,t),t}_refreshStyle(d){const t=d.marker.line-this._bufferService.buffers.active.ydisp;if(t<0||t>=this._bufferService.rows)d.element&&(d.element.style.display="none",d.onRenderEmitter.fire(d.element));else{let s=this._decorationElements.get(d);s||(s=this._createElement(d),d.element=s,this._decorationElements.set(d,s),this._container.appendChild(s),d.onDispose((()=>{this._decorationElements.delete(d),s.remove()}))),s.style.top=t*this._renderService.dimensions.css.cell.height+"px",s.style.display=this._altBufferIsActive?"none":"block",d.onRenderEmitter.fire(s)}}_refreshXPosition(d,t=d.element){if(!t)return;const s=d.options.x??0;(d.options.anchor||"left")==="right"?t.style.right=s?s*this._renderService.dimensions.css.cell.width+"px":"":t.style.left=s?s*this._renderService.dimensions.css.cell.width+"px":""}_removeDecoration(d){this._decorationElements.get(d)?.remove(),this._decorationElements.delete(d),d.dispose()}};i.BufferDecorationRenderer=v=a([l(1,f.IBufferService),l(2,o.ICoreBrowserService),l(3,f.IDecorationService),l(4,o.IRenderService)],v)},5871:(b,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.ColorZoneStore=void 0,i.ColorZoneStore=class{constructor(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}get zones(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}clear(){this._zones.length=0,this._zonePoolIndex=0}addDecoration(n){if(n.options.overviewRulerOptions){for(const a of this._zones)if(a.color===n.options.overviewRulerOptions.color&&a.position===n.options.overviewRulerOptions.position){if(this._lineIntersectsZone(a,n.marker.line))return;if(this._lineAdjacentToZone(a,n.marker.line,n.options.overviewRulerOptions.position))return void this._addLineToZone(a,n.marker.line)}if(this._zonePoolIndex<this._zonePool.length)return this._zonePool[this._zonePoolIndex].color=n.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=n.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=n.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=n.marker.line,void this._zones.push(this._zonePool[this._zonePoolIndex++]);this._zones.push({color:n.options.overviewRulerOptions.color,position:n.options.overviewRulerOptions.position,startBufferLine:n.marker.line,endBufferLine:n.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}setPadding(n){this._linePadding=n}_lineIntersectsZone(n,a){return a>=n.startBufferLine&&a<=n.endBufferLine}_lineAdjacentToZone(n,a,l){return a>=n.startBufferLine-this._linePadding[l||"full"]&&a<=n.endBufferLine+this._linePadding[l||"full"]}_addLineToZone(n,a){n.startBufferLine=Math.min(n.startBufferLine,a),n.endBufferLine=Math.max(n.endBufferLine,a)}}},5744:function(b,i,n){var a=this&&this.__decorate||function(r,h,_,p){var g,u=arguments.length,m=u<3?h:p===null?p=Object.getOwnPropertyDescriptor(h,_):p;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")m=Reflect.decorate(r,h,_,p);else for(var B=r.length-1;B>=0;B--)(g=r[B])&&(m=(u<3?g(m):u>3?g(h,_,m):g(h,_))||m);return u>3&&m&&Object.defineProperty(h,_,m),m},l=this&&this.__param||function(r,h){return function(_,p){h(_,p,r)}};Object.defineProperty(i,"__esModule",{value:!0}),i.OverviewRulerRenderer=void 0;const o=n(5871),c=n(4725),f=n(844),v=n(2585),d={full:0,left:0,center:0,right:0},t={full:0,left:0,center:0,right:0},s={full:0,left:0,center:0,right:0};let e=i.OverviewRulerRenderer=class extends f.Disposable{get _width(){return this._optionsService.options.overviewRulerWidth||0}constructor(r,h,_,p,g,u,m){super(),this._viewportElement=r,this._screenElement=h,this._bufferService=_,this._decorationService=p,this._renderService=g,this._optionsService=u,this._coreBrowserService=m,this._colorZoneStore=new o.ColorZoneStore,this._shouldUpdateDimensions=!0,this._shouldUpdateAnchor=!0,this._lastKnownBufferLength=0,this._canvas=this._coreBrowserService.mainDocument.createElement("canvas"),this._canvas.classList.add("xterm-decoration-overview-ruler"),this._refreshCanvasDimensions(),this._viewportElement.parentElement?.insertBefore(this._canvas,this._viewportElement);const B=this._canvas.getContext("2d");if(!B)throw new Error("Ctx cannot be null");this._ctx=B,this._registerDecorationListeners(),this._registerBufferChangeListeners(),this._registerDimensionChangeListeners(),this.register((0,f.toDisposable)((()=>{this._canvas?.remove()})))}_registerDecorationListeners(){this.register(this._decorationService.onDecorationRegistered((()=>this._queueRefresh(void 0,!0)))),this.register(this._decorationService.onDecorationRemoved((()=>this._queueRefresh(void 0,!0))))}_registerBufferChangeListeners(){this.register(this._renderService.onRenderedViewportChange((()=>this._queueRefresh()))),this.register(this._bufferService.buffers.onBufferActivate((()=>{this._canvas.style.display=this._bufferService.buffer===this._bufferService.buffers.alt?"none":"block"}))),this.register(this._bufferService.onScroll((()=>{this._lastKnownBufferLength!==this._bufferService.buffers.normal.lines.length&&(this._refreshDrawHeightConstants(),this._refreshColorZonePadding())})))}_registerDimensionChangeListeners(){this.register(this._renderService.onRender((()=>{this._containerHeight&&this._containerHeight===this._screenElement.clientHeight||(this._queueRefresh(!0),this._containerHeight=this._screenElement.clientHeight)}))),this.register(this._optionsService.onSpecificOptionChange("overviewRulerWidth",(()=>this._queueRefresh(!0)))),this.register(this._coreBrowserService.onDprChange((()=>this._queueRefresh(!0)))),this._queueRefresh(!0)}_refreshDrawConstants(){const r=Math.floor(this._canvas.width/3),h=Math.ceil(this._canvas.width/3);t.full=this._canvas.width,t.left=r,t.center=h,t.right=r,this._refreshDrawHeightConstants(),s.full=0,s.left=0,s.center=t.left,s.right=t.left+t.center}_refreshDrawHeightConstants(){d.full=Math.round(2*this._coreBrowserService.dpr);const r=this._canvas.height/this._bufferService.buffer.lines.length,h=Math.round(Math.max(Math.min(r,12),6)*this._coreBrowserService.dpr);d.left=h,d.center=h,d.right=h}_refreshColorZonePadding(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*d.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*d.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*d.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*d.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}_refreshCanvasDimensions(){this._canvas.style.width=`${this._width}px`,this._canvas.width=Math.round(this._width*this._coreBrowserService.dpr),this._canvas.style.height=`${this._screenElement.clientHeight}px`,this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowserService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}_refreshDecorations(){this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();for(const h of this._decorationService.decorations)this._colorZoneStore.addDecoration(h);this._ctx.lineWidth=1;const r=this._colorZoneStore.zones;for(const h of r)h.position!=="full"&&this._renderColorZone(h);for(const h of r)h.position==="full"&&this._renderColorZone(h);this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}_renderColorZone(r){this._ctx.fillStyle=r.color,this._ctx.fillRect(s[r.position||"full"],Math.round((this._canvas.height-1)*(r.startBufferLine/this._bufferService.buffers.active.lines.length)-d[r.position||"full"]/2),t[r.position||"full"],Math.round((this._canvas.height-1)*((r.endBufferLine-r.startBufferLine)/this._bufferService.buffers.active.lines.length)+d[r.position||"full"]))}_queueRefresh(r,h){this._shouldUpdateDimensions=r||this._shouldUpdateDimensions,this._shouldUpdateAnchor=h||this._shouldUpdateAnchor,this._animationFrame===void 0&&(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>{this._refreshDecorations(),this._animationFrame=void 0})))}};i.OverviewRulerRenderer=e=a([l(2,v.IBufferService),l(3,v.IDecorationService),l(4,c.IRenderService),l(5,v.IOptionsService),l(6,c.ICoreBrowserService)],e)},2950:function(b,i,n){var a=this&&this.__decorate||function(d,t,s,e){var r,h=arguments.length,_=h<3?t:e===null?e=Object.getOwnPropertyDescriptor(t,s):e;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(d,t,s,e);else for(var p=d.length-1;p>=0;p--)(r=d[p])&&(_=(h<3?r(_):h>3?r(t,s,_):r(t,s))||_);return h>3&&_&&Object.defineProperty(t,s,_),_},l=this&&this.__param||function(d,t){return function(s,e){t(s,e,d)}};Object.defineProperty(i,"__esModule",{value:!0}),i.CompositionHelper=void 0;const o=n(4725),c=n(2585),f=n(2584);let v=i.CompositionHelper=class{get isComposing(){return this._isComposing}constructor(d,t,s,e,r,h){this._textarea=d,this._compositionView=t,this._bufferService=s,this._optionsService=e,this._coreService=r,this._renderService=h,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}compositionstart(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}compositionupdate(d){this._compositionView.textContent=d.data,this.updateCompositionElements(),setTimeout((()=>{this._compositionPosition.end=this._textarea.value.length}),0)}compositionend(){this._finalizeComposition(!0)}keydown(d){if(this._isComposing||this._isSendingComposition){if(d.keyCode===229||d.keyCode===16||d.keyCode===17||d.keyCode===18)return!1;this._finalizeComposition(!1)}return d.keyCode!==229||(this._handleAnyTextareaChanges(),!1)}_finalizeComposition(d){if(this._compositionView.classList.remove("active"),this._isComposing=!1,d){const t={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout((()=>{if(this._isSendingComposition){let s;this._isSendingComposition=!1,t.start+=this._dataAlreadySent.length,s=this._isComposing?this._textarea.value.substring(t.start,t.end):this._textarea.value.substring(t.start),s.length>0&&this._coreService.triggerDataEvent(s,!0)}}),0)}else{this._isSendingComposition=!1;const t=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(t,!0)}}_handleAnyTextareaChanges(){const d=this._textarea.value;setTimeout((()=>{if(!this._isComposing){const t=this._textarea.value,s=t.replace(d,"");this._dataAlreadySent=s,t.length>d.length?this._coreService.triggerDataEvent(s,!0):t.length<d.length?this._coreService.triggerDataEvent(`${f.C0.DEL}`,!0):t.length===d.length&&t!==d&&this._coreService.triggerDataEvent(t,!0)}}),0)}updateCompositionElements(d){if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){const t=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),s=this._renderService.dimensions.css.cell.height,e=this._bufferService.buffer.y*this._renderService.dimensions.css.cell.height,r=t*this._renderService.dimensions.css.cell.width;this._compositionView.style.left=r+"px",this._compositionView.style.top=e+"px",this._compositionView.style.height=s+"px",this._compositionView.style.lineHeight=s+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";const h=this._compositionView.getBoundingClientRect();this._textarea.style.left=r+"px",this._textarea.style.top=e+"px",this._textarea.style.width=Math.max(h.width,1)+"px",this._textarea.style.height=Math.max(h.height,1)+"px",this._textarea.style.lineHeight=h.height+"px"}d||setTimeout((()=>this.updateCompositionElements(!0)),0)}}};i.CompositionHelper=v=a([l(2,c.IBufferService),l(3,c.IOptionsService),l(4,c.ICoreService),l(5,o.IRenderService)],v)},9806:(b,i)=>{function n(a,l,o){const c=o.getBoundingClientRect(),f=a.getComputedStyle(o),v=parseInt(f.getPropertyValue("padding-left")),d=parseInt(f.getPropertyValue("padding-top"));return[l.clientX-c.left-v,l.clientY-c.top-d]}Object.defineProperty(i,"__esModule",{value:!0}),i.getCoords=i.getCoordsRelativeToElement=void 0,i.getCoordsRelativeToElement=n,i.getCoords=function(a,l,o,c,f,v,d,t,s){if(!v)return;const e=n(a,l,o);return e?(e[0]=Math.ceil((e[0]+(s?d/2:0))/d),e[1]=Math.ceil(e[1]/t),e[0]=Math.min(Math.max(e[0],1),c+(s?1:0)),e[1]=Math.min(Math.max(e[1],1),f),e):void 0}},9504:(b,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.moveToCellSequence=void 0;const a=n(2584);function l(t,s,e,r){const h=t-o(t,e),_=s-o(s,e),p=Math.abs(h-_)-(function(g,u,m){let B=0;const A=g-o(g,m),O=u-o(u,m);for(let L=0;L<Math.abs(A-O);L++){const T=c(g,u)==="A"?-1:1;m.buffer.lines.get(A+T*L)?.isWrapped&&B++}return B})(t,s,e);return d(p,v(c(t,s),r))}function o(t,s){let e=0,r=s.buffer.lines.get(t),h=r?.isWrapped;for(;h&&t>=0&&t<s.rows;)e++,r=s.buffer.lines.get(--t),h=r?.isWrapped;return e}function c(t,s){return t>s?"A":"B"}function f(t,s,e,r,h,_){let p=t,g=s,u="";for(;p!==e||g!==r;)p+=h?1:-1,h&&p>_.cols-1?(u+=_.buffer.translateBufferLineToString(g,!1,t,p),p=0,t=0,g++):!h&&p<0&&(u+=_.buffer.translateBufferLineToString(g,!1,0,t+1),p=_.cols-1,t=p,g--);return u+_.buffer.translateBufferLineToString(g,!1,t,p)}function v(t,s){const e=s?"O":"[";return a.C0.ESC+e+t}function d(t,s){t=Math.floor(t);let e="";for(let r=0;r<t;r++)e+=s;return e}i.moveToCellSequence=function(t,s,e,r){const h=e.buffer.x,_=e.buffer.y;if(!e.buffer.hasScrollback)return(function(u,m,B,A,O,L){return l(m,A,O,L).length===0?"":d(f(u,m,u,m-o(m,O),!1,O).length,v("D",L))})(h,_,0,s,e,r)+l(_,s,e,r)+(function(u,m,B,A,O,L){let T;T=l(m,A,O,L).length>0?A-o(A,O):m;const H=A,$=(function(j,U,w,M,R,I){let W;return W=l(w,M,R,I).length>0?M-o(M,R):U,j<w&&W<=M||j>=w&&W<M?"C":"D"})(u,m,B,A,O,L);return d(f(u,T,B,H,$==="C",O).length,v($,L))})(h,_,t,s,e,r);let p;if(_===s)return p=h>t?"D":"C",d(Math.abs(h-t),v(p,r));p=_>s?"D":"C";const g=Math.abs(_-s);return d((function(u,m){return m.cols-u})(_>s?t:h,e)+(g-1)*e.cols+1+((_>s?h:t)-1),v(p,r))}},1296:function(b,i,n){var a=this&&this.__decorate||function(L,T,H,$){var j,U=arguments.length,w=U<3?T:$===null?$=Object.getOwnPropertyDescriptor(T,H):$;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")w=Reflect.decorate(L,T,H,$);else for(var M=L.length-1;M>=0;M--)(j=L[M])&&(w=(U<3?j(w):U>3?j(T,H,w):j(T,H))||w);return U>3&&w&&Object.defineProperty(T,H,w),w},l=this&&this.__param||function(L,T){return function(H,$){T(H,$,L)}};Object.defineProperty(i,"__esModule",{value:!0}),i.DomRenderer=void 0;const o=n(3787),c=n(2550),f=n(2223),v=n(6171),d=n(6052),t=n(4725),s=n(8055),e=n(8460),r=n(844),h=n(2585),_="xterm-dom-renderer-owner-",p="xterm-rows",g="xterm-fg-",u="xterm-bg-",m="xterm-focus",B="xterm-selection";let A=1,O=i.DomRenderer=class extends r.Disposable{constructor(L,T,H,$,j,U,w,M,R,I,W,K,Y){super(),this._terminal=L,this._document=T,this._element=H,this._screenElement=$,this._viewportElement=j,this._helperContainer=U,this._linkifier2=w,this._charSizeService=R,this._optionsService=I,this._bufferService=W,this._coreBrowserService=K,this._themeService=Y,this._terminalClass=A++,this._rowElements=[],this._selectionRenderModel=(0,d.createSelectionRenderModel)(),this.onRequestRedraw=this.register(new e.EventEmitter).event,this._rowContainer=this._document.createElement("div"),this._rowContainer.classList.add(p),this._rowContainer.style.lineHeight="normal",this._rowContainer.setAttribute("aria-hidden","true"),this._refreshRowElements(this._bufferService.cols,this._bufferService.rows),this._selectionContainer=this._document.createElement("div"),this._selectionContainer.classList.add(B),this._selectionContainer.setAttribute("aria-hidden","true"),this.dimensions=(0,v.createRenderDimensions)(),this._updateDimensions(),this.register(this._optionsService.onOptionChange((()=>this._handleOptionsChanged()))),this.register(this._themeService.onChangeColors((J=>this._injectCss(J)))),this._injectCss(this._themeService.colors),this._rowFactory=M.createInstance(o.DomRendererRowFactory,document),this._element.classList.add(_+this._terminalClass),this._screenElement.appendChild(this._rowContainer),this._screenElement.appendChild(this._selectionContainer),this.register(this._linkifier2.onShowLinkUnderline((J=>this._handleLinkHover(J)))),this.register(this._linkifier2.onHideLinkUnderline((J=>this._handleLinkLeave(J)))),this.register((0,r.toDisposable)((()=>{this._element.classList.remove(_+this._terminalClass),this._rowContainer.remove(),this._selectionContainer.remove(),this._widthCache.dispose(),this._themeStyleElement.remove(),this._dimensionsStyleElement.remove()}))),this._widthCache=new c.WidthCache(this._document,this._helperContainer),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}_updateDimensions(){const L=this._coreBrowserService.dpr;this.dimensions.device.char.width=this._charSizeService.width*L,this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*L),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.left=0,this.dimensions.device.char.top=0,this.dimensions.device.canvas.width=this.dimensions.device.cell.width*this._bufferService.cols,this.dimensions.device.canvas.height=this.dimensions.device.cell.height*this._bufferService.rows,this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/L),this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/L),this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols,this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows;for(const H of this._rowElements)H.style.width=`${this.dimensions.css.canvas.width}px`,H.style.height=`${this.dimensions.css.cell.height}px`,H.style.lineHeight=`${this.dimensions.css.cell.height}px`,H.style.overflow="hidden";this._dimensionsStyleElement||(this._dimensionsStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));const T=`${this._terminalSelector} .${p} span { display: inline-block; height: 100%; vertical-align: top;}`;this._dimensionsStyleElement.textContent=T,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}_injectCss(L){this._themeStyleElement||(this._themeStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));let T=`${this._terminalSelector} .${p} { color: ${L.foreground.css}; font-family: ${this._optionsService.rawOptions.fontFamily}; font-size: ${this._optionsService.rawOptions.fontSize}px; font-kerning: none; white-space: pre}`;T+=`${this._terminalSelector} .${p} .xterm-dim { color: ${s.color.multiplyOpacity(L.foreground,.5).css};}`,T+=`${this._terminalSelector} span:not(.xterm-bold) { font-weight: ${this._optionsService.rawOptions.fontWeight};}${this._terminalSelector} span.xterm-bold { font-weight: ${this._optionsService.rawOptions.fontWeightBold};}${this._terminalSelector} span.xterm-italic { font-style: italic;}`;const H=`blink_underline_${this._terminalClass}`,$=`blink_bar_${this._terminalClass}`,j=`blink_block_${this._terminalClass}`;T+=`@keyframes ${H} { 50% {  border-bottom-style: hidden; }}`,T+=`@keyframes ${$} { 50% {  box-shadow: none; }}`,T+=`@keyframes ${j} { 0% {  background-color: ${L.cursor.css};  color: ${L.cursorAccent.css}; } 50% {  background-color: inherit;  color: ${L.cursor.css}; }}`,T+=`${this._terminalSelector} .${p}.${m} .xterm-cursor.xterm-cursor-blink.xterm-cursor-underline { animation: ${H} 1s step-end infinite;}${this._terminalSelector} .${p}.${m} .xterm-cursor.xterm-cursor-blink.xterm-cursor-bar { animation: ${$} 1s step-end infinite;}${this._terminalSelector} .${p}.${m} .xterm-cursor.xterm-cursor-blink.xterm-cursor-block { animation: ${j} 1s step-end infinite;}${this._terminalSelector} .${p} .xterm-cursor.xterm-cursor-block { background-color: ${L.cursor.css}; color: ${L.cursorAccent.css};}${this._terminalSelector} .${p} .xterm-cursor.xterm-cursor-block:not(.xterm-cursor-blink) { background-color: ${L.cursor.css} !important; color: ${L.cursorAccent.css} !important;}${this._terminalSelector} .${p} .xterm-cursor.xterm-cursor-outline { outline: 1px solid ${L.cursor.css}; outline-offset: -1px;}${this._terminalSelector} .${p} .xterm-cursor.xterm-cursor-bar { box-shadow: ${this._optionsService.rawOptions.cursorWidth}px 0 0 ${L.cursor.css} inset;}${this._terminalSelector} .${p} .xterm-cursor.xterm-cursor-underline { border-bottom: 1px ${L.cursor.css}; border-bottom-style: solid; height: calc(100% - 1px);}`,T+=`${this._terminalSelector} .${B} { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}${this._terminalSelector}.focus .${B} div { position: absolute; background-color: ${L.selectionBackgroundOpaque.css};}${this._terminalSelector} .${B} div { position: absolute; background-color: ${L.selectionInactiveBackgroundOpaque.css};}`;for(const[U,w]of L.ansi.entries())T+=`${this._terminalSelector} .${g}${U} { color: ${w.css}; }${this._terminalSelector} .${g}${U}.xterm-dim { color: ${s.color.multiplyOpacity(w,.5).css}; }${this._terminalSelector} .${u}${U} { background-color: ${w.css}; }`;T+=`${this._terminalSelector} .${g}${f.INVERTED_DEFAULT_COLOR} { color: ${s.color.opaque(L.background).css}; }${this._terminalSelector} .${g}${f.INVERTED_DEFAULT_COLOR}.xterm-dim { color: ${s.color.multiplyOpacity(s.color.opaque(L.background),.5).css}; }${this._terminalSelector} .${u}${f.INVERTED_DEFAULT_COLOR} { background-color: ${L.foreground.css}; }`,this._themeStyleElement.textContent=T}_setDefaultSpacing(){const L=this.dimensions.css.cell.width-this._widthCache.get("W",!1,!1);this._rowContainer.style.letterSpacing=`${L}px`,this._rowFactory.defaultSpacing=L}handleDevicePixelRatioChange(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}_refreshRowElements(L,T){for(let H=this._rowElements.length;H<=T;H++){const $=this._document.createElement("div");this._rowContainer.appendChild($),this._rowElements.push($)}for(;this._rowElements.length>T;)this._rowContainer.removeChild(this._rowElements.pop())}handleResize(L,T){this._refreshRowElements(L,T),this._updateDimensions(),this.handleSelectionChanged(this._selectionRenderModel.selectionStart,this._selectionRenderModel.selectionEnd,this._selectionRenderModel.columnSelectMode)}handleCharSizeChanged(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}handleBlur(){this._rowContainer.classList.remove(m),this.renderRows(0,this._bufferService.rows-1)}handleFocus(){this._rowContainer.classList.add(m),this.renderRows(this._bufferService.buffer.y,this._bufferService.buffer.y)}handleSelectionChanged(L,T,H){if(this._selectionContainer.replaceChildren(),this._rowFactory.handleSelectionChanged(L,T,H),this.renderRows(0,this._bufferService.rows-1),!L||!T)return;this._selectionRenderModel.update(this._terminal,L,T,H);const $=this._selectionRenderModel.viewportStartRow,j=this._selectionRenderModel.viewportEndRow,U=this._selectionRenderModel.viewportCappedStartRow,w=this._selectionRenderModel.viewportCappedEndRow;if(U>=this._bufferService.rows||w<0)return;const M=this._document.createDocumentFragment();if(H){const R=L[0]>T[0];M.appendChild(this._createSelectionElement(U,R?T[0]:L[0],R?L[0]:T[0],w-U+1))}else{const R=$===U?L[0]:0,I=U===j?T[0]:this._bufferService.cols;M.appendChild(this._createSelectionElement(U,R,I));const W=w-U-1;if(M.appendChild(this._createSelectionElement(U+1,0,this._bufferService.cols,W)),U!==w){const K=j===w?T[0]:this._bufferService.cols;M.appendChild(this._createSelectionElement(w,0,K))}}this._selectionContainer.appendChild(M)}_createSelectionElement(L,T,H,$=1){const j=this._document.createElement("div"),U=T*this.dimensions.css.cell.width;let w=this.dimensions.css.cell.width*(H-T);return U+w>this.dimensions.css.canvas.width&&(w=this.dimensions.css.canvas.width-U),j.style.height=$*this.dimensions.css.cell.height+"px",j.style.top=L*this.dimensions.css.cell.height+"px",j.style.left=`${U}px`,j.style.width=`${w}px`,j}handleCursorMove(){}_handleOptionsChanged(){this._updateDimensions(),this._injectCss(this._themeService.colors),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}clear(){for(const L of this._rowElements)L.replaceChildren()}renderRows(L,T){const H=this._bufferService.buffer,$=H.ybase+H.y,j=Math.min(H.x,this._bufferService.cols-1),U=this._optionsService.rawOptions.cursorBlink,w=this._optionsService.rawOptions.cursorStyle,M=this._optionsService.rawOptions.cursorInactiveStyle;for(let R=L;R<=T;R++){const I=R+H.ydisp,W=this._rowElements[R],K=H.lines.get(I);if(!W||!K)break;W.replaceChildren(...this._rowFactory.createRow(K,I,I===$,w,M,j,U,this.dimensions.css.cell.width,this._widthCache,-1,-1))}}get _terminalSelector(){return`.${_}${this._terminalClass}`}_handleLinkHover(L){this._setCellUnderline(L.x1,L.x2,L.y1,L.y2,L.cols,!0)}_handleLinkLeave(L){this._setCellUnderline(L.x1,L.x2,L.y1,L.y2,L.cols,!1)}_setCellUnderline(L,T,H,$,j,U){H<0&&(L=0),$<0&&(T=0);const w=this._bufferService.rows-1;H=Math.max(Math.min(H,w),0),$=Math.max(Math.min($,w),0),j=Math.min(j,this._bufferService.cols);const M=this._bufferService.buffer,R=M.ybase+M.y,I=Math.min(M.x,j-1),W=this._optionsService.rawOptions.cursorBlink,K=this._optionsService.rawOptions.cursorStyle,Y=this._optionsService.rawOptions.cursorInactiveStyle;for(let J=H;J<=$;++J){const P=J+M.ydisp,x=this._rowElements[J],N=M.lines.get(P);if(!x||!N)break;x.replaceChildren(...this._rowFactory.createRow(N,P,P===R,K,Y,I,W,this.dimensions.css.cell.width,this._widthCache,U?J===H?L:0:-1,U?(J===$?T:j)-1:-1))}}};i.DomRenderer=O=a([l(7,h.IInstantiationService),l(8,t.ICharSizeService),l(9,h.IOptionsService),l(10,h.IBufferService),l(11,t.ICoreBrowserService),l(12,t.IThemeService)],O)},3787:function(b,i,n){var a=this&&this.__decorate||function(p,g,u,m){var B,A=arguments.length,O=A<3?g:m===null?m=Object.getOwnPropertyDescriptor(g,u):m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")O=Reflect.decorate(p,g,u,m);else for(var L=p.length-1;L>=0;L--)(B=p[L])&&(O=(A<3?B(O):A>3?B(g,u,O):B(g,u))||O);return A>3&&O&&Object.defineProperty(g,u,O),O},l=this&&this.__param||function(p,g){return function(u,m){g(u,m,p)}};Object.defineProperty(i,"__esModule",{value:!0}),i.DomRendererRowFactory=void 0;const o=n(2223),c=n(643),f=n(511),v=n(2585),d=n(8055),t=n(4725),s=n(4269),e=n(6171),r=n(3734);let h=i.DomRendererRowFactory=class{constructor(p,g,u,m,B,A,O){this._document=p,this._characterJoinerService=g,this._optionsService=u,this._coreBrowserService=m,this._coreService=B,this._decorationService=A,this._themeService=O,this._workCell=new f.CellData,this._columnSelectMode=!1,this.defaultSpacing=0}handleSelectionChanged(p,g,u){this._selectionStart=p,this._selectionEnd=g,this._columnSelectMode=u}createRow(p,g,u,m,B,A,O,L,T,H,$){const j=[],U=this._characterJoinerService.getJoinedCharacters(g),w=this._themeService.colors;let M,R=p.getNoBgTrimmedLength();u&&R<A+1&&(R=A+1);let I=0,W="",K=0,Y=0,J=0,P=!1,x=0,N=!1,z=0;const V=[],q=H!==-1&&$!==-1;for(let te=0;te<R;te++){p.loadCell(te,this._workCell);let ne=this._workCell.getWidth();if(ne===0)continue;let oe=!1,ce=te,Q=this._workCell;if(U.length>0&&te===U[0][0]){oe=!0;const re=U.shift();Q=new s.JoinedCellData(this._workCell,p.translateToString(!0,re[0],re[1]),re[1]-re[0]),ce=re[1]-1,ne=Q.getWidth()}const Be=this._isCellInSelection(te,g),Xe=u&&te===A,Ye=q&&te>=H&&te<=$;let Je=!1;this._decorationService.forEachDecorationAtCell(te,g,void 0,(re=>{Je=!0}));let ze=Q.getChars()||c.WHITESPACE_CELL_CHAR;if(ze===" "&&(Q.isUnderline()||Q.isOverline())&&(ze=" "),z=ne*L-T.get(ze,Q.isBold(),Q.isItalic()),M){if(I&&(Be&&N||!Be&&!N&&Q.bg===K)&&(Be&&N&&w.selectionForeground||Q.fg===Y)&&Q.extended.ext===J&&Ye===P&&z===x&&!Xe&&!oe&&!Je){Q.isInvisible()?W+=c.WHITESPACE_CELL_CHAR:W+=ze,I++;continue}I&&(M.textContent=W),M=this._document.createElement("span"),I=0,W=""}else M=this._document.createElement("span");if(K=Q.bg,Y=Q.fg,J=Q.extended.ext,P=Ye,x=z,N=Be,oe&&A>=te&&A<=ce&&(A=te),!this._coreService.isCursorHidden&&Xe&&this._coreService.isCursorInitialized){if(V.push("xterm-cursor"),this._coreBrowserService.isFocused)O&&V.push("xterm-cursor-blink"),V.push(m==="bar"?"xterm-cursor-bar":m==="underline"?"xterm-cursor-underline":"xterm-cursor-block");else if(B)switch(B){case"outline":V.push("xterm-cursor-outline");break;case"block":V.push("xterm-cursor-block");break;case"bar":V.push("xterm-cursor-bar");break;case"underline":V.push("xterm-cursor-underline")}}if(Q.isBold()&&V.push("xterm-bold"),Q.isItalic()&&V.push("xterm-italic"),Q.isDim()&&V.push("xterm-dim"),W=Q.isInvisible()?c.WHITESPACE_CELL_CHAR:Q.getChars()||c.WHITESPACE_CELL_CHAR,Q.isUnderline()&&(V.push(`xterm-underline-${Q.extended.underlineStyle}`),W===" "&&(W=" "),!Q.isUnderlineColorDefault()))if(Q.isUnderlineColorRGB())M.style.textDecorationColor=`rgb(${r.AttributeData.toColorRGB(Q.getUnderlineColor()).join(",")})`;else{let re=Q.getUnderlineColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&Q.isBold()&&re<8&&(re+=8),M.style.textDecorationColor=w.ansi[re].css}Q.isOverline()&&(V.push("xterm-overline"),W===" "&&(W=" ")),Q.isStrikethrough()&&V.push("xterm-strikethrough"),Ye&&(M.style.textDecoration="underline");let ue=Q.getFgColor(),Te=Q.getFgColorMode(),Se=Q.getBgColor(),Oe=Q.getBgColorMode();const Ze=!!Q.isInverse();if(Ze){const re=ue;ue=Se,Se=re;const Qt=Te;Te=Oe,Oe=Qt}let Ee,je,xe,Ie=!1;switch(this._decorationService.forEachDecorationAtCell(te,g,void 0,(re=>{re.options.layer!=="top"&&Ie||(re.backgroundColorRGB&&(Oe=50331648,Se=re.backgroundColorRGB.rgba>>8&16777215,Ee=re.backgroundColorRGB),re.foregroundColorRGB&&(Te=50331648,ue=re.foregroundColorRGB.rgba>>8&16777215,je=re.foregroundColorRGB),Ie=re.options.layer==="top")})),!Ie&&Be&&(Ee=this._coreBrowserService.isFocused?w.selectionBackgroundOpaque:w.selectionInactiveBackgroundOpaque,Se=Ee.rgba>>8&16777215,Oe=50331648,Ie=!0,w.selectionForeground&&(Te=50331648,ue=w.selectionForeground.rgba>>8&16777215,je=w.selectionForeground)),Ie&&V.push("xterm-decoration-top"),Oe){case 16777216:case 33554432:xe=w.ansi[Se],V.push(`xterm-bg-${Se}`);break;case 50331648:xe=d.channels.toColor(Se>>16,Se>>8&255,255&Se),this._addStyle(M,`background-color:#${_((Se>>>0).toString(16),"0",6)}`);break;default:Ze?(xe=w.foreground,V.push(`xterm-bg-${o.INVERTED_DEFAULT_COLOR}`)):xe=w.background}switch(Ee||Q.isDim()&&(Ee=d.color.multiplyOpacity(xe,.5)),Te){case 16777216:case 33554432:Q.isBold()&&ue<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&(ue+=8),this._applyMinimumContrast(M,xe,w.ansi[ue],Q,Ee,void 0)||V.push(`xterm-fg-${ue}`);break;case 50331648:const re=d.channels.toColor(ue>>16&255,ue>>8&255,255&ue);this._applyMinimumContrast(M,xe,re,Q,Ee,je)||this._addStyle(M,`color:#${_(ue.toString(16),"0",6)}`);break;default:this._applyMinimumContrast(M,xe,w.foreground,Q,Ee,je)||Ze&&V.push(`xterm-fg-${o.INVERTED_DEFAULT_COLOR}`)}V.length&&(M.className=V.join(" "),V.length=0),Xe||oe||Je?M.textContent=W:I++,z!==this.defaultSpacing&&(M.style.letterSpacing=`${z}px`),j.push(M),te=ce}return M&&I&&(M.textContent=W),j}_applyMinimumContrast(p,g,u,m,B,A){if(this._optionsService.rawOptions.minimumContrastRatio===1||(0,e.treatGlyphAsBackgroundColor)(m.getCode()))return!1;const O=this._getContrastCache(m);let L;if(B||A||(L=O.getColor(g.rgba,u.rgba)),L===void 0){const T=this._optionsService.rawOptions.minimumContrastRatio/(m.isDim()?2:1);L=d.color.ensureContrastRatio(B||g,A||u,T),O.setColor((B||g).rgba,(A||u).rgba,L??null)}return!!L&&(this._addStyle(p,`color:${L.css}`),!0)}_getContrastCache(p){return p.isDim()?this._themeService.colors.halfContrastCache:this._themeService.colors.contrastCache}_addStyle(p,g){p.setAttribute("style",`${p.getAttribute("style")||""}${g};`)}_isCellInSelection(p,g){const u=this._selectionStart,m=this._selectionEnd;return!(!u||!m)&&(this._columnSelectMode?u[0]<=m[0]?p>=u[0]&&g>=u[1]&&p<m[0]&&g<=m[1]:p<u[0]&&g>=u[1]&&p>=m[0]&&g<=m[1]:g>u[1]&&g<m[1]||u[1]===m[1]&&g===u[1]&&p>=u[0]&&p<m[0]||u[1]<m[1]&&g===m[1]&&p<m[0]||u[1]<m[1]&&g===u[1]&&p>=u[0])}};function _(p,g,u){for(;p.length<u;)p=g+p;return p}i.DomRendererRowFactory=h=a([l(1,t.ICharacterJoinerService),l(2,v.IOptionsService),l(3,t.ICoreBrowserService),l(4,v.ICoreService),l(5,v.IDecorationService),l(6,t.IThemeService)],h)},2550:(b,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.WidthCache=void 0,i.WidthCache=class{constructor(n,a){this._flat=new Float32Array(256),this._font="",this._fontSize=0,this._weight="normal",this._weightBold="bold",this._measureElements=[],this._container=n.createElement("div"),this._container.classList.add("xterm-width-cache-measure-container"),this._container.setAttribute("aria-hidden","true"),this._container.style.whiteSpace="pre",this._container.style.fontKerning="none";const l=n.createElement("span");l.classList.add("xterm-char-measure-element");const o=n.createElement("span");o.classList.add("xterm-char-measure-element"),o.style.fontWeight="bold";const c=n.createElement("span");c.classList.add("xterm-char-measure-element"),c.style.fontStyle="italic";const f=n.createElement("span");f.classList.add("xterm-char-measure-element"),f.style.fontWeight="bold",f.style.fontStyle="italic",this._measureElements=[l,o,c,f],this._container.appendChild(l),this._container.appendChild(o),this._container.appendChild(c),this._container.appendChild(f),a.appendChild(this._container),this.clear()}dispose(){this._container.remove(),this._measureElements.length=0,this._holey=void 0}clear(){this._flat.fill(-9999),this._holey=new Map}setFont(n,a,l,o){n===this._font&&a===this._fontSize&&l===this._weight&&o===this._weightBold||(this._font=n,this._fontSize=a,this._weight=l,this._weightBold=o,this._container.style.fontFamily=this._font,this._container.style.fontSize=`${this._fontSize}px`,this._measureElements[0].style.fontWeight=`${l}`,this._measureElements[1].style.fontWeight=`${o}`,this._measureElements[2].style.fontWeight=`${l}`,this._measureElements[3].style.fontWeight=`${o}`,this.clear())}get(n,a,l){let o=0;if(!a&&!l&&n.length===1&&(o=n.charCodeAt(0))<256){if(this._flat[o]!==-9999)return this._flat[o];const v=this._measure(n,0);return v>0&&(this._flat[o]=v),v}let c=n;a&&(c+="B"),l&&(c+="I");let f=this._holey.get(c);if(f===void 0){let v=0;a&&(v|=1),l&&(v|=2),f=this._measure(n,v),f>0&&this._holey.set(c,f)}return f}_measure(n,a){const l=this._measureElements[a];return l.textContent=n.repeat(32),l.offsetWidth/32}}},2223:(b,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.TEXT_BASELINE=i.DIM_OPACITY=i.INVERTED_DEFAULT_COLOR=void 0;const a=n(6114);i.INVERTED_DEFAULT_COLOR=257,i.DIM_OPACITY=.5,i.TEXT_BASELINE=a.isFirefox||a.isLegacyEdge?"bottom":"ideographic"},6171:(b,i)=>{function n(l){return 57508<=l&&l<=57558}function a(l){return l>=128512&&l<=128591||l>=127744&&l<=128511||l>=128640&&l<=128767||l>=9728&&l<=9983||l>=9984&&l<=10175||l>=65024&&l<=65039||l>=129280&&l<=129535||l>=127462&&l<=127487}Object.defineProperty(i,"__esModule",{value:!0}),i.computeNextVariantOffset=i.createRenderDimensions=i.treatGlyphAsBackgroundColor=i.allowRescaling=i.isEmoji=i.isRestrictedPowerlineGlyph=i.isPowerlineGlyph=i.throwIfFalsy=void 0,i.throwIfFalsy=function(l){if(!l)throw new Error("value must not be falsy");return l},i.isPowerlineGlyph=n,i.isRestrictedPowerlineGlyph=function(l){return 57520<=l&&l<=57527},i.isEmoji=a,i.allowRescaling=function(l,o,c,f){return o===1&&c>Math.ceil(1.5*f)&&l!==void 0&&l>255&&!a(l)&&!n(l)&&!(function(v){return 57344<=v&&v<=63743})(l)},i.treatGlyphAsBackgroundColor=function(l){return n(l)||(function(o){return 9472<=o&&o<=9631})(l)},i.createRenderDimensions=function(){return{css:{canvas:{width:0,height:0},cell:{width:0,height:0}},device:{canvas:{width:0,height:0},cell:{width:0,height:0},char:{width:0,height:0,left:0,top:0}}}},i.computeNextVariantOffset=function(l,o,c=0){return(l-(2*Math.round(o)-c))%(2*Math.round(o))}},6052:(b,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.createSelectionRenderModel=void 0;class n{constructor(){this.clear()}clear(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}update(l,o,c,f=!1){if(this.selectionStart=o,this.selectionEnd=c,!o||!c||o[0]===c[0]&&o[1]===c[1])return void this.clear();const v=l.buffers.active.ydisp,d=o[1]-v,t=c[1]-v,s=Math.max(d,0),e=Math.min(t,l.rows-1);s>=l.rows||e<0?this.clear():(this.hasSelection=!0,this.columnSelectMode=f,this.viewportStartRow=d,this.viewportEndRow=t,this.viewportCappedStartRow=s,this.viewportCappedEndRow=e,this.startCol=o[0],this.endCol=c[0])}isCellSelected(l,o,c){return!!this.hasSelection&&(c-=l.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?o>=this.startCol&&c>=this.viewportCappedStartRow&&o<this.endCol&&c<=this.viewportCappedEndRow:o<this.startCol&&c>=this.viewportCappedStartRow&&o>=this.endCol&&c<=this.viewportCappedEndRow:c>this.viewportStartRow&&c<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&c===this.viewportStartRow&&o>=this.startCol&&o<this.endCol||this.viewportStartRow<this.viewportEndRow&&c===this.viewportEndRow&&o<this.endCol||this.viewportStartRow<this.viewportEndRow&&c===this.viewportStartRow&&o>=this.startCol)}}i.createSelectionRenderModel=function(){return new n}},456:(b,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.SelectionModel=void 0,i.SelectionModel=class{constructor(n){this._bufferService=n,this.isSelectAllActive=!1,this.selectionStartLength=0}clearSelection(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}get finalSelectionStart(){return this.isSelectAllActive?[0,0]:this.selectionEnd&&this.selectionStart&&this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}get finalSelectionEnd(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){const n=this.selectionStart[0]+this.selectionStartLength;return n>this._bufferService.cols?n%this._bufferService.cols==0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(n/this._bufferService.cols)-1]:[n%this._bufferService.cols,this.selectionStart[1]+Math.floor(n/this._bufferService.cols)]:[n,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){const n=this.selectionStart[0]+this.selectionStartLength;return n>this._bufferService.cols?[n%this._bufferService.cols,this.selectionStart[1]+Math.floor(n/this._bufferService.cols)]:[Math.max(n,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}areSelectionValuesReversed(){const n=this.selectionStart,a=this.selectionEnd;return!(!n||!a)&&(n[1]>a[1]||n[1]===a[1]&&n[0]>a[0])}handleTrim(n){return this.selectionStart&&(this.selectionStart[1]-=n),this.selectionEnd&&(this.selectionEnd[1]-=n),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}}},428:function(b,i,n){var a=this&&this.__decorate||function(e,r,h,_){var p,g=arguments.length,u=g<3?r:_===null?_=Object.getOwnPropertyDescriptor(r,h):_;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(e,r,h,_);else for(var m=e.length-1;m>=0;m--)(p=e[m])&&(u=(g<3?p(u):g>3?p(r,h,u):p(r,h))||u);return g>3&&u&&Object.defineProperty(r,h,u),u},l=this&&this.__param||function(e,r){return function(h,_){r(h,_,e)}};Object.defineProperty(i,"__esModule",{value:!0}),i.CharSizeService=void 0;const o=n(2585),c=n(8460),f=n(844);let v=i.CharSizeService=class extends f.Disposable{get hasValidSize(){return this.width>0&&this.height>0}constructor(e,r,h){super(),this._optionsService=h,this.width=0,this.height=0,this._onCharSizeChange=this.register(new c.EventEmitter),this.onCharSizeChange=this._onCharSizeChange.event;try{this._measureStrategy=this.register(new s(this._optionsService))}catch{this._measureStrategy=this.register(new t(e,r,this._optionsService))}this.register(this._optionsService.onMultipleOptionChange(["fontFamily","fontSize"],(()=>this.measure())))}measure(){const e=this._measureStrategy.measure();e.width===this.width&&e.height===this.height||(this.width=e.width,this.height=e.height,this._onCharSizeChange.fire())}};i.CharSizeService=v=a([l(2,o.IOptionsService)],v);class d extends f.Disposable{constructor(){super(...arguments),this._result={width:0,height:0}}_validateAndSet(r,h){r!==void 0&&r>0&&h!==void 0&&h>0&&(this._result.width=r,this._result.height=h)}}class t extends d{constructor(r,h,_){super(),this._document=r,this._parentElement=h,this._optionsService=_,this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W".repeat(32),this._measureElement.setAttribute("aria-hidden","true"),this._measureElement.style.whiteSpace="pre",this._measureElement.style.fontKerning="none",this._parentElement.appendChild(this._measureElement)}measure(){return this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=`${this._optionsService.rawOptions.fontSize}px`,this._validateAndSet(Number(this._measureElement.offsetWidth)/32,Number(this._measureElement.offsetHeight)),this._result}}class s extends d{constructor(r){super(),this._optionsService=r,this._canvas=new OffscreenCanvas(100,100),this._ctx=this._canvas.getContext("2d");const h=this._ctx.measureText("W");if(!("width"in h&&"fontBoundingBoxAscent"in h&&"fontBoundingBoxDescent"in h))throw new Error("Required font metrics not supported")}measure(){this._ctx.font=`${this._optionsService.rawOptions.fontSize}px ${this._optionsService.rawOptions.fontFamily}`;const r=this._ctx.measureText("W");return this._validateAndSet(r.width,r.fontBoundingBoxAscent+r.fontBoundingBoxDescent),this._result}}},4269:function(b,i,n){var a=this&&this.__decorate||function(s,e,r,h){var _,p=arguments.length,g=p<3?e:h===null?h=Object.getOwnPropertyDescriptor(e,r):h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(s,e,r,h);else for(var u=s.length-1;u>=0;u--)(_=s[u])&&(g=(p<3?_(g):p>3?_(e,r,g):_(e,r))||g);return p>3&&g&&Object.defineProperty(e,r,g),g},l=this&&this.__param||function(s,e){return function(r,h){e(r,h,s)}};Object.defineProperty(i,"__esModule",{value:!0}),i.CharacterJoinerService=i.JoinedCellData=void 0;const o=n(3734),c=n(643),f=n(511),v=n(2585);class d extends o.AttributeData{constructor(e,r,h){super(),this.content=0,this.combinedData="",this.fg=e.fg,this.bg=e.bg,this.combinedData=r,this._width=h}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(e){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}i.JoinedCellData=d;let t=i.CharacterJoinerService=class Pt{constructor(e){this._bufferService=e,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new f.CellData}register(e){const r={id:this._nextCharacterJoinerId++,handler:e};return this._characterJoiners.push(r),r.id}deregister(e){for(let r=0;r<this._characterJoiners.length;r++)if(this._characterJoiners[r].id===e)return this._characterJoiners.splice(r,1),!0;return!1}getJoinedCharacters(e){if(this._characterJoiners.length===0)return[];const r=this._bufferService.buffer.lines.get(e);if(!r||r.length===0)return[];const h=[],_=r.translateToString(!0);let p=0,g=0,u=0,m=r.getFg(0),B=r.getBg(0);for(let A=0;A<r.getTrimmedLength();A++)if(r.loadCell(A,this._workCell),this._workCell.getWidth()!==0){if(this._workCell.fg!==m||this._workCell.bg!==B){if(A-p>1){const O=this._getJoinedRanges(_,u,g,r,p);for(let L=0;L<O.length;L++)h.push(O[L])}p=A,u=g,m=this._workCell.fg,B=this._workCell.bg}g+=this._workCell.getChars().length||c.WHITESPACE_CELL_CHAR.length}if(this._bufferService.cols-p>1){const A=this._getJoinedRanges(_,u,g,r,p);for(let O=0;O<A.length;O++)h.push(A[O])}return h}_getJoinedRanges(e,r,h,_,p){const g=e.substring(r,h);let u=[];try{u=this._characterJoiners[0].handler(g)}catch(m){console.error(m)}for(let m=1;m<this._characterJoiners.length;m++)try{const B=this._characterJoiners[m].handler(g);for(let A=0;A<B.length;A++)Pt._mergeRanges(u,B[A])}catch(B){console.error(B)}return this._stringRangesToCellRanges(u,_,p),u}_stringRangesToCellRanges(e,r,h){let _=0,p=!1,g=0,u=e[_];if(u){for(let m=h;m<this._bufferService.cols;m++){const B=r.getWidth(m),A=r.getString(m).length||c.WHITESPACE_CELL_CHAR.length;if(B!==0){if(!p&&u[0]<=g&&(u[0]=m,p=!0),u[1]<=g){if(u[1]=m,u=e[++_],!u)break;u[0]<=g?(u[0]=m,p=!0):p=!1}g+=A}}u&&(u[1]=this._bufferService.cols)}}static _mergeRanges(e,r){let h=!1;for(let _=0;_<e.length;_++){const p=e[_];if(h){if(r[1]<=p[0])return e[_-1][1]=r[1],e;if(r[1]<=p[1])return e[_-1][1]=Math.max(r[1],p[1]),e.splice(_,1),e;e.splice(_,1),_--}else{if(r[1]<=p[0])return e.splice(_,0,r),e;if(r[1]<=p[1])return p[0]=Math.min(r[0],p[0]),e;r[0]<p[1]&&(p[0]=Math.min(r[0],p[0]),h=!0)}}return h?e[e.length-1][1]=r[1]:e.push(r),e}};i.CharacterJoinerService=t=a([l(0,v.IBufferService)],t)},5114:(b,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.CoreBrowserService=void 0;const a=n(844),l=n(8460),o=n(3656);class c extends a.Disposable{constructor(d,t,s){super(),this._textarea=d,this._window=t,this.mainDocument=s,this._isFocused=!1,this._cachedIsFocused=void 0,this._screenDprMonitor=new f(this._window),this._onDprChange=this.register(new l.EventEmitter),this.onDprChange=this._onDprChange.event,this._onWindowChange=this.register(new l.EventEmitter),this.onWindowChange=this._onWindowChange.event,this.register(this.onWindowChange((e=>this._screenDprMonitor.setWindow(e)))),this.register((0,l.forwardEvent)(this._screenDprMonitor.onDprChange,this._onDprChange)),this._textarea.addEventListener("focus",(()=>this._isFocused=!0)),this._textarea.addEventListener("blur",(()=>this._isFocused=!1))}get window(){return this._window}set window(d){this._window!==d&&(this._window=d,this._onWindowChange.fire(this._window))}get dpr(){return this.window.devicePixelRatio}get isFocused(){return this._cachedIsFocused===void 0&&(this._cachedIsFocused=this._isFocused&&this._textarea.ownerDocument.hasFocus(),queueMicrotask((()=>this._cachedIsFocused=void 0))),this._cachedIsFocused}}i.CoreBrowserService=c;class f extends a.Disposable{constructor(d){super(),this._parentWindow=d,this._windowResizeListener=this.register(new a.MutableDisposable),this._onDprChange=this.register(new l.EventEmitter),this.onDprChange=this._onDprChange.event,this._outerListener=()=>this._setDprAndFireIfDiffers(),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._updateDpr(),this._setWindowResizeListener(),this.register((0,a.toDisposable)((()=>this.clearListener())))}setWindow(d){this._parentWindow=d,this._setWindowResizeListener(),this._setDprAndFireIfDiffers()}_setWindowResizeListener(){this._windowResizeListener.value=(0,o.addDisposableDomListener)(this._parentWindow,"resize",(()=>this._setDprAndFireIfDiffers()))}_setDprAndFireIfDiffers(){this._parentWindow.devicePixelRatio!==this._currentDevicePixelRatio&&this._onDprChange.fire(this._parentWindow.devicePixelRatio),this._updateDpr()}_updateDpr(){this._outerListener&&(this._resolutionMediaMatchList?.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia(`screen and (resolution: ${this._parentWindow.devicePixelRatio}dppx)`),this._resolutionMediaMatchList.addListener(this._outerListener))}clearListener(){this._resolutionMediaMatchList&&this._outerListener&&(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._outerListener=void 0)}}},779:(b,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.LinkProviderService=void 0;const a=n(844);class l extends a.Disposable{constructor(){super(),this.linkProviders=[],this.register((0,a.toDisposable)((()=>this.linkProviders.length=0)))}registerLinkProvider(c){return this.linkProviders.push(c),{dispose:()=>{const f=this.linkProviders.indexOf(c);f!==-1&&this.linkProviders.splice(f,1)}}}}i.LinkProviderService=l},8934:function(b,i,n){var a=this&&this.__decorate||function(v,d,t,s){var e,r=arguments.length,h=r<3?d:s===null?s=Object.getOwnPropertyDescriptor(d,t):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")h=Reflect.decorate(v,d,t,s);else for(var _=v.length-1;_>=0;_--)(e=v[_])&&(h=(r<3?e(h):r>3?e(d,t,h):e(d,t))||h);return r>3&&h&&Object.defineProperty(d,t,h),h},l=this&&this.__param||function(v,d){return function(t,s){d(t,s,v)}};Object.defineProperty(i,"__esModule",{value:!0}),i.MouseService=void 0;const o=n(4725),c=n(9806);let f=i.MouseService=class{constructor(v,d){this._renderService=v,this._charSizeService=d}getCoords(v,d,t,s,e){return(0,c.getCoords)(window,v,d,t,s,this._charSizeService.hasValidSize,this._renderService.dimensions.css.cell.width,this._renderService.dimensions.css.cell.height,e)}getMouseReportCoords(v,d){const t=(0,c.getCoordsRelativeToElement)(window,v,d);if(this._charSizeService.hasValidSize)return t[0]=Math.min(Math.max(t[0],0),this._renderService.dimensions.css.canvas.width-1),t[1]=Math.min(Math.max(t[1],0),this._renderService.dimensions.css.canvas.height-1),{col:Math.floor(t[0]/this._renderService.dimensions.css.cell.width),row:Math.floor(t[1]/this._renderService.dimensions.css.cell.height),x:Math.floor(t[0]),y:Math.floor(t[1])}}};i.MouseService=f=a([l(0,o.IRenderService),l(1,o.ICharSizeService)],f)},3230:function(b,i,n){var a=this&&this.__decorate||function(e,r,h,_){var p,g=arguments.length,u=g<3?r:_===null?_=Object.getOwnPropertyDescriptor(r,h):_;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(e,r,h,_);else for(var m=e.length-1;m>=0;m--)(p=e[m])&&(u=(g<3?p(u):g>3?p(r,h,u):p(r,h))||u);return g>3&&u&&Object.defineProperty(r,h,u),u},l=this&&this.__param||function(e,r){return function(h,_){r(h,_,e)}};Object.defineProperty(i,"__esModule",{value:!0}),i.RenderService=void 0;const o=n(6193),c=n(4725),f=n(8460),v=n(844),d=n(7226),t=n(2585);let s=i.RenderService=class extends v.Disposable{get dimensions(){return this._renderer.value.dimensions}constructor(e,r,h,_,p,g,u,m){super(),this._rowCount=e,this._charSizeService=_,this._renderer=this.register(new v.MutableDisposable),this._pausedResizeTask=new d.DebouncedIdleTask,this._observerDisposable=this.register(new v.MutableDisposable),this._isPaused=!1,this._needsFullRefresh=!1,this._isNextRenderRedrawOnly=!0,this._needsSelectionRefresh=!1,this._canvasWidth=0,this._canvasHeight=0,this._selectionState={start:void 0,end:void 0,columnSelectMode:!1},this._onDimensionsChange=this.register(new f.EventEmitter),this.onDimensionsChange=this._onDimensionsChange.event,this._onRenderedViewportChange=this.register(new f.EventEmitter),this.onRenderedViewportChange=this._onRenderedViewportChange.event,this._onRender=this.register(new f.EventEmitter),this.onRender=this._onRender.event,this._onRefreshRequest=this.register(new f.EventEmitter),this.onRefreshRequest=this._onRefreshRequest.event,this._renderDebouncer=new o.RenderDebouncer(((B,A)=>this._renderRows(B,A)),u),this.register(this._renderDebouncer),this.register(u.onDprChange((()=>this.handleDevicePixelRatioChange()))),this.register(g.onResize((()=>this._fullRefresh()))),this.register(g.buffers.onBufferActivate((()=>this._renderer.value?.clear()))),this.register(h.onOptionChange((()=>this._handleOptionsChanged()))),this.register(this._charSizeService.onCharSizeChange((()=>this.handleCharSizeChanged()))),this.register(p.onDecorationRegistered((()=>this._fullRefresh()))),this.register(p.onDecorationRemoved((()=>this._fullRefresh()))),this.register(h.onMultipleOptionChange(["customGlyphs","drawBoldTextInBrightColors","letterSpacing","lineHeight","fontFamily","fontSize","fontWeight","fontWeightBold","minimumContrastRatio","rescaleOverlappingGlyphs"],(()=>{this.clear(),this.handleResize(g.cols,g.rows),this._fullRefresh()}))),this.register(h.onMultipleOptionChange(["cursorBlink","cursorStyle"],(()=>this.refreshRows(g.buffer.y,g.buffer.y,!0)))),this.register(m.onChangeColors((()=>this._fullRefresh()))),this._registerIntersectionObserver(u.window,r),this.register(u.onWindowChange((B=>this._registerIntersectionObserver(B,r))))}_registerIntersectionObserver(e,r){if("IntersectionObserver"in e){const h=new e.IntersectionObserver((_=>this._handleIntersectionChange(_[_.length-1])),{threshold:0});h.observe(r),this._observerDisposable.value=(0,v.toDisposable)((()=>h.disconnect()))}}_handleIntersectionChange(e){this._isPaused=e.isIntersecting===void 0?e.intersectionRatio===0:!e.isIntersecting,this._isPaused||this._charSizeService.hasValidSize||this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this._pausedResizeTask.flush(),this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}refreshRows(e,r,h=!1){this._isPaused?this._needsFullRefresh=!0:(h||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(e,r,this._rowCount))}_renderRows(e,r){this._renderer.value&&(e=Math.min(e,this._rowCount-1),r=Math.min(r,this._rowCount-1),this._renderer.value.renderRows(e,r),this._needsSelectionRefresh&&(this._renderer.value.handleSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:e,end:r}),this._onRender.fire({start:e,end:r}),this._isNextRenderRedrawOnly=!0)}resize(e,r){this._rowCount=r,this._fireOnCanvasResize()}_handleOptionsChanged(){this._renderer.value&&(this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize())}_fireOnCanvasResize(){this._renderer.value&&(this._renderer.value.dimensions.css.canvas.width===this._canvasWidth&&this._renderer.value.dimensions.css.canvas.height===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.value.dimensions))}hasRenderer(){return!!this._renderer.value}setRenderer(e){this._renderer.value=e,this._renderer.value&&(this._renderer.value.onRequestRedraw((r=>this.refreshRows(r.start,r.end,!0))),this._needsSelectionRefresh=!0,this._fullRefresh())}addRefreshCallback(e){return this._renderDebouncer.addRefreshCallback(e)}_fullRefresh(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}clearTextureAtlas(){this._renderer.value&&(this._renderer.value.clearTextureAtlas?.(),this._fullRefresh())}handleDevicePixelRatioChange(){this._charSizeService.measure(),this._renderer.value&&(this._renderer.value.handleDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1))}handleResize(e,r){this._renderer.value&&(this._isPaused?this._pausedResizeTask.set((()=>this._renderer.value?.handleResize(e,r))):this._renderer.value.handleResize(e,r),this._fullRefresh())}handleCharSizeChanged(){this._renderer.value?.handleCharSizeChanged()}handleBlur(){this._renderer.value?.handleBlur()}handleFocus(){this._renderer.value?.handleFocus()}handleSelectionChanged(e,r,h){this._selectionState.start=e,this._selectionState.end=r,this._selectionState.columnSelectMode=h,this._renderer.value?.handleSelectionChanged(e,r,h)}handleCursorMove(){this._renderer.value?.handleCursorMove()}clear(){this._renderer.value?.clear()}};i.RenderService=s=a([l(2,t.IOptionsService),l(3,c.ICharSizeService),l(4,t.IDecorationService),l(5,t.IBufferService),l(6,c.ICoreBrowserService),l(7,c.IThemeService)],s)},9312:function(b,i,n){var a=this&&this.__decorate||function(u,m,B,A){var O,L=arguments.length,T=L<3?m:A===null?A=Object.getOwnPropertyDescriptor(m,B):A;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")T=Reflect.decorate(u,m,B,A);else for(var H=u.length-1;H>=0;H--)(O=u[H])&&(T=(L<3?O(T):L>3?O(m,B,T):O(m,B))||T);return L>3&&T&&Object.defineProperty(m,B,T),T},l=this&&this.__param||function(u,m){return function(B,A){m(B,A,u)}};Object.defineProperty(i,"__esModule",{value:!0}),i.SelectionService=void 0;const o=n(9806),c=n(9504),f=n(456),v=n(4725),d=n(8460),t=n(844),s=n(6114),e=n(4841),r=n(511),h=n(2585),_=" ",p=new RegExp(_,"g");let g=i.SelectionService=class extends t.Disposable{constructor(u,m,B,A,O,L,T,H,$){super(),this._element=u,this._screenElement=m,this._linkifier=B,this._bufferService=A,this._coreService=O,this._mouseService=L,this._optionsService=T,this._renderService=H,this._coreBrowserService=$,this._dragScrollAmount=0,this._enabled=!0,this._workCell=new r.CellData,this._mouseDownTimeStamp=0,this._oldHasSelection=!1,this._oldSelectionStart=void 0,this._oldSelectionEnd=void 0,this._onLinuxMouseSelection=this.register(new d.EventEmitter),this.onLinuxMouseSelection=this._onLinuxMouseSelection.event,this._onRedrawRequest=this.register(new d.EventEmitter),this.onRequestRedraw=this._onRedrawRequest.event,this._onSelectionChange=this.register(new d.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onRequestScrollLines=this.register(new d.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this._mouseMoveListener=j=>this._handleMouseMove(j),this._mouseUpListener=j=>this._handleMouseUp(j),this._coreService.onUserInput((()=>{this.hasSelection&&this.clearSelection()})),this._trimListener=this._bufferService.buffer.lines.onTrim((j=>this._handleTrim(j))),this.register(this._bufferService.buffers.onBufferActivate((j=>this._handleBufferActivate(j)))),this.enable(),this._model=new f.SelectionModel(this._bufferService),this._activeSelectionMode=0,this.register((0,t.toDisposable)((()=>{this._removeMouseDownListeners()})))}reset(){this.clearSelection()}disable(){this.clearSelection(),this._enabled=!1}enable(){this._enabled=!0}get selectionStart(){return this._model.finalSelectionStart}get selectionEnd(){return this._model.finalSelectionEnd}get hasSelection(){const u=this._model.finalSelectionStart,m=this._model.finalSelectionEnd;return!(!u||!m||u[0]===m[0]&&u[1]===m[1])}get selectionText(){const u=this._model.finalSelectionStart,m=this._model.finalSelectionEnd;if(!u||!m)return"";const B=this._bufferService.buffer,A=[];if(this._activeSelectionMode===3){if(u[0]===m[0])return"";const O=u[0]<m[0]?u[0]:m[0],L=u[0]<m[0]?m[0]:u[0];for(let T=u[1];T<=m[1];T++){const H=B.translateBufferLineToString(T,!0,O,L);A.push(H)}}else{const O=u[1]===m[1]?m[0]:void 0;A.push(B.translateBufferLineToString(u[1],!0,u[0],O));for(let L=u[1]+1;L<=m[1]-1;L++){const T=B.lines.get(L),H=B.translateBufferLineToString(L,!0);T?.isWrapped?A[A.length-1]+=H:A.push(H)}if(u[1]!==m[1]){const L=B.lines.get(m[1]),T=B.translateBufferLineToString(m[1],!0,0,m[0]);L&&L.isWrapped?A[A.length-1]+=T:A.push(T)}}return A.map((O=>O.replace(p," "))).join(s.isWindows?`\r
`:`
`)}clearSelection(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}refresh(u){this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._refresh()))),s.isLinux&&u&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}_refresh(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:this._activeSelectionMode===3})}_isClickInSelection(u){const m=this._getMouseBufferCoords(u),B=this._model.finalSelectionStart,A=this._model.finalSelectionEnd;return!!(B&&A&&m)&&this._areCoordsInSelection(m,B,A)}isCellInSelection(u,m){const B=this._model.finalSelectionStart,A=this._model.finalSelectionEnd;return!(!B||!A)&&this._areCoordsInSelection([u,m],B,A)}_areCoordsInSelection(u,m,B){return u[1]>m[1]&&u[1]<B[1]||m[1]===B[1]&&u[1]===m[1]&&u[0]>=m[0]&&u[0]<B[0]||m[1]<B[1]&&u[1]===B[1]&&u[0]<B[0]||m[1]<B[1]&&u[1]===m[1]&&u[0]>=m[0]}_selectWordAtCursor(u,m){const B=this._linkifier.currentLink?.link?.range;if(B)return this._model.selectionStart=[B.start.x-1,B.start.y-1],this._model.selectionStartLength=(0,e.getRangeLength)(B,this._bufferService.cols),this._model.selectionEnd=void 0,!0;const A=this._getMouseBufferCoords(u);return!!A&&(this._selectWordAt(A,m),this._model.selectionEnd=void 0,!0)}selectAll(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}selectLines(u,m){this._model.clearSelection(),u=Math.max(u,0),m=Math.min(m,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,u],this._model.selectionEnd=[this._bufferService.cols,m],this.refresh(),this._onSelectionChange.fire()}_handleTrim(u){this._model.handleTrim(u)&&this.refresh()}_getMouseBufferCoords(u){const m=this._mouseService.getCoords(u,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(m)return m[0]--,m[1]--,m[1]+=this._bufferService.buffer.ydisp,m}_getMouseEventScrollAmount(u){let m=(0,o.getCoordsRelativeToElement)(this._coreBrowserService.window,u,this._screenElement)[1];const B=this._renderService.dimensions.css.canvas.height;return m>=0&&m<=B?0:(m>B&&(m-=B),m=Math.min(Math.max(m,-50),50),m/=50,m/Math.abs(m)+Math.round(14*m))}shouldForceSelection(u){return s.isMac?u.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:u.shiftKey}handleMouseDown(u){if(this._mouseDownTimeStamp=u.timeStamp,(u.button!==2||!this.hasSelection)&&u.button===0){if(!this._enabled){if(!this.shouldForceSelection(u))return;u.stopPropagation()}u.preventDefault(),this._dragScrollAmount=0,this._enabled&&u.shiftKey?this._handleIncrementalClick(u):u.detail===1?this._handleSingleClick(u):u.detail===2?this._handleDoubleClick(u):u.detail===3&&this._handleTripleClick(u),this._addMouseDownListeners(),this.refresh(!0)}}_addMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval((()=>this._dragScroll()),50)}_removeMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}_handleIncrementalClick(u){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(u))}_handleSingleClick(u){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(u)?3:0,this._model.selectionStart=this._getMouseBufferCoords(u),!this._model.selectionStart)return;this._model.selectionEnd=void 0;const m=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);m&&m.length!==this._model.selectionStart[0]&&m.hasWidth(this._model.selectionStart[0])===0&&this._model.selectionStart[0]++}_handleDoubleClick(u){this._selectWordAtCursor(u,!0)&&(this._activeSelectionMode=1)}_handleTripleClick(u){const m=this._getMouseBufferCoords(u);m&&(this._activeSelectionMode=2,this._selectLineAt(m[1]))}shouldColumnSelect(u){return u.altKey&&!(s.isMac&&this._optionsService.rawOptions.macOptionClickForcesSelection)}_handleMouseMove(u){if(u.stopImmediatePropagation(),!this._model.selectionStart)return;const m=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(u),!this._model.selectionEnd)return void this.refresh(!0);this._activeSelectionMode===2?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:this._activeSelectionMode===1&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(u),this._activeSelectionMode!==3&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));const B=this._bufferService.buffer;if(this._model.selectionEnd[1]<B.lines.length){const A=B.lines.get(this._model.selectionEnd[1]);A&&A.hasWidth(this._model.selectionEnd[0])===0&&this._model.selectionEnd[0]<this._bufferService.cols&&this._model.selectionEnd[0]++}m&&m[0]===this._model.selectionEnd[0]&&m[1]===this._model.selectionEnd[1]||this.refresh(!0)}_dragScroll(){if(this._model.selectionEnd&&this._model.selectionStart&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});const u=this._bufferService.buffer;this._dragScrollAmount>0?(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(u.ydisp+this._bufferService.rows,u.lines.length-1)):(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=u.ydisp),this.refresh()}}_handleMouseUp(u){const m=u.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&m<500&&u.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){const B=this._mouseService.getCoords(u,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(B&&B[0]!==void 0&&B[1]!==void 0){const A=(0,c.moveToCellSequence)(B[0]-1,B[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(A,!0)}}}else this._fireEventIfSelectionChanged()}_fireEventIfSelectionChanged(){const u=this._model.finalSelectionStart,m=this._model.finalSelectionEnd,B=!(!u||!m||u[0]===m[0]&&u[1]===m[1]);B?u&&m&&(this._oldSelectionStart&&this._oldSelectionEnd&&u[0]===this._oldSelectionStart[0]&&u[1]===this._oldSelectionStart[1]&&m[0]===this._oldSelectionEnd[0]&&m[1]===this._oldSelectionEnd[1]||this._fireOnSelectionChange(u,m,B)):this._oldHasSelection&&this._fireOnSelectionChange(u,m,B)}_fireOnSelectionChange(u,m,B){this._oldSelectionStart=u,this._oldSelectionEnd=m,this._oldHasSelection=B,this._onSelectionChange.fire()}_handleBufferActivate(u){this.clearSelection(),this._trimListener.dispose(),this._trimListener=u.activeBuffer.lines.onTrim((m=>this._handleTrim(m)))}_convertViewportColToCharacterIndex(u,m){let B=m;for(let A=0;m>=A;A++){const O=u.loadCell(A,this._workCell).getChars().length;this._workCell.getWidth()===0?B--:O>1&&m!==A&&(B+=O-1)}return B}setSelection(u,m,B){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[u,m],this._model.selectionStartLength=B,this.refresh(),this._fireEventIfSelectionChanged()}rightClickSelect(u){this._isClickInSelection(u)||(this._selectWordAtCursor(u,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}_getWordAt(u,m,B=!0,A=!0){if(u[0]>=this._bufferService.cols)return;const O=this._bufferService.buffer,L=O.lines.get(u[1]);if(!L)return;const T=O.translateBufferLineToString(u[1],!1);let H=this._convertViewportColToCharacterIndex(L,u[0]),$=H;const j=u[0]-H;let U=0,w=0,M=0,R=0;if(T.charAt(H)===" "){for(;H>0&&T.charAt(H-1)===" ";)H--;for(;$<T.length&&T.charAt($+1)===" ";)$++}else{let K=u[0],Y=u[0];L.getWidth(K)===0&&(U++,K--),L.getWidth(Y)===2&&(w++,Y++);const J=L.getString(Y).length;for(J>1&&(R+=J-1,$+=J-1);K>0&&H>0&&!this._isCharWordSeparator(L.loadCell(K-1,this._workCell));){L.loadCell(K-1,this._workCell);const P=this._workCell.getChars().length;this._workCell.getWidth()===0?(U++,K--):P>1&&(M+=P-1,H-=P-1),H--,K--}for(;Y<L.length&&$+1<T.length&&!this._isCharWordSeparator(L.loadCell(Y+1,this._workCell));){L.loadCell(Y+1,this._workCell);const P=this._workCell.getChars().length;this._workCell.getWidth()===2?(w++,Y++):P>1&&(R+=P-1,$+=P-1),$++,Y++}}$++;let I=H+j-U+M,W=Math.min(this._bufferService.cols,$-H+U+w-M-R);if(m||T.slice(H,$).trim()!==""){if(B&&I===0&&L.getCodePoint(0)!==32){const K=O.lines.get(u[1]-1);if(K&&L.isWrapped&&K.getCodePoint(this._bufferService.cols-1)!==32){const Y=this._getWordAt([this._bufferService.cols-1,u[1]-1],!1,!0,!1);if(Y){const J=this._bufferService.cols-Y.start;I-=J,W+=J}}}if(A&&I+W===this._bufferService.cols&&L.getCodePoint(this._bufferService.cols-1)!==32){const K=O.lines.get(u[1]+1);if(K?.isWrapped&&K.getCodePoint(0)!==32){const Y=this._getWordAt([0,u[1]+1],!1,!1,!0);Y&&(W+=Y.length)}}return{start:I,length:W}}}_selectWordAt(u,m){const B=this._getWordAt(u,m);if(B){for(;B.start<0;)B.start+=this._bufferService.cols,u[1]--;this._model.selectionStart=[B.start,u[1]],this._model.selectionStartLength=B.length}}_selectToWordAt(u){const m=this._getWordAt(u,!0);if(m){let B=u[1];for(;m.start<0;)m.start+=this._bufferService.cols,B--;if(!this._model.areSelectionValuesReversed())for(;m.start+m.length>this._bufferService.cols;)m.length-=this._bufferService.cols,B++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?m.start:m.start+m.length,B]}}_isCharWordSeparator(u){return u.getWidth()!==0&&this._optionsService.rawOptions.wordSeparator.indexOf(u.getChars())>=0}_selectLineAt(u){const m=this._bufferService.buffer.getWrappedRangeForLine(u),B={start:{x:0,y:m.first},end:{x:this._bufferService.cols-1,y:m.last}};this._model.selectionStart=[0,m.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=(0,e.getRangeLength)(B,this._bufferService.cols)}};i.SelectionService=g=a([l(3,h.IBufferService),l(4,h.ICoreService),l(5,v.IMouseService),l(6,h.IOptionsService),l(7,v.IRenderService),l(8,v.ICoreBrowserService)],g)},4725:(b,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.ILinkProviderService=i.IThemeService=i.ICharacterJoinerService=i.ISelectionService=i.IRenderService=i.IMouseService=i.ICoreBrowserService=i.ICharSizeService=void 0;const a=n(8343);i.ICharSizeService=(0,a.createDecorator)("CharSizeService"),i.ICoreBrowserService=(0,a.createDecorator)("CoreBrowserService"),i.IMouseService=(0,a.createDecorator)("MouseService"),i.IRenderService=(0,a.createDecorator)("RenderService"),i.ISelectionService=(0,a.createDecorator)("SelectionService"),i.ICharacterJoinerService=(0,a.createDecorator)("CharacterJoinerService"),i.IThemeService=(0,a.createDecorator)("ThemeService"),i.ILinkProviderService=(0,a.createDecorator)("LinkProviderService")},6731:function(b,i,n){var a=this&&this.__decorate||function(g,u,m,B){var A,O=arguments.length,L=O<3?u:B===null?B=Object.getOwnPropertyDescriptor(u,m):B;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")L=Reflect.decorate(g,u,m,B);else for(var T=g.length-1;T>=0;T--)(A=g[T])&&(L=(O<3?A(L):O>3?A(u,m,L):A(u,m))||L);return O>3&&L&&Object.defineProperty(u,m,L),L},l=this&&this.__param||function(g,u){return function(m,B){u(m,B,g)}};Object.defineProperty(i,"__esModule",{value:!0}),i.ThemeService=i.DEFAULT_ANSI_COLORS=void 0;const o=n(7239),c=n(8055),f=n(8460),v=n(844),d=n(2585),t=c.css.toColor("#ffffff"),s=c.css.toColor("#000000"),e=c.css.toColor("#ffffff"),r=c.css.toColor("#000000"),h={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117};i.DEFAULT_ANSI_COLORS=Object.freeze((()=>{const g=[c.css.toColor("#2e3436"),c.css.toColor("#cc0000"),c.css.toColor("#4e9a06"),c.css.toColor("#c4a000"),c.css.toColor("#3465a4"),c.css.toColor("#75507b"),c.css.toColor("#06989a"),c.css.toColor("#d3d7cf"),c.css.toColor("#555753"),c.css.toColor("#ef2929"),c.css.toColor("#8ae234"),c.css.toColor("#fce94f"),c.css.toColor("#729fcf"),c.css.toColor("#ad7fa8"),c.css.toColor("#34e2e2"),c.css.toColor("#eeeeec")],u=[0,95,135,175,215,255];for(let m=0;m<216;m++){const B=u[m/36%6|0],A=u[m/6%6|0],O=u[m%6];g.push({css:c.channels.toCss(B,A,O),rgba:c.channels.toRgba(B,A,O)})}for(let m=0;m<24;m++){const B=8+10*m;g.push({css:c.channels.toCss(B,B,B),rgba:c.channels.toRgba(B,B,B)})}return g})());let _=i.ThemeService=class extends v.Disposable{get colors(){return this._colors}constructor(g){super(),this._optionsService=g,this._contrastCache=new o.ColorContrastCache,this._halfContrastCache=new o.ColorContrastCache,this._onChangeColors=this.register(new f.EventEmitter),this.onChangeColors=this._onChangeColors.event,this._colors={foreground:t,background:s,cursor:e,cursorAccent:r,selectionForeground:void 0,selectionBackgroundTransparent:h,selectionBackgroundOpaque:c.color.blend(s,h),selectionInactiveBackgroundTransparent:h,selectionInactiveBackgroundOpaque:c.color.blend(s,h),ansi:i.DEFAULT_ANSI_COLORS.slice(),contrastCache:this._contrastCache,halfContrastCache:this._halfContrastCache},this._updateRestoreColors(),this._setTheme(this._optionsService.rawOptions.theme),this.register(this._optionsService.onSpecificOptionChange("minimumContrastRatio",(()=>this._contrastCache.clear()))),this.register(this._optionsService.onSpecificOptionChange("theme",(()=>this._setTheme(this._optionsService.rawOptions.theme))))}_setTheme(g={}){const u=this._colors;if(u.foreground=p(g.foreground,t),u.background=p(g.background,s),u.cursor=p(g.cursor,e),u.cursorAccent=p(g.cursorAccent,r),u.selectionBackgroundTransparent=p(g.selectionBackground,h),u.selectionBackgroundOpaque=c.color.blend(u.background,u.selectionBackgroundTransparent),u.selectionInactiveBackgroundTransparent=p(g.selectionInactiveBackground,u.selectionBackgroundTransparent),u.selectionInactiveBackgroundOpaque=c.color.blend(u.background,u.selectionInactiveBackgroundTransparent),u.selectionForeground=g.selectionForeground?p(g.selectionForeground,c.NULL_COLOR):void 0,u.selectionForeground===c.NULL_COLOR&&(u.selectionForeground=void 0),c.color.isOpaque(u.selectionBackgroundTransparent)&&(u.selectionBackgroundTransparent=c.color.opacity(u.selectionBackgroundTransparent,.3)),c.color.isOpaque(u.selectionInactiveBackgroundTransparent)&&(u.selectionInactiveBackgroundTransparent=c.color.opacity(u.selectionInactiveBackgroundTransparent,.3)),u.ansi=i.DEFAULT_ANSI_COLORS.slice(),u.ansi[0]=p(g.black,i.DEFAULT_ANSI_COLORS[0]),u.ansi[1]=p(g.red,i.DEFAULT_ANSI_COLORS[1]),u.ansi[2]=p(g.green,i.DEFAULT_ANSI_COLORS[2]),u.ansi[3]=p(g.yellow,i.DEFAULT_ANSI_COLORS[3]),u.ansi[4]=p(g.blue,i.DEFAULT_ANSI_COLORS[4]),u.ansi[5]=p(g.magenta,i.DEFAULT_ANSI_COLORS[5]),u.ansi[6]=p(g.cyan,i.DEFAULT_ANSI_COLORS[6]),u.ansi[7]=p(g.white,i.DEFAULT_ANSI_COLORS[7]),u.ansi[8]=p(g.brightBlack,i.DEFAULT_ANSI_COLORS[8]),u.ansi[9]=p(g.brightRed,i.DEFAULT_ANSI_COLORS[9]),u.ansi[10]=p(g.brightGreen,i.DEFAULT_ANSI_COLORS[10]),u.ansi[11]=p(g.brightYellow,i.DEFAULT_ANSI_COLORS[11]),u.ansi[12]=p(g.brightBlue,i.DEFAULT_ANSI_COLORS[12]),u.ansi[13]=p(g.brightMagenta,i.DEFAULT_ANSI_COLORS[13]),u.ansi[14]=p(g.brightCyan,i.DEFAULT_ANSI_COLORS[14]),u.ansi[15]=p(g.brightWhite,i.DEFAULT_ANSI_COLORS[15]),g.extendedAnsi){const m=Math.min(u.ansi.length-16,g.extendedAnsi.length);for(let B=0;B<m;B++)u.ansi[B+16]=p(g.extendedAnsi[B],i.DEFAULT_ANSI_COLORS[B+16])}this._contrastCache.clear(),this._halfContrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}restoreColor(g){this._restoreColor(g),this._onChangeColors.fire(this.colors)}_restoreColor(g){if(g!==void 0)switch(g){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[g]=this._restoreColors.ansi[g]}else for(let u=0;u<this._restoreColors.ansi.length;++u)this._colors.ansi[u]=this._restoreColors.ansi[u]}modifyColors(g){g(this._colors),this._onChangeColors.fire(this.colors)}_updateRestoreColors(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}};function p(g,u){if(g!==void 0)try{return c.css.toColor(g)}catch{}return u}i.ThemeService=_=a([l(0,d.IOptionsService)],_)},6349:(b,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.CircularList=void 0;const a=n(8460),l=n(844);class o extends l.Disposable{constructor(f){super(),this._maxLength=f,this.onDeleteEmitter=this.register(new a.EventEmitter),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this.register(new a.EventEmitter),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this.register(new a.EventEmitter),this.onTrim=this.onTrimEmitter.event,this._array=new Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength(f){if(this._maxLength===f)return;const v=new Array(f);for(let d=0;d<Math.min(f,this.length);d++)v[d]=this._array[this._getCyclicIndex(d)];this._array=v,this._maxLength=f,this._startIndex=0}get length(){return this._length}set length(f){if(f>this._length)for(let v=this._length;v<f;v++)this._array[v]=void 0;this._length=f}get(f){return this._array[this._getCyclicIndex(f)]}set(f,v){this._array[this._getCyclicIndex(f)]=v}push(f){this._array[this._getCyclicIndex(this._length)]=f,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw new Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice(f,v,...d){if(v){for(let t=f;t<this._length-v;t++)this._array[this._getCyclicIndex(t)]=this._array[this._getCyclicIndex(t+v)];this._length-=v,this.onDeleteEmitter.fire({index:f,amount:v})}for(let t=this._length-1;t>=f;t--)this._array[this._getCyclicIndex(t+d.length)]=this._array[this._getCyclicIndex(t)];for(let t=0;t<d.length;t++)this._array[this._getCyclicIndex(f+t)]=d[t];if(d.length&&this.onInsertEmitter.fire({index:f,amount:d.length}),this._length+d.length>this._maxLength){const t=this._length+d.length-this._maxLength;this._startIndex+=t,this._length=this._maxLength,this.onTrimEmitter.fire(t)}else this._length+=d.length}trimStart(f){f>this._length&&(f=this._length),this._startIndex+=f,this._length-=f,this.onTrimEmitter.fire(f)}shiftElements(f,v,d){if(!(v<=0)){if(f<0||f>=this._length)throw new Error("start argument out of range");if(f+d<0)throw new Error("Cannot shift elements in list beyond index 0");if(d>0){for(let s=v-1;s>=0;s--)this.set(f+s+d,this.get(f+s));const t=f+v+d-this._length;if(t>0)for(this._length+=t;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let t=0;t<v;t++)this.set(f+t+d,this.get(f+t))}}_getCyclicIndex(f){return(this._startIndex+f)%this._maxLength}}i.CircularList=o},1439:(b,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.clone=void 0,i.clone=function n(a,l=5){if(typeof a!="object")return a;const o=Array.isArray(a)?[]:{};for(const c in a)o[c]=l<=1?a[c]:a[c]&&n(a[c],l-1);return o}},8055:(b,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.contrastRatio=i.toPaddedHex=i.rgba=i.rgb=i.css=i.color=i.channels=i.NULL_COLOR=void 0;let n=0,a=0,l=0,o=0;var c,f,v,d,t;function s(r){const h=r.toString(16);return h.length<2?"0"+h:h}function e(r,h){return r<h?(h+.05)/(r+.05):(r+.05)/(h+.05)}i.NULL_COLOR={css:"#00000000",rgba:0},(function(r){r.toCss=function(h,_,p,g){return g!==void 0?`#${s(h)}${s(_)}${s(p)}${s(g)}`:`#${s(h)}${s(_)}${s(p)}`},r.toRgba=function(h,_,p,g=255){return(h<<24|_<<16|p<<8|g)>>>0},r.toColor=function(h,_,p,g){return{css:r.toCss(h,_,p,g),rgba:r.toRgba(h,_,p,g)}}})(c||(i.channels=c={})),(function(r){function h(_,p){return o=Math.round(255*p),[n,a,l]=t.toChannels(_.rgba),{css:c.toCss(n,a,l,o),rgba:c.toRgba(n,a,l,o)}}r.blend=function(_,p){if(o=(255&p.rgba)/255,o===1)return{css:p.css,rgba:p.rgba};const g=p.rgba>>24&255,u=p.rgba>>16&255,m=p.rgba>>8&255,B=_.rgba>>24&255,A=_.rgba>>16&255,O=_.rgba>>8&255;return n=B+Math.round((g-B)*o),a=A+Math.round((u-A)*o),l=O+Math.round((m-O)*o),{css:c.toCss(n,a,l),rgba:c.toRgba(n,a,l)}},r.isOpaque=function(_){return(255&_.rgba)==255},r.ensureContrastRatio=function(_,p,g){const u=t.ensureContrastRatio(_.rgba,p.rgba,g);if(u)return c.toColor(u>>24&255,u>>16&255,u>>8&255)},r.opaque=function(_){const p=(255|_.rgba)>>>0;return[n,a,l]=t.toChannels(p),{css:c.toCss(n,a,l),rgba:p}},r.opacity=h,r.multiplyOpacity=function(_,p){return o=255&_.rgba,h(_,o*p/255)},r.toColorRGB=function(_){return[_.rgba>>24&255,_.rgba>>16&255,_.rgba>>8&255]}})(f||(i.color=f={})),(function(r){let h,_;try{const p=document.createElement("canvas");p.width=1,p.height=1;const g=p.getContext("2d",{willReadFrequently:!0});g&&(h=g,h.globalCompositeOperation="copy",_=h.createLinearGradient(0,0,1,1))}catch{}r.toColor=function(p){if(p.match(/#[\da-f]{3,8}/i))switch(p.length){case 4:return n=parseInt(p.slice(1,2).repeat(2),16),a=parseInt(p.slice(2,3).repeat(2),16),l=parseInt(p.slice(3,4).repeat(2),16),c.toColor(n,a,l);case 5:return n=parseInt(p.slice(1,2).repeat(2),16),a=parseInt(p.slice(2,3).repeat(2),16),l=parseInt(p.slice(3,4).repeat(2),16),o=parseInt(p.slice(4,5).repeat(2),16),c.toColor(n,a,l,o);case 7:return{css:p,rgba:(parseInt(p.slice(1),16)<<8|255)>>>0};case 9:return{css:p,rgba:parseInt(p.slice(1),16)>>>0}}const g=p.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(g)return n=parseInt(g[1]),a=parseInt(g[2]),l=parseInt(g[3]),o=Math.round(255*(g[5]===void 0?1:parseFloat(g[5]))),c.toColor(n,a,l,o);if(!h||!_)throw new Error("css.toColor: Unsupported css format");if(h.fillStyle=_,h.fillStyle=p,typeof h.fillStyle!="string")throw new Error("css.toColor: Unsupported css format");if(h.fillRect(0,0,1,1),[n,a,l,o]=h.getImageData(0,0,1,1).data,o!==255)throw new Error("css.toColor: Unsupported css format");return{rgba:c.toRgba(n,a,l,o),css:p}}})(v||(i.css=v={})),(function(r){function h(_,p,g){const u=_/255,m=p/255,B=g/255;return .2126*(u<=.03928?u/12.92:Math.pow((u+.055)/1.055,2.4))+.7152*(m<=.03928?m/12.92:Math.pow((m+.055)/1.055,2.4))+.0722*(B<=.03928?B/12.92:Math.pow((B+.055)/1.055,2.4))}r.relativeLuminance=function(_){return h(_>>16&255,_>>8&255,255&_)},r.relativeLuminance2=h})(d||(i.rgb=d={})),(function(r){function h(p,g,u){const m=p>>24&255,B=p>>16&255,A=p>>8&255;let O=g>>24&255,L=g>>16&255,T=g>>8&255,H=e(d.relativeLuminance2(O,L,T),d.relativeLuminance2(m,B,A));for(;H<u&&(O>0||L>0||T>0);)O-=Math.max(0,Math.ceil(.1*O)),L-=Math.max(0,Math.ceil(.1*L)),T-=Math.max(0,Math.ceil(.1*T)),H=e(d.relativeLuminance2(O,L,T),d.relativeLuminance2(m,B,A));return(O<<24|L<<16|T<<8|255)>>>0}function _(p,g,u){const m=p>>24&255,B=p>>16&255,A=p>>8&255;let O=g>>24&255,L=g>>16&255,T=g>>8&255,H=e(d.relativeLuminance2(O,L,T),d.relativeLuminance2(m,B,A));for(;H<u&&(O<255||L<255||T<255);)O=Math.min(255,O+Math.ceil(.1*(255-O))),L=Math.min(255,L+Math.ceil(.1*(255-L))),T=Math.min(255,T+Math.ceil(.1*(255-T))),H=e(d.relativeLuminance2(O,L,T),d.relativeLuminance2(m,B,A));return(O<<24|L<<16|T<<8|255)>>>0}r.blend=function(p,g){if(o=(255&g)/255,o===1)return g;const u=g>>24&255,m=g>>16&255,B=g>>8&255,A=p>>24&255,O=p>>16&255,L=p>>8&255;return n=A+Math.round((u-A)*o),a=O+Math.round((m-O)*o),l=L+Math.round((B-L)*o),c.toRgba(n,a,l)},r.ensureContrastRatio=function(p,g,u){const m=d.relativeLuminance(p>>8),B=d.relativeLuminance(g>>8);if(e(m,B)<u){if(B<m){const L=h(p,g,u),T=e(m,d.relativeLuminance(L>>8));if(T<u){const H=_(p,g,u);return T>e(m,d.relativeLuminance(H>>8))?L:H}return L}const A=_(p,g,u),O=e(m,d.relativeLuminance(A>>8));if(O<u){const L=h(p,g,u);return O>e(m,d.relativeLuminance(L>>8))?A:L}return A}},r.reduceLuminance=h,r.increaseLuminance=_,r.toChannels=function(p){return[p>>24&255,p>>16&255,p>>8&255,255&p]}})(t||(i.rgba=t={})),i.toPaddedHex=s,i.contrastRatio=e},8969:(b,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.CoreTerminal=void 0;const a=n(844),l=n(2585),o=n(4348),c=n(7866),f=n(744),v=n(7302),d=n(6975),t=n(8460),s=n(1753),e=n(1480),r=n(7994),h=n(9282),_=n(5435),p=n(5981),g=n(2660);let u=!1;class m extends a.Disposable{get onScroll(){return this._onScrollApi||(this._onScrollApi=this.register(new t.EventEmitter),this._onScroll.event((A=>{this._onScrollApi?.fire(A.position)}))),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options(A){for(const O in A)this.optionsService.options[O]=A[O]}constructor(A){super(),this._windowsWrappingHeuristics=this.register(new a.MutableDisposable),this._onBinary=this.register(new t.EventEmitter),this.onBinary=this._onBinary.event,this._onData=this.register(new t.EventEmitter),this.onData=this._onData.event,this._onLineFeed=this.register(new t.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onResize=this.register(new t.EventEmitter),this.onResize=this._onResize.event,this._onWriteParsed=this.register(new t.EventEmitter),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this.register(new t.EventEmitter),this._instantiationService=new o.InstantiationService,this.optionsService=this.register(new v.OptionsService(A)),this._instantiationService.setService(l.IOptionsService,this.optionsService),this._bufferService=this.register(this._instantiationService.createInstance(f.BufferService)),this._instantiationService.setService(l.IBufferService,this._bufferService),this._logService=this.register(this._instantiationService.createInstance(c.LogService)),this._instantiationService.setService(l.ILogService,this._logService),this.coreService=this.register(this._instantiationService.createInstance(d.CoreService)),this._instantiationService.setService(l.ICoreService,this.coreService),this.coreMouseService=this.register(this._instantiationService.createInstance(s.CoreMouseService)),this._instantiationService.setService(l.ICoreMouseService,this.coreMouseService),this.unicodeService=this.register(this._instantiationService.createInstance(e.UnicodeService)),this._instantiationService.setService(l.IUnicodeService,this.unicodeService),this._charsetService=this._instantiationService.createInstance(r.CharsetService),this._instantiationService.setService(l.ICharsetService,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(g.OscLinkService),this._instantiationService.setService(l.IOscLinkService,this._oscLinkService),this._inputHandler=this.register(new _.InputHandler(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this.register((0,t.forwardEvent)(this._inputHandler.onLineFeed,this._onLineFeed)),this.register(this._inputHandler),this.register((0,t.forwardEvent)(this._bufferService.onResize,this._onResize)),this.register((0,t.forwardEvent)(this.coreService.onData,this._onData)),this.register((0,t.forwardEvent)(this.coreService.onBinary,this._onBinary)),this.register(this.coreService.onRequestScrollToBottom((()=>this.scrollToBottom()))),this.register(this.coreService.onUserInput((()=>this._writeBuffer.handleUserInput()))),this.register(this.optionsService.onMultipleOptionChange(["windowsMode","windowsPty"],(()=>this._handleWindowsPtyOptionChange()))),this.register(this._bufferService.onScroll((O=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)}))),this.register(this._inputHandler.onScroll((O=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)}))),this._writeBuffer=this.register(new p.WriteBuffer(((O,L)=>this._inputHandler.parse(O,L)))),this.register((0,t.forwardEvent)(this._writeBuffer.onWriteParsed,this._onWriteParsed))}write(A,O){this._writeBuffer.write(A,O)}writeSync(A,O){this._logService.logLevel<=l.LogLevelEnum.WARN&&!u&&(this._logService.warn("writeSync is unreliable and will be removed soon."),u=!0),this._writeBuffer.writeSync(A,O)}input(A,O=!0){this.coreService.triggerDataEvent(A,O)}resize(A,O){isNaN(A)||isNaN(O)||(A=Math.max(A,f.MINIMUM_COLS),O=Math.max(O,f.MINIMUM_ROWS),this._bufferService.resize(A,O))}scroll(A,O=!1){this._bufferService.scroll(A,O)}scrollLines(A,O,L){this._bufferService.scrollLines(A,O,L)}scrollPages(A){this.scrollLines(A*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(){this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(A){const O=A-this._bufferService.buffer.ydisp;O!==0&&this.scrollLines(O)}registerEscHandler(A,O){return this._inputHandler.registerEscHandler(A,O)}registerDcsHandler(A,O){return this._inputHandler.registerDcsHandler(A,O)}registerCsiHandler(A,O){return this._inputHandler.registerCsiHandler(A,O)}registerOscHandler(A,O){return this._inputHandler.registerOscHandler(A,O)}_setup(){this._handleWindowsPtyOptionChange()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsPtyOptionChange(){let A=!1;const O=this.optionsService.rawOptions.windowsPty;O&&O.buildNumber!==void 0&&O.buildNumber!==void 0?A=O.backend==="conpty"&&O.buildNumber<21376:this.optionsService.rawOptions.windowsMode&&(A=!0),A?this._enableWindowsWrappingHeuristics():this._windowsWrappingHeuristics.clear()}_enableWindowsWrappingHeuristics(){if(!this._windowsWrappingHeuristics.value){const A=[];A.push(this.onLineFeed(h.updateWindowsModeWrappedState.bind(null,this._bufferService))),A.push(this.registerCsiHandler({final:"H"},(()=>((0,h.updateWindowsModeWrappedState)(this._bufferService),!1)))),this._windowsWrappingHeuristics.value=(0,a.toDisposable)((()=>{for(const O of A)O.dispose()}))}}}i.CoreTerminal=m},8460:(b,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.runAndSubscribe=i.forwardEvent=i.EventEmitter=void 0,i.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=n=>(this._listeners.push(n),{dispose:()=>{if(!this._disposed){for(let a=0;a<this._listeners.length;a++)if(this._listeners[a]===n)return void this._listeners.splice(a,1)}}})),this._event}fire(n,a){const l=[];for(let o=0;o<this._listeners.length;o++)l.push(this._listeners[o]);for(let o=0;o<l.length;o++)l[o].call(void 0,n,a)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},i.forwardEvent=function(n,a){return n((l=>a.fire(l)))},i.runAndSubscribe=function(n,a){return a(void 0),n((l=>a(l)))}},5435:function(b,i,n){var a=this&&this.__decorate||function(U,w,M,R){var I,W=arguments.length,K=W<3?w:R===null?R=Object.getOwnPropertyDescriptor(w,M):R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")K=Reflect.decorate(U,w,M,R);else for(var Y=U.length-1;Y>=0;Y--)(I=U[Y])&&(K=(W<3?I(K):W>3?I(w,M,K):I(w,M))||K);return W>3&&K&&Object.defineProperty(w,M,K),K},l=this&&this.__param||function(U,w){return function(M,R){w(M,R,U)}};Object.defineProperty(i,"__esModule",{value:!0}),i.InputHandler=i.WindowsOptionsReportType=void 0;const o=n(2584),c=n(7116),f=n(2015),v=n(844),d=n(482),t=n(8437),s=n(8460),e=n(643),r=n(511),h=n(3734),_=n(2585),p=n(1480),g=n(6242),u=n(6351),m=n(5941),B={"(":0,")":1,"*":2,"+":3,"-":1,".":2},A=131072;function O(U,w){if(U>24)return w.setWinLines||!1;switch(U){case 1:return!!w.restoreWin;case 2:return!!w.minimizeWin;case 3:return!!w.setWinPosition;case 4:return!!w.setWinSizePixels;case 5:return!!w.raiseWin;case 6:return!!w.lowerWin;case 7:return!!w.refreshWin;case 8:return!!w.setWinSizeChars;case 9:return!!w.maximizeWin;case 10:return!!w.fullscreenWin;case 11:return!!w.getWinState;case 13:return!!w.getWinPosition;case 14:return!!w.getWinSizePixels;case 15:return!!w.getScreenSizePixels;case 16:return!!w.getCellSizePixels;case 18:return!!w.getWinSizeChars;case 19:return!!w.getScreenSizeChars;case 20:return!!w.getIconTitle;case 21:return!!w.getWinTitle;case 22:return!!w.pushTitle;case 23:return!!w.popTitle;case 24:return!!w.setWinLines}return!1}var L;(function(U){U[U.GET_WIN_SIZE_PIXELS=0]="GET_WIN_SIZE_PIXELS",U[U.GET_CELL_SIZE_PIXELS=1]="GET_CELL_SIZE_PIXELS"})(L||(i.WindowsOptionsReportType=L={}));let T=0;class H extends v.Disposable{getAttrData(){return this._curAttrData}constructor(w,M,R,I,W,K,Y,J,P=new f.EscapeSequenceParser){super(),this._bufferService=w,this._charsetService=M,this._coreService=R,this._logService=I,this._optionsService=W,this._oscLinkService=K,this._coreMouseService=Y,this._unicodeService=J,this._parser=P,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new d.StringToUtf32,this._utf8Decoder=new d.Utf8ToUtf32,this._workCell=new r.CellData,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=t.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=t.DEFAULT_ATTR_DATA.clone(),this._onRequestBell=this.register(new s.EventEmitter),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this.register(new s.EventEmitter),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this.register(new s.EventEmitter),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this.register(new s.EventEmitter),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this.register(new s.EventEmitter),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this.register(new s.EventEmitter),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this.register(new s.EventEmitter),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this.register(new s.EventEmitter),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this.register(new s.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this.register(new s.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onScroll=this.register(new s.EventEmitter),this.onScroll=this._onScroll.event,this._onTitleChange=this.register(new s.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onColor=this.register(new s.EventEmitter),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this.register(this._parser),this._dirtyRowTracker=new $(this._bufferService),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate((x=>this._activeBuffer=x.activeBuffer))),this._parser.setCsiHandlerFallback(((x,N)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(x),params:N.toArray()})})),this._parser.setEscHandlerFallback((x=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(x)})})),this._parser.setExecuteHandlerFallback((x=>{this._logService.debug("Unknown EXECUTE code: ",{code:x})})),this._parser.setOscHandlerFallback(((x,N,z)=>{this._logService.debug("Unknown OSC code: ",{identifier:x,action:N,data:z})})),this._parser.setDcsHandlerFallback(((x,N,z)=>{N==="HOOK"&&(z=z.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(x),action:N,payload:z})})),this._parser.setPrintHandler(((x,N,z)=>this.print(x,N,z))),this._parser.registerCsiHandler({final:"@"},(x=>this.insertChars(x))),this._parser.registerCsiHandler({intermediates:" ",final:"@"},(x=>this.scrollLeft(x))),this._parser.registerCsiHandler({final:"A"},(x=>this.cursorUp(x))),this._parser.registerCsiHandler({intermediates:" ",final:"A"},(x=>this.scrollRight(x))),this._parser.registerCsiHandler({final:"B"},(x=>this.cursorDown(x))),this._parser.registerCsiHandler({final:"C"},(x=>this.cursorForward(x))),this._parser.registerCsiHandler({final:"D"},(x=>this.cursorBackward(x))),this._parser.registerCsiHandler({final:"E"},(x=>this.cursorNextLine(x))),this._parser.registerCsiHandler({final:"F"},(x=>this.cursorPrecedingLine(x))),this._parser.registerCsiHandler({final:"G"},(x=>this.cursorCharAbsolute(x))),this._parser.registerCsiHandler({final:"H"},(x=>this.cursorPosition(x))),this._parser.registerCsiHandler({final:"I"},(x=>this.cursorForwardTab(x))),this._parser.registerCsiHandler({final:"J"},(x=>this.eraseInDisplay(x,!1))),this._parser.registerCsiHandler({prefix:"?",final:"J"},(x=>this.eraseInDisplay(x,!0))),this._parser.registerCsiHandler({final:"K"},(x=>this.eraseInLine(x,!1))),this._parser.registerCsiHandler({prefix:"?",final:"K"},(x=>this.eraseInLine(x,!0))),this._parser.registerCsiHandler({final:"L"},(x=>this.insertLines(x))),this._parser.registerCsiHandler({final:"M"},(x=>this.deleteLines(x))),this._parser.registerCsiHandler({final:"P"},(x=>this.deleteChars(x))),this._parser.registerCsiHandler({final:"S"},(x=>this.scrollUp(x))),this._parser.registerCsiHandler({final:"T"},(x=>this.scrollDown(x))),this._parser.registerCsiHandler({final:"X"},(x=>this.eraseChars(x))),this._parser.registerCsiHandler({final:"Z"},(x=>this.cursorBackwardTab(x))),this._parser.registerCsiHandler({final:"`"},(x=>this.charPosAbsolute(x))),this._parser.registerCsiHandler({final:"a"},(x=>this.hPositionRelative(x))),this._parser.registerCsiHandler({final:"b"},(x=>this.repeatPrecedingCharacter(x))),this._parser.registerCsiHandler({final:"c"},(x=>this.sendDeviceAttributesPrimary(x))),this._parser.registerCsiHandler({prefix:">",final:"c"},(x=>this.sendDeviceAttributesSecondary(x))),this._parser.registerCsiHandler({final:"d"},(x=>this.linePosAbsolute(x))),this._parser.registerCsiHandler({final:"e"},(x=>this.vPositionRelative(x))),this._parser.registerCsiHandler({final:"f"},(x=>this.hVPosition(x))),this._parser.registerCsiHandler({final:"g"},(x=>this.tabClear(x))),this._parser.registerCsiHandler({final:"h"},(x=>this.setMode(x))),this._parser.registerCsiHandler({prefix:"?",final:"h"},(x=>this.setModePrivate(x))),this._parser.registerCsiHandler({final:"l"},(x=>this.resetMode(x))),this._parser.registerCsiHandler({prefix:"?",final:"l"},(x=>this.resetModePrivate(x))),this._parser.registerCsiHandler({final:"m"},(x=>this.charAttributes(x))),this._parser.registerCsiHandler({final:"n"},(x=>this.deviceStatus(x))),this._parser.registerCsiHandler({prefix:"?",final:"n"},(x=>this.deviceStatusPrivate(x))),this._parser.registerCsiHandler({intermediates:"!",final:"p"},(x=>this.softReset(x))),this._parser.registerCsiHandler({intermediates:" ",final:"q"},(x=>this.setCursorStyle(x))),this._parser.registerCsiHandler({final:"r"},(x=>this.setScrollRegion(x))),this._parser.registerCsiHandler({final:"s"},(x=>this.saveCursor(x))),this._parser.registerCsiHandler({final:"t"},(x=>this.windowOptions(x))),this._parser.registerCsiHandler({final:"u"},(x=>this.restoreCursor(x))),this._parser.registerCsiHandler({intermediates:"'",final:"}"},(x=>this.insertColumns(x))),this._parser.registerCsiHandler({intermediates:"'",final:"~"},(x=>this.deleteColumns(x))),this._parser.registerCsiHandler({intermediates:'"',final:"q"},(x=>this.selectProtected(x))),this._parser.registerCsiHandler({intermediates:"$",final:"p"},(x=>this.requestMode(x,!0))),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},(x=>this.requestMode(x,!1))),this._parser.setExecuteHandler(o.C0.BEL,(()=>this.bell())),this._parser.setExecuteHandler(o.C0.LF,(()=>this.lineFeed())),this._parser.setExecuteHandler(o.C0.VT,(()=>this.lineFeed())),this._parser.setExecuteHandler(o.C0.FF,(()=>this.lineFeed())),this._parser.setExecuteHandler(o.C0.CR,(()=>this.carriageReturn())),this._parser.setExecuteHandler(o.C0.BS,(()=>this.backspace())),this._parser.setExecuteHandler(o.C0.HT,(()=>this.tab())),this._parser.setExecuteHandler(o.C0.SO,(()=>this.shiftOut())),this._parser.setExecuteHandler(o.C0.SI,(()=>this.shiftIn())),this._parser.setExecuteHandler(o.C1.IND,(()=>this.index())),this._parser.setExecuteHandler(o.C1.NEL,(()=>this.nextLine())),this._parser.setExecuteHandler(o.C1.HTS,(()=>this.tabSet())),this._parser.registerOscHandler(0,new g.OscHandler((x=>(this.setTitle(x),this.setIconName(x),!0)))),this._parser.registerOscHandler(1,new g.OscHandler((x=>this.setIconName(x)))),this._parser.registerOscHandler(2,new g.OscHandler((x=>this.setTitle(x)))),this._parser.registerOscHandler(4,new g.OscHandler((x=>this.setOrReportIndexedColor(x)))),this._parser.registerOscHandler(8,new g.OscHandler((x=>this.setHyperlink(x)))),this._parser.registerOscHandler(10,new g.OscHandler((x=>this.setOrReportFgColor(x)))),this._parser.registerOscHandler(11,new g.OscHandler((x=>this.setOrReportBgColor(x)))),this._parser.registerOscHandler(12,new g.OscHandler((x=>this.setOrReportCursorColor(x)))),this._parser.registerOscHandler(104,new g.OscHandler((x=>this.restoreIndexedColor(x)))),this._parser.registerOscHandler(110,new g.OscHandler((x=>this.restoreFgColor(x)))),this._parser.registerOscHandler(111,new g.OscHandler((x=>this.restoreBgColor(x)))),this._parser.registerOscHandler(112,new g.OscHandler((x=>this.restoreCursorColor(x)))),this._parser.registerEscHandler({final:"7"},(()=>this.saveCursor())),this._parser.registerEscHandler({final:"8"},(()=>this.restoreCursor())),this._parser.registerEscHandler({final:"D"},(()=>this.index())),this._parser.registerEscHandler({final:"E"},(()=>this.nextLine())),this._parser.registerEscHandler({final:"H"},(()=>this.tabSet())),this._parser.registerEscHandler({final:"M"},(()=>this.reverseIndex())),this._parser.registerEscHandler({final:"="},(()=>this.keypadApplicationMode())),this._parser.registerEscHandler({final:">"},(()=>this.keypadNumericMode())),this._parser.registerEscHandler({final:"c"},(()=>this.fullReset())),this._parser.registerEscHandler({final:"n"},(()=>this.setgLevel(2))),this._parser.registerEscHandler({final:"o"},(()=>this.setgLevel(3))),this._parser.registerEscHandler({final:"|"},(()=>this.setgLevel(3))),this._parser.registerEscHandler({final:"}"},(()=>this.setgLevel(2))),this._parser.registerEscHandler({final:"~"},(()=>this.setgLevel(1))),this._parser.registerEscHandler({intermediates:"%",final:"@"},(()=>this.selectDefaultCharset())),this._parser.registerEscHandler({intermediates:"%",final:"G"},(()=>this.selectDefaultCharset()));for(const x in c.CHARSETS)this._parser.registerEscHandler({intermediates:"(",final:x},(()=>this.selectCharset("("+x))),this._parser.registerEscHandler({intermediates:")",final:x},(()=>this.selectCharset(")"+x))),this._parser.registerEscHandler({intermediates:"*",final:x},(()=>this.selectCharset("*"+x))),this._parser.registerEscHandler({intermediates:"+",final:x},(()=>this.selectCharset("+"+x))),this._parser.registerEscHandler({intermediates:"-",final:x},(()=>this.selectCharset("-"+x))),this._parser.registerEscHandler({intermediates:".",final:x},(()=>this.selectCharset("."+x))),this._parser.registerEscHandler({intermediates:"/",final:x},(()=>this.selectCharset("/"+x)));this._parser.registerEscHandler({intermediates:"#",final:"8"},(()=>this.screenAlignmentPattern())),this._parser.setErrorHandler((x=>(this._logService.error("Parsing error: ",x),x))),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new u.DcsHandler(((x,N)=>this.requestStatusString(x,N))))}_preserveStack(w,M,R,I){this._parseStack.paused=!0,this._parseStack.cursorStartX=w,this._parseStack.cursorStartY=M,this._parseStack.decodedLength=R,this._parseStack.position=I}_logSlowResolvingAsync(w){this._logService.logLevel<=_.LogLevelEnum.WARN&&Promise.race([w,new Promise(((M,R)=>setTimeout((()=>R("#SLOW_TIMEOUT")),5e3)))]).catch((M=>{if(M!=="#SLOW_TIMEOUT")throw M;console.warn("async parser handler taking longer than 5000 ms")}))}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse(w,M){let R,I=this._activeBuffer.x,W=this._activeBuffer.y,K=0;const Y=this._parseStack.paused;if(Y){if(R=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,M))return this._logSlowResolvingAsync(R),R;I=this._parseStack.cursorStartX,W=this._parseStack.cursorStartY,this._parseStack.paused=!1,w.length>A&&(K=this._parseStack.position+A)}if(this._logService.logLevel<=_.LogLevelEnum.DEBUG&&this._logService.debug("parsing data"+(typeof w=="string"?` "${w}"`:` "${Array.prototype.map.call(w,(x=>String.fromCharCode(x))).join("")}"`),typeof w=="string"?w.split("").map((x=>x.charCodeAt(0))):w),this._parseBuffer.length<w.length&&this._parseBuffer.length<A&&(this._parseBuffer=new Uint32Array(Math.min(w.length,A))),Y||this._dirtyRowTracker.clearRange(),w.length>A)for(let x=K;x<w.length;x+=A){const N=x+A<w.length?x+A:w.length,z=typeof w=="string"?this._stringDecoder.decode(w.substring(x,N),this._parseBuffer):this._utf8Decoder.decode(w.subarray(x,N),this._parseBuffer);if(R=this._parser.parse(this._parseBuffer,z))return this._preserveStack(I,W,z,x),this._logSlowResolvingAsync(R),R}else if(!Y){const x=typeof w=="string"?this._stringDecoder.decode(w,this._parseBuffer):this._utf8Decoder.decode(w,this._parseBuffer);if(R=this._parser.parse(this._parseBuffer,x))return this._preserveStack(I,W,x,0),this._logSlowResolvingAsync(R),R}this._activeBuffer.x===I&&this._activeBuffer.y===W||this._onCursorMove.fire();const J=this._dirtyRowTracker.end+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp),P=this._dirtyRowTracker.start+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp);P<this._bufferService.rows&&this._onRequestRefreshRows.fire(Math.min(P,this._bufferService.rows-1),Math.min(J,this._bufferService.rows-1))}print(w,M,R){let I,W;const K=this._charsetService.charset,Y=this._optionsService.rawOptions.screenReaderMode,J=this._bufferService.cols,P=this._coreService.decPrivateModes.wraparound,x=this._coreService.modes.insertMode,N=this._curAttrData;let z=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&R-M>0&&z.getWidth(this._activeBuffer.x-1)===2&&z.setCellFromCodepoint(this._activeBuffer.x-1,0,1,N);let V=this._parser.precedingJoinState;for(let q=M;q<R;++q){if(I=w[q],I<127&&K){const ce=K[String.fromCharCode(I)];ce&&(I=ce.charCodeAt(0))}const te=this._unicodeService.charProperties(I,V);W=p.UnicodeService.extractWidth(te);const ne=p.UnicodeService.extractShouldJoin(te),oe=ne?p.UnicodeService.extractWidth(V):0;if(V=te,Y&&this._onA11yChar.fire((0,d.stringFromCodePoint)(I)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),this._activeBuffer.x+W-oe>J){if(P){const ce=z;let Q=this._activeBuffer.x-oe;for(this._activeBuffer.x=oe,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),z=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y),oe>0&&z instanceof t.BufferLine&&z.copyCellsFrom(ce,Q,0,oe,!1);Q<J;)ce.setCellFromCodepoint(Q++,0,1,N)}else if(this._activeBuffer.x=J-1,W===2)continue}if(ne&&this._activeBuffer.x){const ce=z.getWidth(this._activeBuffer.x-1)?1:2;z.addCodepointToCell(this._activeBuffer.x-ce,I,W);for(let Q=W-oe;--Q>=0;)z.setCellFromCodepoint(this._activeBuffer.x++,0,0,N)}else if(x&&(z.insertCells(this._activeBuffer.x,W-oe,this._activeBuffer.getNullCell(N)),z.getWidth(J-1)===2&&z.setCellFromCodepoint(J-1,e.NULL_CELL_CODE,e.NULL_CELL_WIDTH,N)),z.setCellFromCodepoint(this._activeBuffer.x++,I,W,N),W>0)for(;--W;)z.setCellFromCodepoint(this._activeBuffer.x++,0,0,N)}this._parser.precedingJoinState=V,this._activeBuffer.x<J&&R-M>0&&z.getWidth(this._activeBuffer.x)===0&&!z.hasContent(this._activeBuffer.x)&&z.setCellFromCodepoint(this._activeBuffer.x,0,1,N),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler(w,M){return w.final!=="t"||w.prefix||w.intermediates?this._parser.registerCsiHandler(w,M):this._parser.registerCsiHandler(w,(R=>!O(R.params[0],this._optionsService.rawOptions.windowOptions)||M(R)))}registerDcsHandler(w,M){return this._parser.registerDcsHandler(w,new u.DcsHandler(M))}registerEscHandler(w,M){return this._parser.registerEscHandler(w,M)}registerOscHandler(w,M){return this._parser.registerOscHandler(w,new g.OscHandler(M))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows?this._activeBuffer.y=this._bufferService.rows-1:this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(this._activeBuffer.x===0&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y)?.isWrapped){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;const w=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);w.hasWidth(this._activeBuffer.x)&&!w.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;const w=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-w),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor(w=this._bufferService.cols-1){this._activeBuffer.x=Math.min(w,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor(w,M){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=w,this._activeBuffer.y=this._activeBuffer.scrollTop+M):(this._activeBuffer.x=w,this._activeBuffer.y=M),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor(w,M){this._restrictCursor(),this._setCursor(this._activeBuffer.x+w,this._activeBuffer.y+M)}cursorUp(w){const M=this._activeBuffer.y-this._activeBuffer.scrollTop;return M>=0?this._moveCursor(0,-Math.min(M,w.params[0]||1)):this._moveCursor(0,-(w.params[0]||1)),!0}cursorDown(w){const M=this._activeBuffer.scrollBottom-this._activeBuffer.y;return M>=0?this._moveCursor(0,Math.min(M,w.params[0]||1)):this._moveCursor(0,w.params[0]||1),!0}cursorForward(w){return this._moveCursor(w.params[0]||1,0),!0}cursorBackward(w){return this._moveCursor(-(w.params[0]||1),0),!0}cursorNextLine(w){return this.cursorDown(w),this._activeBuffer.x=0,!0}cursorPrecedingLine(w){return this.cursorUp(w),this._activeBuffer.x=0,!0}cursorCharAbsolute(w){return this._setCursor((w.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition(w){return this._setCursor(w.length>=2?(w.params[1]||1)-1:0,(w.params[0]||1)-1),!0}charPosAbsolute(w){return this._setCursor((w.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative(w){return this._moveCursor(w.params[0]||1,0),!0}linePosAbsolute(w){return this._setCursor(this._activeBuffer.x,(w.params[0]||1)-1),!0}vPositionRelative(w){return this._moveCursor(0,w.params[0]||1),!0}hVPosition(w){return this.cursorPosition(w),!0}tabClear(w){const M=w.params[0];return M===0?delete this._activeBuffer.tabs[this._activeBuffer.x]:M===3&&(this._activeBuffer.tabs={}),!0}cursorForwardTab(w){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let M=w.params[0]||1;for(;M--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab(w){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let M=w.params[0]||1;for(;M--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected(w){const M=w.params[0];return M===1&&(this._curAttrData.bg|=536870912),M!==2&&M!==0||(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine(w,M,R,I=!1,W=!1){const K=this._activeBuffer.lines.get(this._activeBuffer.ybase+w);K.replaceCells(M,R,this._activeBuffer.getNullCell(this._eraseAttrData()),W),I&&(K.isWrapped=!1)}_resetBufferLine(w,M=!1){const R=this._activeBuffer.lines.get(this._activeBuffer.ybase+w);R&&(R.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),M),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+w),R.isWrapped=!1)}eraseInDisplay(w,M=!1){let R;switch(this._restrictCursor(this._bufferService.cols),w.params[0]){case 0:for(R=this._activeBuffer.y,this._dirtyRowTracker.markDirty(R),this._eraseInBufferLine(R++,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,M);R<this._bufferService.rows;R++)this._resetBufferLine(R,M);this._dirtyRowTracker.markDirty(R);break;case 1:for(R=this._activeBuffer.y,this._dirtyRowTracker.markDirty(R),this._eraseInBufferLine(R,0,this._activeBuffer.x+1,!0,M),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(R+1).isWrapped=!1);R--;)this._resetBufferLine(R,M);this._dirtyRowTracker.markDirty(0);break;case 2:for(R=this._bufferService.rows,this._dirtyRowTracker.markDirty(R-1);R--;)this._resetBufferLine(R,M);this._dirtyRowTracker.markDirty(0);break;case 3:const I=this._activeBuffer.lines.length-this._bufferService.rows;I>0&&(this._activeBuffer.lines.trimStart(I),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-I,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-I,0),this._onScroll.fire(0))}return!0}eraseInLine(w,M=!1){switch(this._restrictCursor(this._bufferService.cols),w.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,M);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,M);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,M)}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines(w){this._restrictCursor();let M=w.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const R=this._activeBuffer.ybase+this._activeBuffer.y,I=this._bufferService.rows-1-this._activeBuffer.scrollBottom,W=this._bufferService.rows-1+this._activeBuffer.ybase-I+1;for(;M--;)this._activeBuffer.lines.splice(W-1,1),this._activeBuffer.lines.splice(R,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines(w){this._restrictCursor();let M=w.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const R=this._activeBuffer.ybase+this._activeBuffer.y;let I;for(I=this._bufferService.rows-1-this._activeBuffer.scrollBottom,I=this._bufferService.rows-1+this._activeBuffer.ybase-I;M--;)this._activeBuffer.lines.splice(R,1),this._activeBuffer.lines.splice(I,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars(w){this._restrictCursor();const M=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return M&&(M.insertCells(this._activeBuffer.x,w.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars(w){this._restrictCursor();const M=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return M&&(M.deleteCells(this._activeBuffer.x,w.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp(w){let M=w.params[0]||1;for(;M--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown(w){let M=w.params[0]||1;for(;M--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(t.DEFAULT_ATTR_DATA));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft(w){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const M=w.params[0]||1;for(let R=this._activeBuffer.scrollTop;R<=this._activeBuffer.scrollBottom;++R){const I=this._activeBuffer.lines.get(this._activeBuffer.ybase+R);I.deleteCells(0,M,this._activeBuffer.getNullCell(this._eraseAttrData())),I.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight(w){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const M=w.params[0]||1;for(let R=this._activeBuffer.scrollTop;R<=this._activeBuffer.scrollBottom;++R){const I=this._activeBuffer.lines.get(this._activeBuffer.ybase+R);I.insertCells(0,M,this._activeBuffer.getNullCell(this._eraseAttrData())),I.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns(w){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const M=w.params[0]||1;for(let R=this._activeBuffer.scrollTop;R<=this._activeBuffer.scrollBottom;++R){const I=this._activeBuffer.lines.get(this._activeBuffer.ybase+R);I.insertCells(this._activeBuffer.x,M,this._activeBuffer.getNullCell(this._eraseAttrData())),I.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns(w){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const M=w.params[0]||1;for(let R=this._activeBuffer.scrollTop;R<=this._activeBuffer.scrollBottom;++R){const I=this._activeBuffer.lines.get(this._activeBuffer.ybase+R);I.deleteCells(this._activeBuffer.x,M,this._activeBuffer.getNullCell(this._eraseAttrData())),I.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars(w){this._restrictCursor();const M=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return M&&(M.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(w.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter(w){const M=this._parser.precedingJoinState;if(!M)return!0;const R=w.params[0]||1,I=p.UnicodeService.extractWidth(M),W=this._activeBuffer.x-I,K=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).getString(W),Y=new Uint32Array(K.length*R);let J=0;for(let x=0;x<K.length;){const N=K.codePointAt(x)||0;Y[J++]=N,x+=N>65535?2:1}let P=J;for(let x=1;x<R;++x)Y.copyWithin(P,0,J),P+=J;return this.print(Y,0,P),!0}sendDeviceAttributesPrimary(w){return w.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(o.C0.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(o.C0.ESC+"[?6c")),!0}sendDeviceAttributesSecondary(w){return w.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(o.C0.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(o.C0.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(w.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(o.C0.ESC+"[>83;40003;0c")),!0}_is(w){return(this._optionsService.rawOptions.termName+"").indexOf(w)===0}setMode(w){for(let M=0;M<w.length;M++)switch(w.params[M]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0}return!0}setModePrivate(w){for(let M=0;M<w.length;M++)switch(w.params[M]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,c.DEFAULT_CHARSET),this._charsetService.setgCharset(1,c.DEFAULT_CHARSET),this._charsetService.setgCharset(2,c.DEFAULT_CHARSET),this._charsetService.setgCharset(3,c.DEFAULT_CHARSET);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1e3:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0}return!0}resetMode(w){for(let M=0;M<w.length;M++)switch(w.params[M]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1}return!0}resetModePrivate(w){for(let M=0;M<w.length;M++)switch(w.params[M]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1e3:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),w.params[M]===1049&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1}return!0}requestMode(w,M){const R=this._coreService.decPrivateModes,{activeProtocol:I,activeEncoding:W}=this._coreMouseService,K=this._coreService,{buffers:Y,cols:J}=this._bufferService,{active:P,alt:x}=Y,N=this._optionsService.rawOptions,z=ne=>ne?1:2,V=w.params[0];return q=V,te=M?V===2?4:V===4?z(K.modes.insertMode):V===12?3:V===20?z(N.convertEol):0:V===1?z(R.applicationCursorKeys):V===3?N.windowOptions.setWinLines?J===80?2:J===132?1:0:0:V===6?z(R.origin):V===7?z(R.wraparound):V===8?3:V===9?z(I==="X10"):V===12?z(N.cursorBlink):V===25?z(!K.isCursorHidden):V===45?z(R.reverseWraparound):V===66?z(R.applicationKeypad):V===67?4:V===1e3?z(I==="VT200"):V===1002?z(I==="DRAG"):V===1003?z(I==="ANY"):V===1004?z(R.sendFocus):V===1005?4:V===1006?z(W==="SGR"):V===1015?4:V===1016?z(W==="SGR_PIXELS"):V===1048?1:V===47||V===1047||V===1049?z(P===x):V===2004?z(R.bracketedPasteMode):0,K.triggerDataEvent(`${o.C0.ESC}[${M?"":"?"}${q};${te}$y`),!0;var q,te}_updateAttrColor(w,M,R,I,W){return M===2?(w|=50331648,w&=-16777216,w|=h.AttributeData.fromColorRGB([R,I,W])):M===5&&(w&=-50331904,w|=33554432|255&R),w}_extractColor(w,M,R){const I=[0,0,-1,0,0,0];let W=0,K=0;do{if(I[K+W]=w.params[M+K],w.hasSubParams(M+K)){const Y=w.getSubParams(M+K);let J=0;do I[1]===5&&(W=1),I[K+J+1+W]=Y[J];while(++J<Y.length&&J+K+1+W<I.length);break}if(I[1]===5&&K+W>=2||I[1]===2&&K+W>=5)break;I[1]&&(W=1)}while(++K+M<w.length&&K+W<I.length);for(let Y=2;Y<I.length;++Y)I[Y]===-1&&(I[Y]=0);switch(I[0]){case 38:R.fg=this._updateAttrColor(R.fg,I[1],I[3],I[4],I[5]);break;case 48:R.bg=this._updateAttrColor(R.bg,I[1],I[3],I[4],I[5]);break;case 58:R.extended=R.extended.clone(),R.extended.underlineColor=this._updateAttrColor(R.extended.underlineColor,I[1],I[3],I[4],I[5])}return K}_processUnderline(w,M){M.extended=M.extended.clone(),(!~w||w>5)&&(w=1),M.extended.underlineStyle=w,M.fg|=268435456,w===0&&(M.fg&=-268435457),M.updateExtended()}_processSGR0(w){w.fg=t.DEFAULT_ATTR_DATA.fg,w.bg=t.DEFAULT_ATTR_DATA.bg,w.extended=w.extended.clone(),w.extended.underlineStyle=0,w.extended.underlineColor&=-67108864,w.updateExtended()}charAttributes(w){if(w.length===1&&w.params[0]===0)return this._processSGR0(this._curAttrData),!0;const M=w.length;let R;const I=this._curAttrData;for(let W=0;W<M;W++)R=w.params[W],R>=30&&R<=37?(I.fg&=-50331904,I.fg|=16777216|R-30):R>=40&&R<=47?(I.bg&=-50331904,I.bg|=16777216|R-40):R>=90&&R<=97?(I.fg&=-50331904,I.fg|=16777224|R-90):R>=100&&R<=107?(I.bg&=-50331904,I.bg|=16777224|R-100):R===0?this._processSGR0(I):R===1?I.fg|=134217728:R===3?I.bg|=67108864:R===4?(I.fg|=268435456,this._processUnderline(w.hasSubParams(W)?w.getSubParams(W)[0]:1,I)):R===5?I.fg|=536870912:R===7?I.fg|=67108864:R===8?I.fg|=1073741824:R===9?I.fg|=2147483648:R===2?I.bg|=134217728:R===21?this._processUnderline(2,I):R===22?(I.fg&=-134217729,I.bg&=-134217729):R===23?I.bg&=-67108865:R===24?(I.fg&=-268435457,this._processUnderline(0,I)):R===25?I.fg&=-536870913:R===27?I.fg&=-67108865:R===28?I.fg&=-1073741825:R===29?I.fg&=2147483647:R===39?(I.fg&=-67108864,I.fg|=16777215&t.DEFAULT_ATTR_DATA.fg):R===49?(I.bg&=-67108864,I.bg|=16777215&t.DEFAULT_ATTR_DATA.bg):R===38||R===48||R===58?W+=this._extractColor(w,W,I):R===53?I.bg|=1073741824:R===55?I.bg&=-1073741825:R===59?(I.extended=I.extended.clone(),I.extended.underlineColor=-1,I.updateExtended()):R===100?(I.fg&=-67108864,I.fg|=16777215&t.DEFAULT_ATTR_DATA.fg,I.bg&=-67108864,I.bg|=16777215&t.DEFAULT_ATTR_DATA.bg):this._logService.debug("Unknown SGR attribute: %d.",R);return!0}deviceStatus(w){switch(w.params[0]){case 5:this._coreService.triggerDataEvent(`${o.C0.ESC}[0n`);break;case 6:const M=this._activeBuffer.y+1,R=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${o.C0.ESC}[${M};${R}R`)}return!0}deviceStatusPrivate(w){if(w.params[0]===6){const M=this._activeBuffer.y+1,R=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${o.C0.ESC}[?${M};${R}R`)}return!0}softReset(w){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=t.DEFAULT_ATTR_DATA.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle(w){const M=w.params[0]||1;switch(M){case 1:case 2:this._optionsService.options.cursorStyle="block";break;case 3:case 4:this._optionsService.options.cursorStyle="underline";break;case 5:case 6:this._optionsService.options.cursorStyle="bar"}const R=M%2==1;return this._optionsService.options.cursorBlink=R,!0}setScrollRegion(w){const M=w.params[0]||1;let R;return(w.length<2||(R=w.params[1])>this._bufferService.rows||R===0)&&(R=this._bufferService.rows),R>M&&(this._activeBuffer.scrollTop=M-1,this._activeBuffer.scrollBottom=R-1,this._setCursor(0,0)),!0}windowOptions(w){if(!O(w.params[0],this._optionsService.rawOptions.windowOptions))return!0;const M=w.length>1?w.params[1]:0;switch(w.params[0]){case 14:M!==2&&this._onRequestWindowsOptionsReport.fire(L.GET_WIN_SIZE_PIXELS);break;case 16:this._onRequestWindowsOptionsReport.fire(L.GET_CELL_SIZE_PIXELS);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${o.C0.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:M!==0&&M!==2||(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>10&&this._windowTitleStack.shift()),M!==0&&M!==1||(this._iconNameStack.push(this._iconName),this._iconNameStack.length>10&&this._iconNameStack.shift());break;case 23:M!==0&&M!==2||this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),M!==0&&M!==1||this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop())}return!0}saveCursor(w){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor(w){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle(w){return this._windowTitle=w,this._onTitleChange.fire(w),!0}setIconName(w){return this._iconName=w,!0}setOrReportIndexedColor(w){const M=[],R=w.split(";");for(;R.length>1;){const I=R.shift(),W=R.shift();if(/^\d+$/.exec(I)){const K=parseInt(I);if(j(K))if(W==="?")M.push({type:0,index:K});else{const Y=(0,m.parseColor)(W);Y&&M.push({type:1,index:K,color:Y})}}}return M.length&&this._onColor.fire(M),!0}setHyperlink(w){const M=w.split(";");return!(M.length<2)&&(M[1]?this._createHyperlink(M[0],M[1]):!M[0]&&this._finishHyperlink())}_createHyperlink(w,M){this._getCurrentLinkId()&&this._finishHyperlink();const R=w.split(":");let I;const W=R.findIndex((K=>K.startsWith("id=")));return W!==-1&&(I=R[W].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:I,uri:M}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor(w,M){const R=w.split(";");for(let I=0;I<R.length&&!(M>=this._specialColors.length);++I,++M)if(R[I]==="?")this._onColor.fire([{type:0,index:this._specialColors[M]}]);else{const W=(0,m.parseColor)(R[I]);W&&this._onColor.fire([{type:1,index:this._specialColors[M],color:W}])}return!0}setOrReportFgColor(w){return this._setOrReportSpecialColor(w,0)}setOrReportBgColor(w){return this._setOrReportSpecialColor(w,1)}setOrReportCursorColor(w){return this._setOrReportSpecialColor(w,2)}restoreIndexedColor(w){if(!w)return this._onColor.fire([{type:2}]),!0;const M=[],R=w.split(";");for(let I=0;I<R.length;++I)if(/^\d+$/.exec(R[I])){const W=parseInt(R[I]);j(W)&&M.push({type:2,index:W})}return M.length&&this._onColor.fire(M),!0}restoreFgColor(w){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor(w){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor(w){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,c.DEFAULT_CHARSET),!0}selectCharset(w){return w.length!==2?(this.selectDefaultCharset(),!0):(w[0]==="/"||this._charsetService.setgCharset(B[w[0]],c.CHARSETS[w[1]]||c.DEFAULT_CHARSET),!0)}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){const w=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,w,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=t.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=t.DEFAULT_ATTR_DATA.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=67108863&this._curAttrData.bg,this._eraseAttrDataInternal}setgLevel(w){return this._charsetService.setgLevel(w),!0}screenAlignmentPattern(){const w=new r.CellData;w.content=4194373,w.fg=this._curAttrData.fg,w.bg=this._curAttrData.bg,this._setCursor(0,0);for(let M=0;M<this._bufferService.rows;++M){const R=this._activeBuffer.ybase+this._activeBuffer.y+M,I=this._activeBuffer.lines.get(R);I&&(I.fill(w),I.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString(w,M){const R=this._bufferService.buffer,I=this._optionsService.rawOptions;return(W=>(this._coreService.triggerDataEvent(`${o.C0.ESC}${W}${o.C0.ESC}\\`),!0))(w==='"q'?`P1$r${this._curAttrData.isProtected()?1:0}"q`:w==='"p'?'P1$r61;1"p':w==="r"?`P1$r${R.scrollTop+1};${R.scrollBottom+1}r`:w==="m"?"P1$r0m":w===" q"?`P1$r${{block:2,underline:4,bar:6}[I.cursorStyle]-(I.cursorBlink?1:0)} q`:"P0$r")}markRangeDirty(w,M){this._dirtyRowTracker.markRangeDirty(w,M)}}i.InputHandler=H;let $=class{constructor(U){this._bufferService=U,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty(U){U<this.start?this.start=U:U>this.end&&(this.end=U)}markRangeDirty(U,w){U>w&&(T=U,U=w,w=T),U<this.start&&(this.start=U),w>this.end&&(this.end=w)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};function j(U){return 0<=U&&U<256}$=a([l(0,_.IBufferService)],$)},844:(b,i)=>{function n(a){for(const l of a)l.dispose();a.length=0}Object.defineProperty(i,"__esModule",{value:!0}),i.getDisposeArrayDisposable=i.disposeArray=i.toDisposable=i.MutableDisposable=i.Disposable=void 0,i.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(const a of this._disposables)a.dispose();this._disposables.length=0}register(a){return this._disposables.push(a),a}unregister(a){const l=this._disposables.indexOf(a);l!==-1&&this._disposables.splice(l,1)}},i.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(a){this._isDisposed||a===this._value||(this._value?.dispose(),this._value=a)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,this._value?.dispose(),this._value=void 0}},i.toDisposable=function(a){return{dispose:a}},i.disposeArray=n,i.getDisposeArrayDisposable=function(a){return{dispose:()=>n(a)}}},1505:(b,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.FourKeyMap=i.TwoKeyMap=void 0;class n{constructor(){this._data={}}set(l,o,c){this._data[l]||(this._data[l]={}),this._data[l][o]=c}get(l,o){return this._data[l]?this._data[l][o]:void 0}clear(){this._data={}}}i.TwoKeyMap=n,i.FourKeyMap=class{constructor(){this._data=new n}set(a,l,o,c,f){this._data.get(a,l)||this._data.set(a,l,new n),this._data.get(a,l).set(o,c,f)}get(a,l,o,c){return this._data.get(a,l)?.get(o,c)}clear(){this._data.clear()}}},6114:(b,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.isChromeOS=i.isLinux=i.isWindows=i.isIphone=i.isIpad=i.isMac=i.getSafariVersion=i.isSafari=i.isLegacyEdge=i.isFirefox=i.isNode=void 0,i.isNode=typeof process<"u"&&"title"in process;const n=i.isNode?"node":navigator.userAgent,a=i.isNode?"node":navigator.platform;i.isFirefox=n.includes("Firefox"),i.isLegacyEdge=n.includes("Edge"),i.isSafari=/^((?!chrome|android).)*safari/i.test(n),i.getSafariVersion=function(){if(!i.isSafari)return 0;const l=n.match(/Version\/(\d+)/);return l===null||l.length<2?0:parseInt(l[1])},i.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(a),i.isIpad=a==="iPad",i.isIphone=a==="iPhone",i.isWindows=["Windows","Win16","Win32","WinCE"].includes(a),i.isLinux=a.indexOf("Linux")>=0,i.isChromeOS=/\bCrOS\b/.test(n)},6106:(b,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.SortedList=void 0;let n=0;i.SortedList=class{constructor(a){this._getKey=a,this._array=[]}clear(){this._array.length=0}insert(a){this._array.length!==0?(n=this._search(this._getKey(a)),this._array.splice(n,0,a)):this._array.push(a)}delete(a){if(this._array.length===0)return!1;const l=this._getKey(a);if(l===void 0||(n=this._search(l),n===-1)||this._getKey(this._array[n])!==l)return!1;do if(this._array[n]===a)return this._array.splice(n,1),!0;while(++n<this._array.length&&this._getKey(this._array[n])===l);return!1}*getKeyIterator(a){if(this._array.length!==0&&(n=this._search(a),!(n<0||n>=this._array.length)&&this._getKey(this._array[n])===a))do yield this._array[n];while(++n<this._array.length&&this._getKey(this._array[n])===a)}forEachByKey(a,l){if(this._array.length!==0&&(n=this._search(a),!(n<0||n>=this._array.length)&&this._getKey(this._array[n])===a))do l(this._array[n]);while(++n<this._array.length&&this._getKey(this._array[n])===a)}values(){return[...this._array].values()}_search(a){let l=0,o=this._array.length-1;for(;o>=l;){let c=l+o>>1;const f=this._getKey(this._array[c]);if(f>a)o=c-1;else{if(!(f<a)){for(;c>0&&this._getKey(this._array[c-1])===a;)c--;return c}l=c+1}}return l}}},7226:(b,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.DebouncedIdleTask=i.IdleTaskQueue=i.PriorityTaskQueue=void 0;const a=n(6114);class l{constructor(){this._tasks=[],this._i=0}enqueue(f){this._tasks.push(f),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(f){this._idleCallback=void 0;let v=0,d=0,t=f.timeRemaining(),s=0;for(;this._i<this._tasks.length;){if(v=Date.now(),this._tasks[this._i]()||this._i++,v=Math.max(1,Date.now()-v),d=Math.max(v,d),s=f.timeRemaining(),1.5*d>s)return t-v<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(t-v))}ms`),void this._start();t=s}this.clear()}}class o extends l{_requestCallback(f){return setTimeout((()=>f(this._createDeadline(16))))}_cancelCallback(f){clearTimeout(f)}_createDeadline(f){const v=Date.now()+f;return{timeRemaining:()=>Math.max(0,v-Date.now())}}}i.PriorityTaskQueue=o,i.IdleTaskQueue=!a.isNode&&"requestIdleCallback"in window?class extends l{_requestCallback(c){return requestIdleCallback(c)}_cancelCallback(c){cancelIdleCallback(c)}}:o,i.DebouncedIdleTask=class{constructor(){this._queue=new i.IdleTaskQueue}set(c){this._queue.clear(),this._queue.enqueue(c)}flush(){this._queue.flush()}}},9282:(b,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.updateWindowsModeWrappedState=void 0;const a=n(643);i.updateWindowsModeWrappedState=function(l){const o=l.buffer.lines.get(l.buffer.ybase+l.buffer.y-1),c=o?.get(l.cols-1),f=l.buffer.lines.get(l.buffer.ybase+l.buffer.y);f&&c&&(f.isWrapped=c[a.CHAR_DATA_CODE_INDEX]!==a.NULL_CELL_CODE&&c[a.CHAR_DATA_CODE_INDEX]!==a.WHITESPACE_CELL_CODE)}},3734:(b,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.ExtendedAttrs=i.AttributeData=void 0;class n{constructor(){this.fg=0,this.bg=0,this.extended=new a}static toColorRGB(o){return[o>>>16&255,o>>>8&255,255&o]}static fromColorRGB(o){return(255&o[0])<<16|(255&o[1])<<8|255&o[2]}clone(){const o=new n;return o.fg=this.fg,o.bg=this.bg,o.extended=this.extended.clone(),o}isInverse(){return 67108864&this.fg}isBold(){return 134217728&this.fg}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:268435456&this.fg}isBlink(){return 536870912&this.fg}isInvisible(){return 1073741824&this.fg}isItalic(){return 67108864&this.bg}isDim(){return 134217728&this.bg}isStrikethrough(){return 2147483648&this.fg}isProtected(){return 536870912&this.bg}isOverline(){return 1073741824&this.bg}getFgColorMode(){return 50331648&this.fg}getBgColorMode(){return 50331648&this.bg}isFgRGB(){return(50331648&this.fg)==50331648}isBgRGB(){return(50331648&this.bg)==50331648}isFgPalette(){return(50331648&this.fg)==16777216||(50331648&this.fg)==33554432}isBgPalette(){return(50331648&this.bg)==16777216||(50331648&this.bg)==33554432}isFgDefault(){return(50331648&this.fg)==0}isBgDefault(){return(50331648&this.bg)==0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}}getBgColor(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}}hasExtendedAttrs(){return 268435456&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==50331648:this.isFgRGB()}isUnderlineColorPalette(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==16777216||(50331648&this.extended.underlineColor)==33554432:this.isFgPalette()}isUnderlineColorDefault(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==0:this.isFgDefault()}getUnderlineStyle(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0}getUnderlineVariantOffset(){return this.extended.underlineVariantOffset}}i.AttributeData=n;class a{get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(o){this._ext=o}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(o){this._ext&=-469762049,this._ext|=o<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(o){this._ext&=-67108864,this._ext|=67108863&o}get urlId(){return this._urlId}set urlId(o){this._urlId=o}get underlineVariantOffset(){const o=(3758096384&this._ext)>>29;return o<0?4294967288^o:o}set underlineVariantOffset(o){this._ext&=536870911,this._ext|=o<<29&3758096384}constructor(o=0,c=0){this._ext=0,this._urlId=0,this._ext=o,this._urlId=c}clone(){return new a(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}}i.ExtendedAttrs=a},9092:(b,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Buffer=i.MAX_BUFFER_SIZE=void 0;const a=n(6349),l=n(7226),o=n(3734),c=n(8437),f=n(4634),v=n(511),d=n(643),t=n(4863),s=n(7116);i.MAX_BUFFER_SIZE=4294967295,i.Buffer=class{constructor(e,r,h){this._hasScrollback=e,this._optionsService=r,this._bufferService=h,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=c.DEFAULT_ATTR_DATA.clone(),this.savedCharset=s.DEFAULT_CHARSET,this.markers=[],this._nullCell=v.CellData.fromCharData([0,d.NULL_CELL_CHAR,d.NULL_CELL_WIDTH,d.NULL_CELL_CODE]),this._whitespaceCell=v.CellData.fromCharData([0,d.WHITESPACE_CELL_CHAR,d.WHITESPACE_CELL_WIDTH,d.WHITESPACE_CELL_CODE]),this._isClearing=!1,this._memoryCleanupQueue=new l.IdleTaskQueue,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new a.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell(e){return e?(this._nullCell.fg=e.fg,this._nullCell.bg=e.bg,this._nullCell.extended=e.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new o.ExtendedAttrs),this._nullCell}getWhitespaceCell(e){return e?(this._whitespaceCell.fg=e.fg,this._whitespaceCell.bg=e.bg,this._whitespaceCell.extended=e.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new o.ExtendedAttrs),this._whitespaceCell}getBlankLine(e,r){return new c.BufferLine(this._bufferService.cols,this.getNullCell(e),r)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){const e=this.ybase+this.y-this.ydisp;return e>=0&&e<this._rows}_getCorrectBufferLength(e){if(!this._hasScrollback)return e;const r=e+this._optionsService.rawOptions.scrollback;return r>i.MAX_BUFFER_SIZE?i.MAX_BUFFER_SIZE:r}fillViewportRows(e){if(this.lines.length===0){e===void 0&&(e=c.DEFAULT_ATTR_DATA);let r=this._rows;for(;r--;)this.lines.push(this.getBlankLine(e))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new a.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize(e,r){const h=this.getNullCell(c.DEFAULT_ATTR_DATA);let _=0;const p=this._getCorrectBufferLength(r);if(p>this.lines.maxLength&&(this.lines.maxLength=p),this.lines.length>0){if(this._cols<e)for(let u=0;u<this.lines.length;u++)_+=+this.lines.get(u).resize(e,h);let g=0;if(this._rows<r)for(let u=this._rows;u<r;u++)this.lines.length<r+this.ybase&&(this._optionsService.rawOptions.windowsMode||this._optionsService.rawOptions.windowsPty.backend!==void 0||this._optionsService.rawOptions.windowsPty.buildNumber!==void 0?this.lines.push(new c.BufferLine(e,h)):this.ybase>0&&this.lines.length<=this.ybase+this.y+g+1?(this.ybase--,g++,this.ydisp>0&&this.ydisp--):this.lines.push(new c.BufferLine(e,h)));else for(let u=this._rows;u>r;u--)this.lines.length>r+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(p<this.lines.maxLength){const u=this.lines.length-p;u>0&&(this.lines.trimStart(u),this.ybase=Math.max(this.ybase-u,0),this.ydisp=Math.max(this.ydisp-u,0),this.savedY=Math.max(this.savedY-u,0)),this.lines.maxLength=p}this.x=Math.min(this.x,e-1),this.y=Math.min(this.y,r-1),g&&(this.y+=g),this.savedX=Math.min(this.savedX,e-1),this.scrollTop=0}if(this.scrollBottom=r-1,this._isReflowEnabled&&(this._reflow(e,r),this._cols>e))for(let g=0;g<this.lines.length;g++)_+=+this.lines.get(g).resize(e,h);this._cols=e,this._rows=r,this._memoryCleanupQueue.clear(),_>.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue((()=>this._batchedMemoryCleanup())))}_batchedMemoryCleanup(){let e=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,e=!1);let r=0;for(;this._memoryCleanupPosition<this.lines.length;)if(r+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory(),r>100)return!0;return e}get _isReflowEnabled(){const e=this._optionsService.rawOptions.windowsPty;return e&&e.buildNumber?this._hasScrollback&&e.backend==="conpty"&&e.buildNumber>=21376:this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow(e,r){this._cols!==e&&(e>this._cols?this._reflowLarger(e,r):this._reflowSmaller(e,r))}_reflowLarger(e,r){const h=(0,f.reflowLargerGetLinesToRemove)(this.lines,this._cols,e,this.ybase+this.y,this.getNullCell(c.DEFAULT_ATTR_DATA));if(h.length>0){const _=(0,f.reflowLargerCreateNewLayout)(this.lines,h);(0,f.reflowLargerApplyNewLayout)(this.lines,_.layout),this._reflowLargerAdjustViewport(e,r,_.countRemoved)}}_reflowLargerAdjustViewport(e,r,h){const _=this.getNullCell(c.DEFAULT_ATTR_DATA);let p=h;for(;p-- >0;)this.ybase===0?(this.y>0&&this.y--,this.lines.length<r&&this.lines.push(new c.BufferLine(e,_))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-h,0)}_reflowSmaller(e,r){const h=this.getNullCell(c.DEFAULT_ATTR_DATA),_=[];let p=0;for(let g=this.lines.length-1;g>=0;g--){let u=this.lines.get(g);if(!u||!u.isWrapped&&u.getTrimmedLength()<=e)continue;const m=[u];for(;u.isWrapped&&g>0;)u=this.lines.get(--g),m.unshift(u);const B=this.ybase+this.y;if(B>=g&&B<g+m.length)continue;const A=m[m.length-1].getTrimmedLength(),O=(0,f.reflowSmallerGetNewLineLengths)(m,this._cols,e),L=O.length-m.length;let T;T=this.ybase===0&&this.y!==this.lines.length-1?Math.max(0,this.y-this.lines.maxLength+L):Math.max(0,this.lines.length-this.lines.maxLength+L);const H=[];for(let R=0;R<L;R++){const I=this.getBlankLine(c.DEFAULT_ATTR_DATA,!0);H.push(I)}H.length>0&&(_.push({start:g+m.length+p,newLines:H}),p+=H.length),m.push(...H);let $=O.length-1,j=O[$];j===0&&($--,j=O[$]);let U=m.length-L-1,w=A;for(;U>=0;){const R=Math.min(w,j);if(m[$]===void 0)break;if(m[$].copyCellsFrom(m[U],w-R,j-R,R,!0),j-=R,j===0&&($--,j=O[$]),w-=R,w===0){U--;const I=Math.max(U,0);w=(0,f.getWrappedLineTrimmedLength)(m,I,this._cols)}}for(let R=0;R<m.length;R++)O[R]<e&&m[R].setCell(O[R],h);let M=L-T;for(;M-- >0;)this.ybase===0?this.y<r-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+p)-r&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+L,this.ybase+r-1)}if(_.length>0){const g=[],u=[];for(let $=0;$<this.lines.length;$++)u.push(this.lines.get($));const m=this.lines.length;let B=m-1,A=0,O=_[A];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+p);let L=0;for(let $=Math.min(this.lines.maxLength-1,m+p-1);$>=0;$--)if(O&&O.start>B+L){for(let j=O.newLines.length-1;j>=0;j--)this.lines.set($--,O.newLines[j]);$++,g.push({index:B+1,amount:O.newLines.length}),L+=O.newLines.length,O=_[++A]}else this.lines.set($,u[B--]);let T=0;for(let $=g.length-1;$>=0;$--)g[$].index+=T,this.lines.onInsertEmitter.fire(g[$]),T+=g[$].amount;const H=Math.max(0,m+p-this.lines.maxLength);H>0&&this.lines.onTrimEmitter.fire(H)}}translateBufferLineToString(e,r,h=0,_){const p=this.lines.get(e);return p?p.translateToString(r,h,_):""}getWrappedRangeForLine(e){let r=e,h=e;for(;r>0&&this.lines.get(r).isWrapped;)r--;for(;h+1<this.lines.length&&this.lines.get(h+1).isWrapped;)h++;return{first:r,last:h}}setupTabStops(e){for(e!=null?this.tabs[e]||(e=this.prevStop(e)):(this.tabs={},e=0);e<this._cols;e+=this._optionsService.rawOptions.tabStopWidth)this.tabs[e]=!0}prevStop(e){for(e==null&&(e=this.x);!this.tabs[--e]&&e>0;);return e>=this._cols?this._cols-1:e<0?0:e}nextStop(e){for(e==null&&(e=this.x);!this.tabs[++e]&&e<this._cols;);return e>=this._cols?this._cols-1:e<0?0:e}clearMarkers(e){this._isClearing=!0;for(let r=0;r<this.markers.length;r++)this.markers[r].line===e&&(this.markers[r].dispose(),this.markers.splice(r--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let e=0;e<this.markers.length;e++)this.markers[e].dispose(),this.markers.splice(e--,1);this._isClearing=!1}addMarker(e){const r=new t.Marker(e);return this.markers.push(r),r.register(this.lines.onTrim((h=>{r.line-=h,r.line<0&&r.dispose()}))),r.register(this.lines.onInsert((h=>{r.line>=h.index&&(r.line+=h.amount)}))),r.register(this.lines.onDelete((h=>{r.line>=h.index&&r.line<h.index+h.amount&&r.dispose(),r.line>h.index&&(r.line-=h.amount)}))),r.register(r.onDispose((()=>this._removeMarker(r)))),r}_removeMarker(e){this._isClearing||this.markers.splice(this.markers.indexOf(e),1)}}},8437:(b,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.BufferLine=i.DEFAULT_ATTR_DATA=void 0;const a=n(3734),l=n(511),o=n(643),c=n(482);i.DEFAULT_ATTR_DATA=Object.freeze(new a.AttributeData);let f=0;class v{constructor(t,s,e=!1){this.isWrapped=e,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(3*t);const r=s||l.CellData.fromCharData([0,o.NULL_CELL_CHAR,o.NULL_CELL_WIDTH,o.NULL_CELL_CODE]);for(let h=0;h<t;++h)this.setCell(h,r);this.length=t}get(t){const s=this._data[3*t+0],e=2097151&s;return[this._data[3*t+1],2097152&s?this._combined[t]:e?(0,c.stringFromCodePoint)(e):"",s>>22,2097152&s?this._combined[t].charCodeAt(this._combined[t].length-1):e]}set(t,s){this._data[3*t+1]=s[o.CHAR_DATA_ATTR_INDEX],s[o.CHAR_DATA_CHAR_INDEX].length>1?(this._combined[t]=s[1],this._data[3*t+0]=2097152|t|s[o.CHAR_DATA_WIDTH_INDEX]<<22):this._data[3*t+0]=s[o.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|s[o.CHAR_DATA_WIDTH_INDEX]<<22}getWidth(t){return this._data[3*t+0]>>22}hasWidth(t){return 12582912&this._data[3*t+0]}getFg(t){return this._data[3*t+1]}getBg(t){return this._data[3*t+2]}hasContent(t){return 4194303&this._data[3*t+0]}getCodePoint(t){const s=this._data[3*t+0];return 2097152&s?this._combined[t].charCodeAt(this._combined[t].length-1):2097151&s}isCombined(t){return 2097152&this._data[3*t+0]}getString(t){const s=this._data[3*t+0];return 2097152&s?this._combined[t]:2097151&s?(0,c.stringFromCodePoint)(2097151&s):""}isProtected(t){return 536870912&this._data[3*t+2]}loadCell(t,s){return f=3*t,s.content=this._data[f+0],s.fg=this._data[f+1],s.bg=this._data[f+2],2097152&s.content&&(s.combinedData=this._combined[t]),268435456&s.bg&&(s.extended=this._extendedAttrs[t]),s}setCell(t,s){2097152&s.content&&(this._combined[t]=s.combinedData),268435456&s.bg&&(this._extendedAttrs[t]=s.extended),this._data[3*t+0]=s.content,this._data[3*t+1]=s.fg,this._data[3*t+2]=s.bg}setCellFromCodepoint(t,s,e,r){268435456&r.bg&&(this._extendedAttrs[t]=r.extended),this._data[3*t+0]=s|e<<22,this._data[3*t+1]=r.fg,this._data[3*t+2]=r.bg}addCodepointToCell(t,s,e){let r=this._data[3*t+0];2097152&r?this._combined[t]+=(0,c.stringFromCodePoint)(s):2097151&r?(this._combined[t]=(0,c.stringFromCodePoint)(2097151&r)+(0,c.stringFromCodePoint)(s),r&=-2097152,r|=2097152):r=s|4194304,e&&(r&=-12582913,r|=e<<22),this._data[3*t+0]=r}insertCells(t,s,e){if((t%=this.length)&&this.getWidth(t-1)===2&&this.setCellFromCodepoint(t-1,0,1,e),s<this.length-t){const r=new l.CellData;for(let h=this.length-t-s-1;h>=0;--h)this.setCell(t+s+h,this.loadCell(t+h,r));for(let h=0;h<s;++h)this.setCell(t+h,e)}else for(let r=t;r<this.length;++r)this.setCell(r,e);this.getWidth(this.length-1)===2&&this.setCellFromCodepoint(this.length-1,0,1,e)}deleteCells(t,s,e){if(t%=this.length,s<this.length-t){const r=new l.CellData;for(let h=0;h<this.length-t-s;++h)this.setCell(t+h,this.loadCell(t+s+h,r));for(let h=this.length-s;h<this.length;++h)this.setCell(h,e)}else for(let r=t;r<this.length;++r)this.setCell(r,e);t&&this.getWidth(t-1)===2&&this.setCellFromCodepoint(t-1,0,1,e),this.getWidth(t)!==0||this.hasContent(t)||this.setCellFromCodepoint(t,0,1,e)}replaceCells(t,s,e,r=!1){if(r)for(t&&this.getWidth(t-1)===2&&!this.isProtected(t-1)&&this.setCellFromCodepoint(t-1,0,1,e),s<this.length&&this.getWidth(s-1)===2&&!this.isProtected(s)&&this.setCellFromCodepoint(s,0,1,e);t<s&&t<this.length;)this.isProtected(t)||this.setCell(t,e),t++;else for(t&&this.getWidth(t-1)===2&&this.setCellFromCodepoint(t-1,0,1,e),s<this.length&&this.getWidth(s-1)===2&&this.setCellFromCodepoint(s,0,1,e);t<s&&t<this.length;)this.setCell(t++,e)}resize(t,s){if(t===this.length)return 4*this._data.length*2<this._data.buffer.byteLength;const e=3*t;if(t>this.length){if(this._data.buffer.byteLength>=4*e)this._data=new Uint32Array(this._data.buffer,0,e);else{const r=new Uint32Array(e);r.set(this._data),this._data=r}for(let r=this.length;r<t;++r)this.setCell(r,s)}else{this._data=this._data.subarray(0,e);const r=Object.keys(this._combined);for(let _=0;_<r.length;_++){const p=parseInt(r[_],10);p>=t&&delete this._combined[p]}const h=Object.keys(this._extendedAttrs);for(let _=0;_<h.length;_++){const p=parseInt(h[_],10);p>=t&&delete this._extendedAttrs[p]}}return this.length=t,4*e*2<this._data.buffer.byteLength}cleanupMemory(){if(4*this._data.length*2<this._data.buffer.byteLength){const t=new Uint32Array(this._data.length);return t.set(this._data),this._data=t,1}return 0}fill(t,s=!1){if(s)for(let e=0;e<this.length;++e)this.isProtected(e)||this.setCell(e,t);else{this._combined={},this._extendedAttrs={};for(let e=0;e<this.length;++e)this.setCell(e,t)}}copyFrom(t){this.length!==t.length?this._data=new Uint32Array(t._data):this._data.set(t._data),this.length=t.length,this._combined={};for(const s in t._combined)this._combined[s]=t._combined[s];this._extendedAttrs={};for(const s in t._extendedAttrs)this._extendedAttrs[s]=t._extendedAttrs[s];this.isWrapped=t.isWrapped}clone(){const t=new v(0);t._data=new Uint32Array(this._data),t.length=this.length;for(const s in this._combined)t._combined[s]=this._combined[s];for(const s in this._extendedAttrs)t._extendedAttrs[s]=this._extendedAttrs[s];return t.isWrapped=this.isWrapped,t}getTrimmedLength(){for(let t=this.length-1;t>=0;--t)if(4194303&this._data[3*t+0])return t+(this._data[3*t+0]>>22);return 0}getNoBgTrimmedLength(){for(let t=this.length-1;t>=0;--t)if(4194303&this._data[3*t+0]||50331648&this._data[3*t+2])return t+(this._data[3*t+0]>>22);return 0}copyCellsFrom(t,s,e,r,h){const _=t._data;if(h)for(let g=r-1;g>=0;g--){for(let u=0;u<3;u++)this._data[3*(e+g)+u]=_[3*(s+g)+u];268435456&_[3*(s+g)+2]&&(this._extendedAttrs[e+g]=t._extendedAttrs[s+g])}else for(let g=0;g<r;g++){for(let u=0;u<3;u++)this._data[3*(e+g)+u]=_[3*(s+g)+u];268435456&_[3*(s+g)+2]&&(this._extendedAttrs[e+g]=t._extendedAttrs[s+g])}const p=Object.keys(t._combined);for(let g=0;g<p.length;g++){const u=parseInt(p[g],10);u>=s&&(this._combined[u-s+e]=t._combined[u])}}translateToString(t,s,e,r){s=s??0,e=e??this.length,t&&(e=Math.min(e,this.getTrimmedLength())),r&&(r.length=0);let h="";for(;s<e;){const _=this._data[3*s+0],p=2097151&_,g=2097152&_?this._combined[s]:p?(0,c.stringFromCodePoint)(p):o.WHITESPACE_CELL_CHAR;if(h+=g,r)for(let u=0;u<g.length;++u)r.push(s);s+=_>>22||1}return r&&r.push(s),h}}i.BufferLine=v},4841:(b,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.getRangeLength=void 0,i.getRangeLength=function(n,a){if(n.start.y>n.end.y)throw new Error(`Buffer range end (${n.end.x}, ${n.end.y}) cannot be before start (${n.start.x}, ${n.start.y})`);return a*(n.end.y-n.start.y)+(n.end.x-n.start.x+1)}},4634:(b,i)=>{function n(a,l,o){if(l===a.length-1)return a[l].getTrimmedLength();const c=!a[l].hasContent(o-1)&&a[l].getWidth(o-1)===1,f=a[l+1].getWidth(0)===2;return c&&f?o-1:o}Object.defineProperty(i,"__esModule",{value:!0}),i.getWrappedLineTrimmedLength=i.reflowSmallerGetNewLineLengths=i.reflowLargerApplyNewLayout=i.reflowLargerCreateNewLayout=i.reflowLargerGetLinesToRemove=void 0,i.reflowLargerGetLinesToRemove=function(a,l,o,c,f){const v=[];for(let d=0;d<a.length-1;d++){let t=d,s=a.get(++t);if(!s.isWrapped)continue;const e=[a.get(d)];for(;t<a.length&&s.isWrapped;)e.push(s),s=a.get(++t);if(c>=d&&c<t){d+=e.length-1;continue}let r=0,h=n(e,r,l),_=1,p=0;for(;_<e.length;){const u=n(e,_,l),m=u-p,B=o-h,A=Math.min(m,B);e[r].copyCellsFrom(e[_],p,h,A,!1),h+=A,h===o&&(r++,h=0),p+=A,p===u&&(_++,p=0),h===0&&r!==0&&e[r-1].getWidth(o-1)===2&&(e[r].copyCellsFrom(e[r-1],o-1,h++,1,!1),e[r-1].setCell(o-1,f))}e[r].replaceCells(h,o,f);let g=0;for(let u=e.length-1;u>0&&(u>r||e[u].getTrimmedLength()===0);u--)g++;g>0&&(v.push(d+e.length-g),v.push(g)),d+=e.length-1}return v},i.reflowLargerCreateNewLayout=function(a,l){const o=[];let c=0,f=l[c],v=0;for(let d=0;d<a.length;d++)if(f===d){const t=l[++c];a.onDeleteEmitter.fire({index:d-v,amount:t}),d+=t-1,v+=t,f=l[++c]}else o.push(d);return{layout:o,countRemoved:v}},i.reflowLargerApplyNewLayout=function(a,l){const o=[];for(let c=0;c<l.length;c++)o.push(a.get(l[c]));for(let c=0;c<o.length;c++)a.set(c,o[c]);a.length=l.length},i.reflowSmallerGetNewLineLengths=function(a,l,o){const c=[],f=a.map(((s,e)=>n(a,e,l))).reduce(((s,e)=>s+e));let v=0,d=0,t=0;for(;t<f;){if(f-t<o){c.push(f-t);break}v+=o;const s=n(a,d,l);v>s&&(v-=s,d++);const e=a[d].getWidth(v-1)===2;e&&v--;const r=e?o-1:o;c.push(r),t+=r}return c},i.getWrappedLineTrimmedLength=n},5295:(b,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.BufferSet=void 0;const a=n(8460),l=n(844),o=n(9092);class c extends l.Disposable{constructor(v,d){super(),this._optionsService=v,this._bufferService=d,this._onBufferActivate=this.register(new a.EventEmitter),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this.register(this._optionsService.onSpecificOptionChange("scrollback",(()=>this.resize(this._bufferService.cols,this._bufferService.rows)))),this.register(this._optionsService.onSpecificOptionChange("tabStopWidth",(()=>this.setupTabStops())))}reset(){this._normal=new o.Buffer(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new o.Buffer(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer(v){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(v),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize(v,d){this._normal.resize(v,d),this._alt.resize(v,d),this.setupTabStops(v)}setupTabStops(v){this._normal.setupTabStops(v),this._alt.setupTabStops(v)}}i.BufferSet=c},511:(b,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.CellData=void 0;const a=n(482),l=n(643),o=n(3734);class c extends o.AttributeData{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new o.ExtendedAttrs,this.combinedData=""}static fromCharData(v){const d=new c;return d.setFromCharData(v),d}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){return 2097152&this.content?this.combinedData:2097151&this.content?(0,a.stringFromCodePoint)(2097151&this.content):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(v){this.fg=v[l.CHAR_DATA_ATTR_INDEX],this.bg=0;let d=!1;if(v[l.CHAR_DATA_CHAR_INDEX].length>2)d=!0;else if(v[l.CHAR_DATA_CHAR_INDEX].length===2){const t=v[l.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=t&&t<=56319){const s=v[l.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=s&&s<=57343?this.content=1024*(t-55296)+s-56320+65536|v[l.CHAR_DATA_WIDTH_INDEX]<<22:d=!0}else d=!0}else this.content=v[l.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|v[l.CHAR_DATA_WIDTH_INDEX]<<22;d&&(this.combinedData=v[l.CHAR_DATA_CHAR_INDEX],this.content=2097152|v[l.CHAR_DATA_WIDTH_INDEX]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}i.CellData=c},643:(b,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.WHITESPACE_CELL_CODE=i.WHITESPACE_CELL_WIDTH=i.WHITESPACE_CELL_CHAR=i.NULL_CELL_CODE=i.NULL_CELL_WIDTH=i.NULL_CELL_CHAR=i.CHAR_DATA_CODE_INDEX=i.CHAR_DATA_WIDTH_INDEX=i.CHAR_DATA_CHAR_INDEX=i.CHAR_DATA_ATTR_INDEX=i.DEFAULT_EXT=i.DEFAULT_ATTR=i.DEFAULT_COLOR=void 0,i.DEFAULT_COLOR=0,i.DEFAULT_ATTR=256|i.DEFAULT_COLOR<<9,i.DEFAULT_EXT=0,i.CHAR_DATA_ATTR_INDEX=0,i.CHAR_DATA_CHAR_INDEX=1,i.CHAR_DATA_WIDTH_INDEX=2,i.CHAR_DATA_CODE_INDEX=3,i.NULL_CELL_CHAR="",i.NULL_CELL_WIDTH=1,i.NULL_CELL_CODE=0,i.WHITESPACE_CELL_CHAR=" ",i.WHITESPACE_CELL_WIDTH=1,i.WHITESPACE_CELL_CODE=32},4863:(b,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Marker=void 0;const a=n(8460),l=n(844);class o{get id(){return this._id}constructor(f){this.line=f,this.isDisposed=!1,this._disposables=[],this._id=o._nextId++,this._onDispose=this.register(new a.EventEmitter),this.onDispose=this._onDispose.event}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),(0,l.disposeArray)(this._disposables),this._disposables.length=0)}register(f){return this._disposables.push(f),f}}i.Marker=o,o._nextId=1},7116:(b,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.DEFAULT_CHARSET=i.CHARSETS=void 0,i.CHARSETS={},i.DEFAULT_CHARSET=i.CHARSETS.B,i.CHARSETS[0]={"`":"◆",a:"▒",b:"␉",c:"␌",d:"␍",e:"␊",f:"°",g:"±",h:"␤",i:"␋",j:"┘",k:"┐",l:"┌",m:"└",n:"┼",o:"⎺",p:"⎻",q:"─",r:"⎼",s:"⎽",t:"├",u:"┤",v:"┴",w:"┬",x:"│",y:"≤",z:"≥","{":"π","|":"≠","}":"£","~":"·"},i.CHARSETS.A={"#":"£"},i.CHARSETS.B=void 0,i.CHARSETS[4]={"#":"£","@":"¾","[":"ij","\\":"½","]":"|","{":"¨","|":"f","}":"¼","~":"´"},i.CHARSETS.C=i.CHARSETS[5]={"[":"Ä","\\":"Ö","]":"Å","^":"Ü","`":"é","{":"ä","|":"ö","}":"å","~":"ü"},i.CHARSETS.R={"#":"£","@":"à","[":"°","\\":"ç","]":"§","{":"é","|":"ù","}":"è","~":"¨"},i.CHARSETS.Q={"@":"à","[":"â","\\":"ç","]":"ê","^":"î","`":"ô","{":"é","|":"ù","}":"è","~":"û"},i.CHARSETS.K={"@":"§","[":"Ä","\\":"Ö","]":"Ü","{":"ä","|":"ö","}":"ü","~":"ß"},i.CHARSETS.Y={"#":"£","@":"§","[":"°","\\":"ç","]":"é","`":"ù","{":"à","|":"ò","}":"è","~":"ì"},i.CHARSETS.E=i.CHARSETS[6]={"@":"Ä","[":"Æ","\\":"Ø","]":"Å","^":"Ü","`":"ä","{":"æ","|":"ø","}":"å","~":"ü"},i.CHARSETS.Z={"#":"£","@":"§","[":"¡","\\":"Ñ","]":"¿","{":"°","|":"ñ","}":"ç"},i.CHARSETS.H=i.CHARSETS[7]={"@":"É","[":"Ä","\\":"Ö","]":"Å","^":"Ü","`":"é","{":"ä","|":"ö","}":"å","~":"ü"},i.CHARSETS["="]={"#":"ù","@":"à","[":"é","\\":"ç","]":"ê","^":"î",_:"è","`":"ô","{":"ä","|":"ö","}":"ü","~":"û"}},2584:(b,i)=>{var n,a,l;Object.defineProperty(i,"__esModule",{value:!0}),i.C1_ESCAPED=i.C1=i.C0=void 0,(function(o){o.NUL="\0",o.SOH="",o.STX="",o.ETX="",o.EOT="",o.ENQ="",o.ACK="",o.BEL="\x07",o.BS="\b",o.HT="	",o.LF=`
`,o.VT="\v",o.FF="\f",o.CR="\r",o.SO="",o.SI="",o.DLE="",o.DC1="",o.DC2="",o.DC3="",o.DC4="",o.NAK="",o.SYN="",o.ETB="",o.CAN="",o.EM="",o.SUB="",o.ESC="\x1B",o.FS="",o.GS="",o.RS="",o.US="",o.SP=" ",o.DEL=""})(n||(i.C0=n={})),(function(o){o.PAD="",o.HOP="",o.BPH="",o.NBH="",o.IND="",o.NEL="",o.SSA="",o.ESA="",o.HTS="",o.HTJ="",o.VTS="",o.PLD="",o.PLU="",o.RI="",o.SS2="",o.SS3="",o.DCS="",o.PU1="",o.PU2="",o.STS="",o.CCH="",o.MW="",o.SPA="",o.EPA="",o.SOS="",o.SGCI="",o.SCI="",o.CSI="",o.ST="",o.OSC="",o.PM="",o.APC=""})(a||(i.C1=a={})),(function(o){o.ST=`${n.ESC}\\`})(l||(i.C1_ESCAPED=l={}))},7399:(b,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.evaluateKeyboardEvent=void 0;const a=n(2584),l={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};i.evaluateKeyboardEvent=function(o,c,f,v){const d={type:0,cancel:!1,key:void 0},t=(o.shiftKey?1:0)|(o.altKey?2:0)|(o.ctrlKey?4:0)|(o.metaKey?8:0);switch(o.keyCode){case 0:o.key==="UIKeyInputUpArrow"?d.key=c?a.C0.ESC+"OA":a.C0.ESC+"[A":o.key==="UIKeyInputLeftArrow"?d.key=c?a.C0.ESC+"OD":a.C0.ESC+"[D":o.key==="UIKeyInputRightArrow"?d.key=c?a.C0.ESC+"OC":a.C0.ESC+"[C":o.key==="UIKeyInputDownArrow"&&(d.key=c?a.C0.ESC+"OB":a.C0.ESC+"[B");break;case 8:d.key=o.ctrlKey?"\b":a.C0.DEL,o.altKey&&(d.key=a.C0.ESC+d.key);break;case 9:if(o.shiftKey){d.key=a.C0.ESC+"[Z";break}d.key=a.C0.HT,d.cancel=!0;break;case 13:d.key=o.altKey?a.C0.ESC+a.C0.CR:a.C0.CR,d.cancel=!0;break;case 27:d.key=a.C0.ESC,o.altKey&&(d.key=a.C0.ESC+a.C0.ESC),d.cancel=!0;break;case 37:if(o.metaKey)break;t?(d.key=a.C0.ESC+"[1;"+(t+1)+"D",d.key===a.C0.ESC+"[1;3D"&&(d.key=a.C0.ESC+(f?"b":"[1;5D"))):d.key=c?a.C0.ESC+"OD":a.C0.ESC+"[D";break;case 39:if(o.metaKey)break;t?(d.key=a.C0.ESC+"[1;"+(t+1)+"C",d.key===a.C0.ESC+"[1;3C"&&(d.key=a.C0.ESC+(f?"f":"[1;5C"))):d.key=c?a.C0.ESC+"OC":a.C0.ESC+"[C";break;case 38:if(o.metaKey)break;t?(d.key=a.C0.ESC+"[1;"+(t+1)+"A",f||d.key!==a.C0.ESC+"[1;3A"||(d.key=a.C0.ESC+"[1;5A")):d.key=c?a.C0.ESC+"OA":a.C0.ESC+"[A";break;case 40:if(o.metaKey)break;t?(d.key=a.C0.ESC+"[1;"+(t+1)+"B",f||d.key!==a.C0.ESC+"[1;3B"||(d.key=a.C0.ESC+"[1;5B")):d.key=c?a.C0.ESC+"OB":a.C0.ESC+"[B";break;case 45:o.shiftKey||o.ctrlKey||(d.key=a.C0.ESC+"[2~");break;case 46:d.key=t?a.C0.ESC+"[3;"+(t+1)+"~":a.C0.ESC+"[3~";break;case 36:d.key=t?a.C0.ESC+"[1;"+(t+1)+"H":c?a.C0.ESC+"OH":a.C0.ESC+"[H";break;case 35:d.key=t?a.C0.ESC+"[1;"+(t+1)+"F":c?a.C0.ESC+"OF":a.C0.ESC+"[F";break;case 33:o.shiftKey?d.type=2:o.ctrlKey?d.key=a.C0.ESC+"[5;"+(t+1)+"~":d.key=a.C0.ESC+"[5~";break;case 34:o.shiftKey?d.type=3:o.ctrlKey?d.key=a.C0.ESC+"[6;"+(t+1)+"~":d.key=a.C0.ESC+"[6~";break;case 112:d.key=t?a.C0.ESC+"[1;"+(t+1)+"P":a.C0.ESC+"OP";break;case 113:d.key=t?a.C0.ESC+"[1;"+(t+1)+"Q":a.C0.ESC+"OQ";break;case 114:d.key=t?a.C0.ESC+"[1;"+(t+1)+"R":a.C0.ESC+"OR";break;case 115:d.key=t?a.C0.ESC+"[1;"+(t+1)+"S":a.C0.ESC+"OS";break;case 116:d.key=t?a.C0.ESC+"[15;"+(t+1)+"~":a.C0.ESC+"[15~";break;case 117:d.key=t?a.C0.ESC+"[17;"+(t+1)+"~":a.C0.ESC+"[17~";break;case 118:d.key=t?a.C0.ESC+"[18;"+(t+1)+"~":a.C0.ESC+"[18~";break;case 119:d.key=t?a.C0.ESC+"[19;"+(t+1)+"~":a.C0.ESC+"[19~";break;case 120:d.key=t?a.C0.ESC+"[20;"+(t+1)+"~":a.C0.ESC+"[20~";break;case 121:d.key=t?a.C0.ESC+"[21;"+(t+1)+"~":a.C0.ESC+"[21~";break;case 122:d.key=t?a.C0.ESC+"[23;"+(t+1)+"~":a.C0.ESC+"[23~";break;case 123:d.key=t?a.C0.ESC+"[24;"+(t+1)+"~":a.C0.ESC+"[24~";break;default:if(!o.ctrlKey||o.shiftKey||o.altKey||o.metaKey)if(f&&!v||!o.altKey||o.metaKey)!f||o.altKey||o.ctrlKey||o.shiftKey||!o.metaKey?o.key&&!o.ctrlKey&&!o.altKey&&!o.metaKey&&o.keyCode>=48&&o.key.length===1?d.key=o.key:o.key&&o.ctrlKey&&(o.key==="_"&&(d.key=a.C0.US),o.key==="@"&&(d.key=a.C0.NUL)):o.keyCode===65&&(d.type=1);else{const s=l[o.keyCode],e=s?.[o.shiftKey?1:0];if(e)d.key=a.C0.ESC+e;else if(o.keyCode>=65&&o.keyCode<=90){const r=o.ctrlKey?o.keyCode-64:o.keyCode+32;let h=String.fromCharCode(r);o.shiftKey&&(h=h.toUpperCase()),d.key=a.C0.ESC+h}else if(o.keyCode===32)d.key=a.C0.ESC+(o.ctrlKey?a.C0.NUL:" ");else if(o.key==="Dead"&&o.code.startsWith("Key")){let r=o.code.slice(3,4);o.shiftKey||(r=r.toLowerCase()),d.key=a.C0.ESC+r,d.cancel=!0}}else o.keyCode>=65&&o.keyCode<=90?d.key=String.fromCharCode(o.keyCode-64):o.keyCode===32?d.key=a.C0.NUL:o.keyCode>=51&&o.keyCode<=55?d.key=String.fromCharCode(o.keyCode-51+27):o.keyCode===56?d.key=a.C0.DEL:o.keyCode===219?d.key=a.C0.ESC:o.keyCode===220?d.key=a.C0.FS:o.keyCode===221&&(d.key=a.C0.GS)}return d}},482:(b,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Utf8ToUtf32=i.StringToUtf32=i.utf32ToString=i.stringFromCodePoint=void 0,i.stringFromCodePoint=function(n){return n>65535?(n-=65536,String.fromCharCode(55296+(n>>10))+String.fromCharCode(n%1024+56320)):String.fromCharCode(n)},i.utf32ToString=function(n,a=0,l=n.length){let o="";for(let c=a;c<l;++c){let f=n[c];f>65535?(f-=65536,o+=String.fromCharCode(55296+(f>>10))+String.fromCharCode(f%1024+56320)):o+=String.fromCharCode(f)}return o},i.StringToUtf32=class{constructor(){this._interim=0}clear(){this._interim=0}decode(n,a){const l=n.length;if(!l)return 0;let o=0,c=0;if(this._interim){const f=n.charCodeAt(c++);56320<=f&&f<=57343?a[o++]=1024*(this._interim-55296)+f-56320+65536:(a[o++]=this._interim,a[o++]=f),this._interim=0}for(let f=c;f<l;++f){const v=n.charCodeAt(f);if(55296<=v&&v<=56319){if(++f>=l)return this._interim=v,o;const d=n.charCodeAt(f);56320<=d&&d<=57343?a[o++]=1024*(v-55296)+d-56320+65536:(a[o++]=v,a[o++]=d)}else v!==65279&&(a[o++]=v)}return o}},i.Utf8ToUtf32=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(n,a){const l=n.length;if(!l)return 0;let o,c,f,v,d=0,t=0,s=0;if(this.interim[0]){let h=!1,_=this.interim[0];_&=(224&_)==192?31:(240&_)==224?15:7;let p,g=0;for(;(p=63&this.interim[++g])&&g<4;)_<<=6,_|=p;const u=(224&this.interim[0])==192?2:(240&this.interim[0])==224?3:4,m=u-g;for(;s<m;){if(s>=l)return 0;if(p=n[s++],(192&p)!=128){s--,h=!0;break}this.interim[g++]=p,_<<=6,_|=63&p}h||(u===2?_<128?s--:a[d++]=_:u===3?_<2048||_>=55296&&_<=57343||_===65279||(a[d++]=_):_<65536||_>1114111||(a[d++]=_)),this.interim.fill(0)}const e=l-4;let r=s;for(;r<l;){for(;!(!(r<e)||128&(o=n[r])||128&(c=n[r+1])||128&(f=n[r+2])||128&(v=n[r+3]));)a[d++]=o,a[d++]=c,a[d++]=f,a[d++]=v,r+=4;if(o=n[r++],o<128)a[d++]=o;else if((224&o)==192){if(r>=l)return this.interim[0]=o,d;if(c=n[r++],(192&c)!=128){r--;continue}if(t=(31&o)<<6|63&c,t<128){r--;continue}a[d++]=t}else if((240&o)==224){if(r>=l)return this.interim[0]=o,d;if(c=n[r++],(192&c)!=128){r--;continue}if(r>=l)return this.interim[0]=o,this.interim[1]=c,d;if(f=n[r++],(192&f)!=128){r--;continue}if(t=(15&o)<<12|(63&c)<<6|63&f,t<2048||t>=55296&&t<=57343||t===65279)continue;a[d++]=t}else if((248&o)==240){if(r>=l)return this.interim[0]=o,d;if(c=n[r++],(192&c)!=128){r--;continue}if(r>=l)return this.interim[0]=o,this.interim[1]=c,d;if(f=n[r++],(192&f)!=128){r--;continue}if(r>=l)return this.interim[0]=o,this.interim[1]=c,this.interim[2]=f,d;if(v=n[r++],(192&v)!=128){r--;continue}if(t=(7&o)<<18|(63&c)<<12|(63&f)<<6|63&v,t<65536||t>1114111)continue;a[d++]=t}}return d}}},225:(b,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.UnicodeV6=void 0;const a=n(1480),l=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],o=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]];let c;i.UnicodeV6=class{constructor(){if(this.version="6",!c){c=new Uint8Array(65536),c.fill(1),c[0]=0,c.fill(0,1,32),c.fill(0,127,160),c.fill(2,4352,4448),c[9001]=2,c[9002]=2,c.fill(2,11904,42192),c[12351]=1,c.fill(2,44032,55204),c.fill(2,63744,64256),c.fill(2,65040,65050),c.fill(2,65072,65136),c.fill(2,65280,65377),c.fill(2,65504,65511);for(let f=0;f<l.length;++f)c.fill(0,l[f][0],l[f][1]+1)}}wcwidth(f){return f<32?0:f<127?1:f<65536?c[f]:(function(v,d){let t,s=0,e=d.length-1;if(v<d[0][0]||v>d[e][1])return!1;for(;e>=s;)if(t=s+e>>1,v>d[t][1])s=t+1;else{if(!(v<d[t][0]))return!0;e=t-1}return!1})(f,o)?0:f>=131072&&f<=196605||f>=196608&&f<=262141?2:1}charProperties(f,v){let d=this.wcwidth(f),t=d===0&&v!==0;if(t){const s=a.UnicodeService.extractWidth(v);s===0?t=!1:s>d&&(d=s)}return a.UnicodeService.createPropertyValue(0,d,t)}}},5981:(b,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.WriteBuffer=void 0;const a=n(8460),l=n(844);class o extends l.Disposable{constructor(f){super(),this._action=f,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this.register(new a.EventEmitter),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync(f,v){if(v!==void 0&&this._syncCalls>v)return void(this._syncCalls=0);if(this._pendingData+=f.length,this._writeBuffer.push(f),this._callbacks.push(void 0),this._syncCalls++,this._isSyncWriting)return;let d;for(this._isSyncWriting=!0;d=this._writeBuffer.shift();){this._action(d);const t=this._callbacks.shift();t&&t()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}write(f,v){if(this._pendingData>5e7)throw new Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput)return this._didUserInput=!1,this._pendingData+=f.length,this._writeBuffer.push(f),this._callbacks.push(v),void this._innerWrite();setTimeout((()=>this._innerWrite()))}this._pendingData+=f.length,this._writeBuffer.push(f),this._callbacks.push(v)}_innerWrite(f=0,v=!0){const d=f||Date.now();for(;this._writeBuffer.length>this._bufferOffset;){const t=this._writeBuffer[this._bufferOffset],s=this._action(t,v);if(s){const r=h=>Date.now()-d>=12?setTimeout((()=>this._innerWrite(0,h))):this._innerWrite(d,h);return void s.catch((h=>(queueMicrotask((()=>{throw h})),Promise.resolve(!1)))).then(r)}const e=this._callbacks[this._bufferOffset];if(e&&e(),this._bufferOffset++,this._pendingData-=t.length,Date.now()-d>=12)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>50&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout((()=>this._innerWrite()))):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}}i.WriteBuffer=o},5941:(b,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.toRgbString=i.parseColor=void 0;const n=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,a=/^[\da-f]+$/;function l(o,c){const f=o.toString(16),v=f.length<2?"0"+f:f;switch(c){case 4:return f[0];case 8:return v;case 12:return(v+v).slice(0,3);default:return v+v}}i.parseColor=function(o){if(!o)return;let c=o.toLowerCase();if(c.indexOf("rgb:")===0){c=c.slice(4);const f=n.exec(c);if(f){const v=f[1]?15:f[4]?255:f[7]?4095:65535;return[Math.round(parseInt(f[1]||f[4]||f[7]||f[10],16)/v*255),Math.round(parseInt(f[2]||f[5]||f[8]||f[11],16)/v*255),Math.round(parseInt(f[3]||f[6]||f[9]||f[12],16)/v*255)]}}else if(c.indexOf("#")===0&&(c=c.slice(1),a.exec(c)&&[3,6,9,12].includes(c.length))){const f=c.length/3,v=[0,0,0];for(let d=0;d<3;++d){const t=parseInt(c.slice(f*d,f*d+f),16);v[d]=f===1?t<<4:f===2?t:f===3?t>>4:t>>8}return v}},i.toRgbString=function(o,c=16){const[f,v,d]=o;return`rgb:${l(f,c)}/${l(v,c)}/${l(d,c)}`}},5770:(b,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.PAYLOAD_LIMIT=void 0,i.PAYLOAD_LIMIT=1e7},6351:(b,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.DcsHandler=i.DcsParser=void 0;const a=n(482),l=n(8742),o=n(5770),c=[];i.DcsParser=class{constructor(){this._handlers=Object.create(null),this._active=c,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=c}registerHandler(v,d){this._handlers[v]===void 0&&(this._handlers[v]=[]);const t=this._handlers[v];return t.push(d),{dispose:()=>{const s=t.indexOf(d);s!==-1&&t.splice(s,1)}}}clearHandler(v){this._handlers[v]&&delete this._handlers[v]}setHandlerFallback(v){this._handlerFb=v}reset(){if(this._active.length)for(let v=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;v>=0;--v)this._active[v].unhook(!1);this._stack.paused=!1,this._active=c,this._ident=0}hook(v,d){if(this.reset(),this._ident=v,this._active=this._handlers[v]||c,this._active.length)for(let t=this._active.length-1;t>=0;t--)this._active[t].hook(d);else this._handlerFb(this._ident,"HOOK",d)}put(v,d,t){if(this._active.length)for(let s=this._active.length-1;s>=0;s--)this._active[s].put(v,d,t);else this._handlerFb(this._ident,"PUT",(0,a.utf32ToString)(v,d,t))}unhook(v,d=!0){if(this._active.length){let t=!1,s=this._active.length-1,e=!1;if(this._stack.paused&&(s=this._stack.loopPosition-1,t=d,e=this._stack.fallThrough,this._stack.paused=!1),!e&&t===!1){for(;s>=0&&(t=this._active[s].unhook(v),t!==!0);s--)if(t instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=s,this._stack.fallThrough=!1,t;s--}for(;s>=0;s--)if(t=this._active[s].unhook(!1),t instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=s,this._stack.fallThrough=!0,t}else this._handlerFb(this._ident,"UNHOOK",v);this._active=c,this._ident=0}};const f=new l.Params;f.addParam(0),i.DcsHandler=class{constructor(v){this._handler=v,this._data="",this._params=f,this._hitLimit=!1}hook(v){this._params=v.length>1||v.params[0]?v.clone():f,this._data="",this._hitLimit=!1}put(v,d,t){this._hitLimit||(this._data+=(0,a.utf32ToString)(v,d,t),this._data.length>o.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}unhook(v){let d=!1;if(this._hitLimit)d=!1;else if(v&&(d=this._handler(this._data,this._params),d instanceof Promise))return d.then((t=>(this._params=f,this._data="",this._hitLimit=!1,t)));return this._params=f,this._data="",this._hitLimit=!1,d}}},2015:(b,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.EscapeSequenceParser=i.VT500_TRANSITION_TABLE=i.TransitionTable=void 0;const a=n(844),l=n(8742),o=n(6242),c=n(6351);class f{constructor(s){this.table=new Uint8Array(s)}setDefault(s,e){this.table.fill(s<<4|e)}add(s,e,r,h){this.table[e<<8|s]=r<<4|h}addMany(s,e,r,h){for(let _=0;_<s.length;_++)this.table[e<<8|s[_]]=r<<4|h}}i.TransitionTable=f;const v=160;i.VT500_TRANSITION_TABLE=(function(){const t=new f(4095),s=Array.apply(null,Array(256)).map(((g,u)=>u)),e=(g,u)=>s.slice(g,u),r=e(32,127),h=e(0,24);h.push(25),h.push.apply(h,e(28,32));const _=e(0,14);let p;for(p in t.setDefault(1,0),t.addMany(r,0,2,0),_)t.addMany([24,26,153,154],p,3,0),t.addMany(e(128,144),p,3,0),t.addMany(e(144,152),p,3,0),t.add(156,p,0,0),t.add(27,p,11,1),t.add(157,p,4,8),t.addMany([152,158,159],p,0,7),t.add(155,p,11,3),t.add(144,p,11,9);return t.addMany(h,0,3,0),t.addMany(h,1,3,1),t.add(127,1,0,1),t.addMany(h,8,0,8),t.addMany(h,3,3,3),t.add(127,3,0,3),t.addMany(h,4,3,4),t.add(127,4,0,4),t.addMany(h,6,3,6),t.addMany(h,5,3,5),t.add(127,5,0,5),t.addMany(h,2,3,2),t.add(127,2,0,2),t.add(93,1,4,8),t.addMany(r,8,5,8),t.add(127,8,5,8),t.addMany([156,27,24,26,7],8,6,0),t.addMany(e(28,32),8,0,8),t.addMany([88,94,95],1,0,7),t.addMany(r,7,0,7),t.addMany(h,7,0,7),t.add(156,7,0,0),t.add(127,7,0,7),t.add(91,1,11,3),t.addMany(e(64,127),3,7,0),t.addMany(e(48,60),3,8,4),t.addMany([60,61,62,63],3,9,4),t.addMany(e(48,60),4,8,4),t.addMany(e(64,127),4,7,0),t.addMany([60,61,62,63],4,0,6),t.addMany(e(32,64),6,0,6),t.add(127,6,0,6),t.addMany(e(64,127),6,0,0),t.addMany(e(32,48),3,9,5),t.addMany(e(32,48),5,9,5),t.addMany(e(48,64),5,0,6),t.addMany(e(64,127),5,7,0),t.addMany(e(32,48),4,9,5),t.addMany(e(32,48),1,9,2),t.addMany(e(32,48),2,9,2),t.addMany(e(48,127),2,10,0),t.addMany(e(48,80),1,10,0),t.addMany(e(81,88),1,10,0),t.addMany([89,90,92],1,10,0),t.addMany(e(96,127),1,10,0),t.add(80,1,11,9),t.addMany(h,9,0,9),t.add(127,9,0,9),t.addMany(e(28,32),9,0,9),t.addMany(e(32,48),9,9,12),t.addMany(e(48,60),9,8,10),t.addMany([60,61,62,63],9,9,10),t.addMany(h,11,0,11),t.addMany(e(32,128),11,0,11),t.addMany(e(28,32),11,0,11),t.addMany(h,10,0,10),t.add(127,10,0,10),t.addMany(e(28,32),10,0,10),t.addMany(e(48,60),10,8,10),t.addMany([60,61,62,63],10,0,11),t.addMany(e(32,48),10,9,12),t.addMany(h,12,0,12),t.add(127,12,0,12),t.addMany(e(28,32),12,0,12),t.addMany(e(32,48),12,9,12),t.addMany(e(48,64),12,0,11),t.addMany(e(64,127),12,12,13),t.addMany(e(64,127),10,12,13),t.addMany(e(64,127),9,12,13),t.addMany(h,13,13,13),t.addMany(r,13,13,13),t.add(127,13,0,13),t.addMany([27,156,24,26],13,14,0),t.add(v,0,2,0),t.add(v,8,5,8),t.add(v,6,0,6),t.add(v,11,0,11),t.add(v,13,13,13),t})();class d extends a.Disposable{constructor(s=i.VT500_TRANSITION_TABLE){super(),this._transitions=s,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new l.Params,this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._printHandlerFb=(e,r,h)=>{},this._executeHandlerFb=e=>{},this._csiHandlerFb=(e,r)=>{},this._escHandlerFb=e=>{},this._errorHandlerFb=e=>e,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this.register((0,a.toDisposable)((()=>{this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null)}))),this._oscParser=this.register(new o.OscParser),this._dcsParser=this.register(new c.DcsParser),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},(()=>!0))}_identifier(s,e=[64,126]){let r=0;if(s.prefix){if(s.prefix.length>1)throw new Error("only one byte as prefix supported");if(r=s.prefix.charCodeAt(0),r&&60>r||r>63)throw new Error("prefix must be in range 0x3c .. 0x3f")}if(s.intermediates){if(s.intermediates.length>2)throw new Error("only two bytes as intermediates are supported");for(let _=0;_<s.intermediates.length;++_){const p=s.intermediates.charCodeAt(_);if(32>p||p>47)throw new Error("intermediate must be in range 0x20 .. 0x2f");r<<=8,r|=p}}if(s.final.length!==1)throw new Error("final must be a single byte");const h=s.final.charCodeAt(0);if(e[0]>h||h>e[1])throw new Error(`final must be in range ${e[0]} .. ${e[1]}`);return r<<=8,r|=h,r}identToString(s){const e=[];for(;s;)e.push(String.fromCharCode(255&s)),s>>=8;return e.reverse().join("")}setPrintHandler(s){this._printHandler=s}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler(s,e){const r=this._identifier(s,[48,126]);this._escHandlers[r]===void 0&&(this._escHandlers[r]=[]);const h=this._escHandlers[r];return h.push(e),{dispose:()=>{const _=h.indexOf(e);_!==-1&&h.splice(_,1)}}}clearEscHandler(s){this._escHandlers[this._identifier(s,[48,126])]&&delete this._escHandlers[this._identifier(s,[48,126])]}setEscHandlerFallback(s){this._escHandlerFb=s}setExecuteHandler(s,e){this._executeHandlers[s.charCodeAt(0)]=e}clearExecuteHandler(s){this._executeHandlers[s.charCodeAt(0)]&&delete this._executeHandlers[s.charCodeAt(0)]}setExecuteHandlerFallback(s){this._executeHandlerFb=s}registerCsiHandler(s,e){const r=this._identifier(s);this._csiHandlers[r]===void 0&&(this._csiHandlers[r]=[]);const h=this._csiHandlers[r];return h.push(e),{dispose:()=>{const _=h.indexOf(e);_!==-1&&h.splice(_,1)}}}clearCsiHandler(s){this._csiHandlers[this._identifier(s)]&&delete this._csiHandlers[this._identifier(s)]}setCsiHandlerFallback(s){this._csiHandlerFb=s}registerDcsHandler(s,e){return this._dcsParser.registerHandler(this._identifier(s),e)}clearDcsHandler(s){this._dcsParser.clearHandler(this._identifier(s))}setDcsHandlerFallback(s){this._dcsParser.setHandlerFallback(s)}registerOscHandler(s,e){return this._oscParser.registerHandler(s,e)}clearOscHandler(s){this._oscParser.clearHandler(s)}setOscHandlerFallback(s){this._oscParser.setHandlerFallback(s)}setErrorHandler(s){this._errorHandler=s}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._parseStack.state!==0&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack(s,e,r,h,_){this._parseStack.state=s,this._parseStack.handlers=e,this._parseStack.handlerPos=r,this._parseStack.transition=h,this._parseStack.chunkPos=_}parse(s,e,r){let h,_=0,p=0,g=0;if(this._parseStack.state)if(this._parseStack.state===2)this._parseStack.state=0,g=this._parseStack.chunkPos+1;else{if(r===void 0||this._parseStack.state===1)throw this._parseStack.state=1,new Error("improper continuation due to previous async handler, giving up parsing");const u=this._parseStack.handlers;let m=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(r===!1&&m>-1){for(;m>=0&&(h=u[m](this._params),h!==!0);m--)if(h instanceof Promise)return this._parseStack.handlerPos=m,h}this._parseStack.handlers=[];break;case 4:if(r===!1&&m>-1){for(;m>=0&&(h=u[m](),h!==!0);m--)if(h instanceof Promise)return this._parseStack.handlerPos=m,h}this._parseStack.handlers=[];break;case 6:if(_=s[this._parseStack.chunkPos],h=this._dcsParser.unhook(_!==24&&_!==26,r),h)return h;_===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(_=s[this._parseStack.chunkPos],h=this._oscParser.end(_!==24&&_!==26,r),h)return h;_===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0}this._parseStack.state=0,g=this._parseStack.chunkPos+1,this.precedingJoinState=0,this.currentState=15&this._parseStack.transition}for(let u=g;u<e;++u){switch(_=s[u],p=this._transitions.table[this.currentState<<8|(_<160?_:v)],p>>4){case 2:for(let L=u+1;;++L){if(L>=e||(_=s[L])<32||_>126&&_<v){this._printHandler(s,u,L),u=L-1;break}if(++L>=e||(_=s[L])<32||_>126&&_<v){this._printHandler(s,u,L),u=L-1;break}if(++L>=e||(_=s[L])<32||_>126&&_<v){this._printHandler(s,u,L),u=L-1;break}if(++L>=e||(_=s[L])<32||_>126&&_<v){this._printHandler(s,u,L),u=L-1;break}}break;case 3:this._executeHandlers[_]?this._executeHandlers[_]():this._executeHandlerFb(_),this.precedingJoinState=0;break;case 0:break;case 1:if(this._errorHandler({position:u,code:_,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:const m=this._csiHandlers[this._collect<<8|_];let B=m?m.length-1:-1;for(;B>=0&&(h=m[B](this._params),h!==!0);B--)if(h instanceof Promise)return this._preserveStack(3,m,B,p,u),h;B<0&&this._csiHandlerFb(this._collect<<8|_,this._params),this.precedingJoinState=0;break;case 8:do switch(_){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(_-48)}while(++u<e&&(_=s[u])>47&&_<60);u--;break;case 9:this._collect<<=8,this._collect|=_;break;case 10:const A=this._escHandlers[this._collect<<8|_];let O=A?A.length-1:-1;for(;O>=0&&(h=A[O](),h!==!0);O--)if(h instanceof Promise)return this._preserveStack(4,A,O,p,u),h;O<0&&this._escHandlerFb(this._collect<<8|_),this.precedingJoinState=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|_,this._params);break;case 13:for(let L=u+1;;++L)if(L>=e||(_=s[L])===24||_===26||_===27||_>127&&_<v){this._dcsParser.put(s,u,L),u=L-1;break}break;case 14:if(h=this._dcsParser.unhook(_!==24&&_!==26),h)return this._preserveStack(6,[],0,p,u),h;_===27&&(p|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break;case 4:this._oscParser.start();break;case 5:for(let L=u+1;;L++)if(L>=e||(_=s[L])<32||_>127&&_<v){this._oscParser.put(s,u,L),u=L-1;break}break;case 6:if(h=this._oscParser.end(_!==24&&_!==26),h)return this._preserveStack(5,[],0,p,u),h;_===27&&(p|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0}this.currentState=15&p}}}i.EscapeSequenceParser=d},6242:(b,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.OscHandler=i.OscParser=void 0;const a=n(5770),l=n(482),o=[];i.OscParser=class{constructor(){this._state=0,this._active=o,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler(c,f){this._handlers[c]===void 0&&(this._handlers[c]=[]);const v=this._handlers[c];return v.push(f),{dispose:()=>{const d=v.indexOf(f);d!==-1&&v.splice(d,1)}}}clearHandler(c){this._handlers[c]&&delete this._handlers[c]}setHandlerFallback(c){this._handlerFb=c}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=o}reset(){if(this._state===2)for(let c=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;c>=0;--c)this._active[c].end(!1);this._stack.paused=!1,this._active=o,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||o,this._active.length)for(let c=this._active.length-1;c>=0;c--)this._active[c].start();else this._handlerFb(this._id,"START")}_put(c,f,v){if(this._active.length)for(let d=this._active.length-1;d>=0;d--)this._active[d].put(c,f,v);else this._handlerFb(this._id,"PUT",(0,l.utf32ToString)(c,f,v))}start(){this.reset(),this._state=1}put(c,f,v){if(this._state!==3){if(this._state===1)for(;f<v;){const d=c[f++];if(d===59){this._state=2,this._start();break}if(d<48||57<d)return void(this._state=3);this._id===-1&&(this._id=0),this._id=10*this._id+d-48}this._state===2&&v-f>0&&this._put(c,f,v)}}end(c,f=!0){if(this._state!==0){if(this._state!==3)if(this._state===1&&this._start(),this._active.length){let v=!1,d=this._active.length-1,t=!1;if(this._stack.paused&&(d=this._stack.loopPosition-1,v=f,t=this._stack.fallThrough,this._stack.paused=!1),!t&&v===!1){for(;d>=0&&(v=this._active[d].end(c),v!==!0);d--)if(v instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=d,this._stack.fallThrough=!1,v;d--}for(;d>=0;d--)if(v=this._active[d].end(!1),v instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=d,this._stack.fallThrough=!0,v}else this._handlerFb(this._id,"END",c);this._active=o,this._id=-1,this._state=0}}},i.OscHandler=class{constructor(c){this._handler=c,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put(c,f,v){this._hitLimit||(this._data+=(0,l.utf32ToString)(c,f,v),this._data.length>a.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}end(c){let f=!1;if(this._hitLimit)f=!1;else if(c&&(f=this._handler(this._data),f instanceof Promise))return f.then((v=>(this._data="",this._hitLimit=!1,v)));return this._data="",this._hitLimit=!1,f}}},8742:(b,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Params=void 0;const n=2147483647;class a{static fromArray(o){const c=new a;if(!o.length)return c;for(let f=Array.isArray(o[0])?1:0;f<o.length;++f){const v=o[f];if(Array.isArray(v))for(let d=0;d<v.length;++d)c.addSubParam(v[d]);else c.addParam(v)}return c}constructor(o=32,c=32){if(this.maxLength=o,this.maxSubParamsLength=c,c>256)throw new Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(o),this.length=0,this._subParams=new Int32Array(c),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(o),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}clone(){const o=new a(this.maxLength,this.maxSubParamsLength);return o.params.set(this.params),o.length=this.length,o._subParams.set(this._subParams),o._subParamsLength=this._subParamsLength,o._subParamsIdx.set(this._subParamsIdx),o._rejectDigits=this._rejectDigits,o._rejectSubDigits=this._rejectSubDigits,o._digitIsSub=this._digitIsSub,o}toArray(){const o=[];for(let c=0;c<this.length;++c){o.push(this.params[c]);const f=this._subParamsIdx[c]>>8,v=255&this._subParamsIdx[c];v-f>0&&o.push(Array.prototype.slice.call(this._subParams,f,v))}return o}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(o){if(this._digitIsSub=!1,this.length>=this.maxLength)this._rejectDigits=!0;else{if(o<-1)throw new Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=o>n?n:o}}addSubParam(o){if(this._digitIsSub=!0,this.length)if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength)this._rejectSubDigits=!0;else{if(o<-1)throw new Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=o>n?n:o,this._subParamsIdx[this.length-1]++}}hasSubParams(o){return(255&this._subParamsIdx[o])-(this._subParamsIdx[o]>>8)>0}getSubParams(o){const c=this._subParamsIdx[o]>>8,f=255&this._subParamsIdx[o];return f-c>0?this._subParams.subarray(c,f):null}getSubParamsAll(){const o={};for(let c=0;c<this.length;++c){const f=this._subParamsIdx[c]>>8,v=255&this._subParamsIdx[c];v-f>0&&(o[c]=this._subParams.slice(f,v))}return o}addDigit(o){let c;if(this._rejectDigits||!(c=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;const f=this._digitIsSub?this._subParams:this.params,v=f[c-1];f[c-1]=~v?Math.min(10*v+o,n):o}}i.Params=a},5741:(b,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.AddonManager=void 0,i.AddonManager=class{constructor(){this._addons=[]}dispose(){for(let n=this._addons.length-1;n>=0;n--)this._addons[n].instance.dispose()}loadAddon(n,a){const l={instance:a,dispose:a.dispose,isDisposed:!1};this._addons.push(l),a.dispose=()=>this._wrappedAddonDispose(l),a.activate(n)}_wrappedAddonDispose(n){if(n.isDisposed)return;let a=-1;for(let l=0;l<this._addons.length;l++)if(this._addons[l]===n){a=l;break}if(a===-1)throw new Error("Could not dispose an addon that has not been loaded");n.isDisposed=!0,n.dispose.apply(n.instance),this._addons.splice(a,1)}}},8771:(b,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.BufferApiView=void 0;const a=n(3785),l=n(511);i.BufferApiView=class{constructor(o,c){this._buffer=o,this.type=c}init(o){return this._buffer=o,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine(o){const c=this._buffer.lines.get(o);if(c)return new a.BufferLineApiView(c)}getNullCell(){return new l.CellData}}},3785:(b,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.BufferLineApiView=void 0;const a=n(511);i.BufferLineApiView=class{constructor(l){this._line=l}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell(l,o){if(!(l<0||l>=this._line.length))return o?(this._line.loadCell(l,o),o):this._line.loadCell(l,new a.CellData)}translateToString(l,o,c){return this._line.translateToString(l,o,c)}}},8285:(b,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.BufferNamespaceApi=void 0;const a=n(8771),l=n(8460),o=n(844);class c extends o.Disposable{constructor(v){super(),this._core=v,this._onBufferChange=this.register(new l.EventEmitter),this.onBufferChange=this._onBufferChange.event,this._normal=new a.BufferApiView(this._core.buffers.normal,"normal"),this._alternate=new a.BufferApiView(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate((()=>this._onBufferChange.fire(this.active)))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw new Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}}i.BufferNamespaceApi=c},7975:(b,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.ParserApi=void 0,i.ParserApi=class{constructor(n){this._core=n}registerCsiHandler(n,a){return this._core.registerCsiHandler(n,(l=>a(l.toArray())))}addCsiHandler(n,a){return this.registerCsiHandler(n,a)}registerDcsHandler(n,a){return this._core.registerDcsHandler(n,((l,o)=>a(l,o.toArray())))}addDcsHandler(n,a){return this.registerDcsHandler(n,a)}registerEscHandler(n,a){return this._core.registerEscHandler(n,a)}addEscHandler(n,a){return this.registerEscHandler(n,a)}registerOscHandler(n,a){return this._core.registerOscHandler(n,a)}addOscHandler(n,a){return this.registerOscHandler(n,a)}}},7090:(b,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.UnicodeApi=void 0,i.UnicodeApi=class{constructor(n){this._core=n}register(n){this._core.unicodeService.register(n)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion(n){this._core.unicodeService.activeVersion=n}}},744:function(b,i,n){var a=this&&this.__decorate||function(t,s,e,r){var h,_=arguments.length,p=_<3?s:r===null?r=Object.getOwnPropertyDescriptor(s,e):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")p=Reflect.decorate(t,s,e,r);else for(var g=t.length-1;g>=0;g--)(h=t[g])&&(p=(_<3?h(p):_>3?h(s,e,p):h(s,e))||p);return _>3&&p&&Object.defineProperty(s,e,p),p},l=this&&this.__param||function(t,s){return function(e,r){s(e,r,t)}};Object.defineProperty(i,"__esModule",{value:!0}),i.BufferService=i.MINIMUM_ROWS=i.MINIMUM_COLS=void 0;const o=n(8460),c=n(844),f=n(5295),v=n(2585);i.MINIMUM_COLS=2,i.MINIMUM_ROWS=1;let d=i.BufferService=class extends c.Disposable{get buffer(){return this.buffers.active}constructor(t){super(),this.isUserScrolling=!1,this._onResize=this.register(new o.EventEmitter),this.onResize=this._onResize.event,this._onScroll=this.register(new o.EventEmitter),this.onScroll=this._onScroll.event,this.cols=Math.max(t.rawOptions.cols||0,i.MINIMUM_COLS),this.rows=Math.max(t.rawOptions.rows||0,i.MINIMUM_ROWS),this.buffers=this.register(new f.BufferSet(t,this))}resize(t,s){this.cols=t,this.rows=s,this.buffers.resize(t,s),this._onResize.fire({cols:t,rows:s})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll(t,s=!1){const e=this.buffer;let r;r=this._cachedBlankLine,r&&r.length===this.cols&&r.getFg(0)===t.fg&&r.getBg(0)===t.bg||(r=e.getBlankLine(t,s),this._cachedBlankLine=r),r.isWrapped=s;const h=e.ybase+e.scrollTop,_=e.ybase+e.scrollBottom;if(e.scrollTop===0){const p=e.lines.isFull;_===e.lines.length-1?p?e.lines.recycle().copyFrom(r):e.lines.push(r.clone()):e.lines.splice(_+1,0,r.clone()),p?this.isUserScrolling&&(e.ydisp=Math.max(e.ydisp-1,0)):(e.ybase++,this.isUserScrolling||e.ydisp++)}else{const p=_-h+1;e.lines.shiftElements(h+1,p-1,-1),e.lines.set(_,r.clone())}this.isUserScrolling||(e.ydisp=e.ybase),this._onScroll.fire(e.ydisp)}scrollLines(t,s,e){const r=this.buffer;if(t<0){if(r.ydisp===0)return;this.isUserScrolling=!0}else t+r.ydisp>=r.ybase&&(this.isUserScrolling=!1);const h=r.ydisp;r.ydisp=Math.max(Math.min(r.ydisp+t,r.ybase),0),h!==r.ydisp&&(s||this._onScroll.fire(r.ydisp))}};i.BufferService=d=a([l(0,v.IOptionsService)],d)},7994:(b,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.CharsetService=void 0,i.CharsetService=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel(n){this.glevel=n,this.charset=this._charsets[n]}setgCharset(n,a){this._charsets[n]=a,this.glevel===n&&(this.charset=a)}}},1753:function(b,i,n){var a=this&&this.__decorate||function(r,h,_,p){var g,u=arguments.length,m=u<3?h:p===null?p=Object.getOwnPropertyDescriptor(h,_):p;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")m=Reflect.decorate(r,h,_,p);else for(var B=r.length-1;B>=0;B--)(g=r[B])&&(m=(u<3?g(m):u>3?g(h,_,m):g(h,_))||m);return u>3&&m&&Object.defineProperty(h,_,m),m},l=this&&this.__param||function(r,h){return function(_,p){h(_,p,r)}};Object.defineProperty(i,"__esModule",{value:!0}),i.CoreMouseService=void 0;const o=n(2585),c=n(8460),f=n(844),v={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:r=>r.button!==4&&r.action===1&&(r.ctrl=!1,r.alt=!1,r.shift=!1,!0)},VT200:{events:19,restrict:r=>r.action!==32},DRAG:{events:23,restrict:r=>r.action!==32||r.button!==3},ANY:{events:31,restrict:r=>!0}};function d(r,h){let _=(r.ctrl?16:0)|(r.shift?4:0)|(r.alt?8:0);return r.button===4?(_|=64,_|=r.action):(_|=3&r.button,4&r.button&&(_|=64),8&r.button&&(_|=128),r.action===32?_|=32:r.action!==0||h||(_|=3)),_}const t=String.fromCharCode,s={DEFAULT:r=>{const h=[d(r,!1)+32,r.col+32,r.row+32];return h[0]>255||h[1]>255||h[2]>255?"":`\x1B[M${t(h[0])}${t(h[1])}${t(h[2])}`},SGR:r=>{const h=r.action===0&&r.button!==4?"m":"M";return`\x1B[<${d(r,!0)};${r.col};${r.row}${h}`},SGR_PIXELS:r=>{const h=r.action===0&&r.button!==4?"m":"M";return`\x1B[<${d(r,!0)};${r.x};${r.y}${h}`}};let e=i.CoreMouseService=class extends f.Disposable{constructor(r,h){super(),this._bufferService=r,this._coreService=h,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._onProtocolChange=this.register(new c.EventEmitter),this.onProtocolChange=this._onProtocolChange.event;for(const _ of Object.keys(v))this.addProtocol(_,v[_]);for(const _ of Object.keys(s))this.addEncoding(_,s[_]);this.reset()}addProtocol(r,h){this._protocols[r]=h}addEncoding(r,h){this._encodings[r]=h}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return this._protocols[this._activeProtocol].events!==0}set activeProtocol(r){if(!this._protocols[r])throw new Error(`unknown protocol "${r}"`);this._activeProtocol=r,this._onProtocolChange.fire(this._protocols[r].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding(r){if(!this._encodings[r])throw new Error(`unknown encoding "${r}"`);this._activeEncoding=r}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null}triggerMouseEvent(r){if(r.col<0||r.col>=this._bufferService.cols||r.row<0||r.row>=this._bufferService.rows||r.button===4&&r.action===32||r.button===3&&r.action!==32||r.button!==4&&(r.action===2||r.action===3)||(r.col++,r.row++,r.action===32&&this._lastEvent&&this._equalEvents(this._lastEvent,r,this._activeEncoding==="SGR_PIXELS"))||!this._protocols[this._activeProtocol].restrict(r))return!1;const h=this._encodings[this._activeEncoding](r);return h&&(this._activeEncoding==="DEFAULT"?this._coreService.triggerBinaryEvent(h):this._coreService.triggerDataEvent(h,!0)),this._lastEvent=r,!0}explainEvents(r){return{down:!!(1&r),up:!!(2&r),drag:!!(4&r),move:!!(8&r),wheel:!!(16&r)}}_equalEvents(r,h,_){if(_){if(r.x!==h.x||r.y!==h.y)return!1}else if(r.col!==h.col||r.row!==h.row)return!1;return r.button===h.button&&r.action===h.action&&r.ctrl===h.ctrl&&r.alt===h.alt&&r.shift===h.shift}};i.CoreMouseService=e=a([l(0,o.IBufferService),l(1,o.ICoreService)],e)},6975:function(b,i,n){var a=this&&this.__decorate||function(e,r,h,_){var p,g=arguments.length,u=g<3?r:_===null?_=Object.getOwnPropertyDescriptor(r,h):_;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(e,r,h,_);else for(var m=e.length-1;m>=0;m--)(p=e[m])&&(u=(g<3?p(u):g>3?p(r,h,u):p(r,h))||u);return g>3&&u&&Object.defineProperty(r,h,u),u},l=this&&this.__param||function(e,r){return function(h,_){r(h,_,e)}};Object.defineProperty(i,"__esModule",{value:!0}),i.CoreService=void 0;const o=n(1439),c=n(8460),f=n(844),v=n(2585),d=Object.freeze({insertMode:!1}),t=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,origin:!1,reverseWraparound:!1,sendFocus:!1,wraparound:!0});let s=i.CoreService=class extends f.Disposable{constructor(e,r,h){super(),this._bufferService=e,this._logService=r,this._optionsService=h,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this.register(new c.EventEmitter),this.onData=this._onData.event,this._onUserInput=this.register(new c.EventEmitter),this.onUserInput=this._onUserInput.event,this._onBinary=this.register(new c.EventEmitter),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this.register(new c.EventEmitter),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=(0,o.clone)(d),this.decPrivateModes=(0,o.clone)(t)}reset(){this.modes=(0,o.clone)(d),this.decPrivateModes=(0,o.clone)(t)}triggerDataEvent(e,r=!1){if(this._optionsService.rawOptions.disableStdin)return;const h=this._bufferService.buffer;r&&this._optionsService.rawOptions.scrollOnUserInput&&h.ybase!==h.ydisp&&this._onRequestScrollToBottom.fire(),r&&this._onUserInput.fire(),this._logService.debug(`sending data "${e}"`,(()=>e.split("").map((_=>_.charCodeAt(0))))),this._onData.fire(e)}triggerBinaryEvent(e){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${e}"`,(()=>e.split("").map((r=>r.charCodeAt(0))))),this._onBinary.fire(e))}};i.CoreService=s=a([l(0,v.IBufferService),l(1,v.ILogService),l(2,v.IOptionsService)],s)},9074:(b,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.DecorationService=void 0;const a=n(8055),l=n(8460),o=n(844),c=n(6106);let f=0,v=0;class d extends o.Disposable{get decorations(){return this._decorations.values()}constructor(){super(),this._decorations=new c.SortedList((e=>e?.marker.line)),this._onDecorationRegistered=this.register(new l.EventEmitter),this.onDecorationRegistered=this._onDecorationRegistered.event,this._onDecorationRemoved=this.register(new l.EventEmitter),this.onDecorationRemoved=this._onDecorationRemoved.event,this.register((0,o.toDisposable)((()=>this.reset())))}registerDecoration(e){if(e.marker.isDisposed)return;const r=new t(e);if(r){const h=r.marker.onDispose((()=>r.dispose()));r.onDispose((()=>{r&&(this._decorations.delete(r)&&this._onDecorationRemoved.fire(r),h.dispose())})),this._decorations.insert(r),this._onDecorationRegistered.fire(r)}return r}reset(){for(const e of this._decorations.values())e.dispose();this._decorations.clear()}*getDecorationsAtCell(e,r,h){let _=0,p=0;for(const g of this._decorations.getKeyIterator(r))_=g.options.x??0,p=_+(g.options.width??1),e>=_&&e<p&&(!h||(g.options.layer??"bottom")===h)&&(yield g)}forEachDecorationAtCell(e,r,h,_){this._decorations.forEachByKey(r,(p=>{f=p.options.x??0,v=f+(p.options.width??1),e>=f&&e<v&&(!h||(p.options.layer??"bottom")===h)&&_(p)}))}}i.DecorationService=d;class t extends o.Disposable{get isDisposed(){return this._isDisposed}get backgroundColorRGB(){return this._cachedBg===null&&(this.options.backgroundColor?this._cachedBg=a.css.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}get foregroundColorRGB(){return this._cachedFg===null&&(this.options.foregroundColor?this._cachedFg=a.css.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}constructor(e){super(),this.options=e,this.onRenderEmitter=this.register(new l.EventEmitter),this.onRender=this.onRenderEmitter.event,this._onDispose=this.register(new l.EventEmitter),this.onDispose=this._onDispose.event,this._cachedBg=null,this._cachedFg=null,this.marker=e.marker,this.options.overviewRulerOptions&&!this.options.overviewRulerOptions.position&&(this.options.overviewRulerOptions.position="full")}dispose(){this._onDispose.fire(),super.dispose()}}},4348:(b,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.InstantiationService=i.ServiceCollection=void 0;const a=n(2585),l=n(8343);class o{constructor(...f){this._entries=new Map;for(const[v,d]of f)this.set(v,d)}set(f,v){const d=this._entries.get(f);return this._entries.set(f,v),d}forEach(f){for(const[v,d]of this._entries.entries())f(v,d)}has(f){return this._entries.has(f)}get(f){return this._entries.get(f)}}i.ServiceCollection=o,i.InstantiationService=class{constructor(){this._services=new o,this._services.set(a.IInstantiationService,this)}setService(c,f){this._services.set(c,f)}getService(c){return this._services.get(c)}createInstance(c,...f){const v=(0,l.getServiceDependencies)(c).sort(((s,e)=>s.index-e.index)),d=[];for(const s of v){const e=this._services.get(s.id);if(!e)throw new Error(`[createInstance] ${c.name} depends on UNKNOWN service ${s.id}.`);d.push(e)}const t=v.length>0?v[0].index:f.length;if(f.length!==t)throw new Error(`[createInstance] First service dependency of ${c.name} at position ${t+1} conflicts with ${f.length} static arguments`);return new c(...f,...d)}}},7866:function(b,i,n){var a=this&&this.__decorate||function(t,s,e,r){var h,_=arguments.length,p=_<3?s:r===null?r=Object.getOwnPropertyDescriptor(s,e):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")p=Reflect.decorate(t,s,e,r);else for(var g=t.length-1;g>=0;g--)(h=t[g])&&(p=(_<3?h(p):_>3?h(s,e,p):h(s,e))||p);return _>3&&p&&Object.defineProperty(s,e,p),p},l=this&&this.__param||function(t,s){return function(e,r){s(e,r,t)}};Object.defineProperty(i,"__esModule",{value:!0}),i.traceCall=i.setTraceLogger=i.LogService=void 0;const o=n(844),c=n(2585),f={trace:c.LogLevelEnum.TRACE,debug:c.LogLevelEnum.DEBUG,info:c.LogLevelEnum.INFO,warn:c.LogLevelEnum.WARN,error:c.LogLevelEnum.ERROR,off:c.LogLevelEnum.OFF};let v,d=i.LogService=class extends o.Disposable{get logLevel(){return this._logLevel}constructor(t){super(),this._optionsService=t,this._logLevel=c.LogLevelEnum.OFF,this._updateLogLevel(),this.register(this._optionsService.onSpecificOptionChange("logLevel",(()=>this._updateLogLevel()))),v=this}_updateLogLevel(){this._logLevel=f[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(t){for(let s=0;s<t.length;s++)typeof t[s]=="function"&&(t[s]=t[s]())}_log(t,s,e){this._evalLazyOptionalParams(e),t.call(console,(this._optionsService.options.logger?"":"xterm.js: ")+s,...e)}trace(t,...s){this._logLevel<=c.LogLevelEnum.TRACE&&this._log(this._optionsService.options.logger?.trace.bind(this._optionsService.options.logger)??console.log,t,s)}debug(t,...s){this._logLevel<=c.LogLevelEnum.DEBUG&&this._log(this._optionsService.options.logger?.debug.bind(this._optionsService.options.logger)??console.log,t,s)}info(t,...s){this._logLevel<=c.LogLevelEnum.INFO&&this._log(this._optionsService.options.logger?.info.bind(this._optionsService.options.logger)??console.info,t,s)}warn(t,...s){this._logLevel<=c.LogLevelEnum.WARN&&this._log(this._optionsService.options.logger?.warn.bind(this._optionsService.options.logger)??console.warn,t,s)}error(t,...s){this._logLevel<=c.LogLevelEnum.ERROR&&this._log(this._optionsService.options.logger?.error.bind(this._optionsService.options.logger)??console.error,t,s)}};i.LogService=d=a([l(0,c.IOptionsService)],d),i.setTraceLogger=function(t){v=t},i.traceCall=function(t,s,e){if(typeof e.value!="function")throw new Error("not supported");const r=e.value;e.value=function(...h){if(v.logLevel!==c.LogLevelEnum.TRACE)return r.apply(this,h);v.trace(`GlyphRenderer#${r.name}(${h.map((p=>JSON.stringify(p))).join(", ")})`);const _=r.apply(this,h);return v.trace(`GlyphRenderer#${r.name} return`,_),_}}},7302:(b,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.OptionsService=i.DEFAULT_OPTIONS=void 0;const a=n(8460),l=n(844),o=n(6114);i.DEFAULT_OPTIONS={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,cursorInactiveStyle:"outline",customGlyphs:!0,drawBoldTextInBrightColors:!0,documentOverride:null,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"courier-new, courier, monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",ignoreBracketedPasteMode:!1,lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",logger:null,scrollback:1e3,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},rescaleOverlappingGlyphs:!1,rightClickSelectsWord:o.isMac,windowOptions:{},windowsMode:!1,windowsPty:{},wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRulerWidth:0};const c=["normal","bold","100","200","300","400","500","600","700","800","900"];class f extends l.Disposable{constructor(d){super(),this._onOptionChange=this.register(new a.EventEmitter),this.onOptionChange=this._onOptionChange.event;const t={...i.DEFAULT_OPTIONS};for(const s in d)if(s in t)try{const e=d[s];t[s]=this._sanitizeAndValidateOption(s,e)}catch(e){console.error(e)}this.rawOptions=t,this.options={...t},this._setupOptions(),this.register((0,l.toDisposable)((()=>{this.rawOptions.linkHandler=null,this.rawOptions.documentOverride=null})))}onSpecificOptionChange(d,t){return this.onOptionChange((s=>{s===d&&t(this.rawOptions[d])}))}onMultipleOptionChange(d,t){return this.onOptionChange((s=>{d.indexOf(s)!==-1&&t()}))}_setupOptions(){const d=s=>{if(!(s in i.DEFAULT_OPTIONS))throw new Error(`No option with key "${s}"`);return this.rawOptions[s]},t=(s,e)=>{if(!(s in i.DEFAULT_OPTIONS))throw new Error(`No option with key "${s}"`);e=this._sanitizeAndValidateOption(s,e),this.rawOptions[s]!==e&&(this.rawOptions[s]=e,this._onOptionChange.fire(s))};for(const s in this.rawOptions){const e={get:d.bind(this,s),set:t.bind(this,s)};Object.defineProperty(this.options,s,e)}}_sanitizeAndValidateOption(d,t){switch(d){case"cursorStyle":if(t||(t=i.DEFAULT_OPTIONS[d]),!(function(s){return s==="block"||s==="underline"||s==="bar"})(t))throw new Error(`"${t}" is not a valid value for ${d}`);break;case"wordSeparator":t||(t=i.DEFAULT_OPTIONS[d]);break;case"fontWeight":case"fontWeightBold":if(typeof t=="number"&&1<=t&&t<=1e3)break;t=c.includes(t)?t:i.DEFAULT_OPTIONS[d];break;case"cursorWidth":t=Math.floor(t);case"lineHeight":case"tabStopWidth":if(t<1)throw new Error(`${d} cannot be less than 1, value: ${t}`);break;case"minimumContrastRatio":t=Math.max(1,Math.min(21,Math.round(10*t)/10));break;case"scrollback":if((t=Math.min(t,4294967295))<0)throw new Error(`${d} cannot be less than 0, value: ${t}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(t<=0)throw new Error(`${d} cannot be less than or equal to 0, value: ${t}`);break;case"rows":case"cols":if(!t&&t!==0)throw new Error(`${d} must be numeric, value: ${t}`);break;case"windowsPty":t=t??{}}return t}}i.OptionsService=f},2660:function(b,i,n){var a=this&&this.__decorate||function(f,v,d,t){var s,e=arguments.length,r=e<3?v:t===null?t=Object.getOwnPropertyDescriptor(v,d):t;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(f,v,d,t);else for(var h=f.length-1;h>=0;h--)(s=f[h])&&(r=(e<3?s(r):e>3?s(v,d,r):s(v,d))||r);return e>3&&r&&Object.defineProperty(v,d,r),r},l=this&&this.__param||function(f,v){return function(d,t){v(d,t,f)}};Object.defineProperty(i,"__esModule",{value:!0}),i.OscLinkService=void 0;const o=n(2585);let c=i.OscLinkService=class{constructor(f){this._bufferService=f,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink(f){const v=this._bufferService.buffer;if(f.id===void 0){const h=v.addMarker(v.ybase+v.y),_={data:f,id:this._nextId++,lines:[h]};return h.onDispose((()=>this._removeMarkerFromLink(_,h))),this._dataByLinkId.set(_.id,_),_.id}const d=f,t=this._getEntryIdKey(d),s=this._entriesWithId.get(t);if(s)return this.addLineToLink(s.id,v.ybase+v.y),s.id;const e=v.addMarker(v.ybase+v.y),r={id:this._nextId++,key:this._getEntryIdKey(d),data:d,lines:[e]};return e.onDispose((()=>this._removeMarkerFromLink(r,e))),this._entriesWithId.set(r.key,r),this._dataByLinkId.set(r.id,r),r.id}addLineToLink(f,v){const d=this._dataByLinkId.get(f);if(d&&d.lines.every((t=>t.line!==v))){const t=this._bufferService.buffer.addMarker(v);d.lines.push(t),t.onDispose((()=>this._removeMarkerFromLink(d,t)))}}getLinkData(f){return this._dataByLinkId.get(f)?.data}_getEntryIdKey(f){return`${f.id};;${f.uri}`}_removeMarkerFromLink(f,v){const d=f.lines.indexOf(v);d!==-1&&(f.lines.splice(d,1),f.lines.length===0&&(f.data.id!==void 0&&this._entriesWithId.delete(f.key),this._dataByLinkId.delete(f.id)))}};i.OscLinkService=c=a([l(0,o.IBufferService)],c)},8343:(b,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.createDecorator=i.getServiceDependencies=i.serviceRegistry=void 0;const n="di$target",a="di$dependencies";i.serviceRegistry=new Map,i.getServiceDependencies=function(l){return l[a]||[]},i.createDecorator=function(l){if(i.serviceRegistry.has(l))return i.serviceRegistry.get(l);const o=function(c,f,v){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");(function(d,t,s){t[n]===t?t[a].push({id:d,index:s}):(t[a]=[{id:d,index:s}],t[n]=t)})(o,c,v)};return o.toString=()=>l,i.serviceRegistry.set(l,o),o}},2585:(b,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.IDecorationService=i.IUnicodeService=i.IOscLinkService=i.IOptionsService=i.ILogService=i.LogLevelEnum=i.IInstantiationService=i.ICharsetService=i.ICoreService=i.ICoreMouseService=i.IBufferService=void 0;const a=n(8343);var l;i.IBufferService=(0,a.createDecorator)("BufferService"),i.ICoreMouseService=(0,a.createDecorator)("CoreMouseService"),i.ICoreService=(0,a.createDecorator)("CoreService"),i.ICharsetService=(0,a.createDecorator)("CharsetService"),i.IInstantiationService=(0,a.createDecorator)("InstantiationService"),(function(o){o[o.TRACE=0]="TRACE",o[o.DEBUG=1]="DEBUG",o[o.INFO=2]="INFO",o[o.WARN=3]="WARN",o[o.ERROR=4]="ERROR",o[o.OFF=5]="OFF"})(l||(i.LogLevelEnum=l={})),i.ILogService=(0,a.createDecorator)("LogService"),i.IOptionsService=(0,a.createDecorator)("OptionsService"),i.IOscLinkService=(0,a.createDecorator)("OscLinkService"),i.IUnicodeService=(0,a.createDecorator)("UnicodeService"),i.IDecorationService=(0,a.createDecorator)("DecorationService")},1480:(b,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.UnicodeService=void 0;const a=n(8460),l=n(225);class o{static extractShouldJoin(f){return(1&f)!=0}static extractWidth(f){return f>>1&3}static extractCharKind(f){return f>>3}static createPropertyValue(f,v,d=!1){return(16777215&f)<<3|(3&v)<<1|(d?1:0)}constructor(){this._providers=Object.create(null),this._active="",this._onChange=new a.EventEmitter,this.onChange=this._onChange.event;const f=new l.UnicodeV6;this.register(f),this._active=f.version,this._activeProvider=f}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(f){if(!this._providers[f])throw new Error(`unknown Unicode version "${f}"`);this._active=f,this._activeProvider=this._providers[f],this._onChange.fire(f)}register(f){this._providers[f.version]=f}wcwidth(f){return this._activeProvider.wcwidth(f)}getStringCellWidth(f){let v=0,d=0;const t=f.length;for(let s=0;s<t;++s){let e=f.charCodeAt(s);if(55296<=e&&e<=56319){if(++s>=t)return v+this.wcwidth(e);const _=f.charCodeAt(s);56320<=_&&_<=57343?e=1024*(e-55296)+_-56320+65536:v+=this.wcwidth(_)}const r=this.charProperties(e,d);let h=o.extractWidth(r);o.extractShouldJoin(r)&&(h-=o.extractWidth(d)),v+=h,d=r}return v}charProperties(f,v){return this._activeProvider.charProperties(f,v)}}i.UnicodeService=o}},y={};function E(b){var i=y[b];if(i!==void 0)return i.exports;var n=y[b]={exports:{}};return C[b].call(n.exports,n,n.exports,E),n.exports}var D={};return(()=>{var b=D;Object.defineProperty(b,"__esModule",{value:!0}),b.Terminal=void 0;const i=E(9042),n=E(3236),a=E(844),l=E(5741),o=E(8285),c=E(7975),f=E(7090),v=["cols","rows"];class d extends a.Disposable{constructor(s){super(),this._core=this.register(new n.Terminal(s)),this._addonManager=this.register(new l.AddonManager),this._publicOptions={...this._core.options};const e=h=>this._core.options[h],r=(h,_)=>{this._checkReadonlyOptions(h),this._core.options[h]=_};for(const h in this._core.options){const _={get:e.bind(this,h),set:r.bind(this,h)};Object.defineProperty(this._publicOptions,h,_)}}_checkReadonlyOptions(s){if(v.includes(s))throw new Error(`Option "${s}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw new Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onKey(){return this._core.onKey}get onLineFeed(){return this._core.onLineFeed}get onRender(){return this._core.onRender}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onSelectionChange(){return this._core.onSelectionChange}get onTitleChange(){return this._core.onTitleChange}get onWriteParsed(){return this._core.onWriteParsed}get element(){return this._core.element}get parser(){return this._parser||(this._parser=new c.ParserApi(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new f.UnicodeApi(this._core)}get textarea(){return this._core.textarea}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._buffer||(this._buffer=this.register(new o.BufferNamespaceApi(this._core))),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){const s=this._core.coreService.decPrivateModes;let e="none";switch(this._core.coreMouseService.activeProtocol){case"X10":e="x10";break;case"VT200":e="vt200";break;case"DRAG":e="drag";break;case"ANY":e="any"}return{applicationCursorKeysMode:s.applicationCursorKeys,applicationKeypadMode:s.applicationKeypad,bracketedPasteMode:s.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:e,originMode:s.origin,reverseWraparoundMode:s.reverseWraparound,sendFocusMode:s.sendFocus,wraparoundMode:s.wraparound}}get options(){return this._publicOptions}set options(s){for(const e in s)this._publicOptions[e]=s[e]}blur(){this._core.blur()}focus(){this._core.focus()}input(s,e=!0){this._core.input(s,e)}resize(s,e){this._verifyIntegers(s,e),this._core.resize(s,e)}open(s){this._core.open(s)}attachCustomKeyEventHandler(s){this._core.attachCustomKeyEventHandler(s)}attachCustomWheelEventHandler(s){this._core.attachCustomWheelEventHandler(s)}registerLinkProvider(s){return this._core.registerLinkProvider(s)}registerCharacterJoiner(s){return this._checkProposedApi(),this._core.registerCharacterJoiner(s)}deregisterCharacterJoiner(s){this._checkProposedApi(),this._core.deregisterCharacterJoiner(s)}registerMarker(s=0){return this._verifyIntegers(s),this._core.registerMarker(s)}registerDecoration(s){return this._checkProposedApi(),this._verifyPositiveIntegers(s.x??0,s.width??0,s.height??0),this._core.registerDecoration(s)}hasSelection(){return this._core.hasSelection()}select(s,e,r){this._verifyIntegers(s,e,r),this._core.select(s,e,r)}getSelection(){return this._core.getSelection()}getSelectionPosition(){return this._core.getSelectionPosition()}clearSelection(){this._core.clearSelection()}selectAll(){this._core.selectAll()}selectLines(s,e){this._verifyIntegers(s,e),this._core.selectLines(s,e)}dispose(){super.dispose()}scrollLines(s){this._verifyIntegers(s),this._core.scrollLines(s)}scrollPages(s){this._verifyIntegers(s),this._core.scrollPages(s)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine(s){this._verifyIntegers(s),this._core.scrollToLine(s)}clear(){this._core.clear()}write(s,e){this._core.write(s,e)}writeln(s,e){this._core.write(s),this._core.write(`\r
`,e)}paste(s){this._core.paste(s)}refresh(s,e){this._verifyIntegers(s,e),this._core.refresh(s,e)}reset(){this._core.reset()}clearTextureAtlas(){this._core.clearTextureAtlas()}loadAddon(s){this._addonManager.loadAddon(this,s)}static get strings(){return i}_verifyIntegers(...s){for(const e of s)if(e===1/0||isNaN(e)||e%1!=0)throw new Error("This API only accepts integers")}_verifyPositiveIntegers(...s){for(const e of s)if(e&&(e===1/0||isNaN(e)||e%1!=0||e<0))throw new Error("This API only accepts positive integers")}}b.Terminal=d})(),D})()))})(rt)),rt.exports}var Pi=Ii(),st={exports:{}},wt;function Hi(){return wt||(wt=1,(function(k,S){(function(C,y){k.exports=y()})(self,(()=>(()=>{var C={};return(()=>{var y=C;Object.defineProperty(y,"__esModule",{value:!0}),y.FitAddon=void 0,y.FitAddon=class{activate(E){this._terminal=E}dispose(){}fit(){const E=this.proposeDimensions();if(!E||!this._terminal||isNaN(E.cols)||isNaN(E.rows))return;const D=this._terminal._core;this._terminal.rows===E.rows&&this._terminal.cols===E.cols||(D._renderService.clear(),this._terminal.resize(E.cols,E.rows))}proposeDimensions(){if(!this._terminal||!this._terminal.element||!this._terminal.element.parentElement)return;const E=this._terminal._core,D=E._renderService.dimensions;if(D.css.cell.width===0||D.css.cell.height===0)return;const b=this._terminal.options.scrollback===0?0:E.viewport.scrollBarWidth,i=window.getComputedStyle(this._terminal.element.parentElement),n=parseInt(i.getPropertyValue("height")),a=Math.max(0,parseInt(i.getPropertyValue("width"))),l=window.getComputedStyle(this._terminal.element),o=n-(parseInt(l.getPropertyValue("padding-top"))+parseInt(l.getPropertyValue("padding-bottom"))),c=a-(parseInt(l.getPropertyValue("padding-right"))+parseInt(l.getPropertyValue("padding-left")))-b;return{cols:Math.max(2,Math.floor(c/D.css.cell.width)),rows:Math.max(1,Math.floor(o/D.css.cell.height))}}}})(),C})()))})(st)),st.exports}var Fi=Hi();const ke="/home/guest";function Ni(k){return k==="~"?ke:k.startsWith("~/")?ke+k.slice(1):k}function Wi(k){return k===ke?"~":k.startsWith(ke+"/")?"~"+k.slice(ke.length):k}function ae(k,S){if(!S)return k;const C=Ni(S);return C.startsWith("/")?Ct(C):Ct(`${k}/${C}`)}function Ct(k){const S=k.split("/").filter(Boolean),C=[];for(const y of S)y!=="."&&(y===".."?C.pop():C.push(y));return"/"+C.join("/")}const Ht=Symbol("TERMINAL");class $i{#e=se();get instance(){return F(this.#e)}set instance(S){Z(this.#e,S,!0)}fitAddon=new Fi.FitAddon;#t=se(Le(ke));get cwd(){return F(this.#t)}set cwd(S){Z(this.#t,S,!0)}#i=se(Le(new Map([["HOME",ke],["PATH","/usr/bin:/bin"]])));get env(){return F(this.#i)}set env(S){Z(this.#i,S,!0)}onLinkClick;init(S,C,y){this.onLinkClick=y,this.instance=new Pi.Terminal({cursorBlink:!0,fontSize:16,fontFamily:'Menlo, Monaco, "Courier New", monospace',theme:C,allowProposedApi:!0}),this.instance.options.linkHandler={activate:(E,D,b)=>{this.onLinkClick&&this.onLinkClick(D)},hover:()=>{}},this.instance.loadAddon(this.fitAddon),this.instance.open(S),this.fitAddon.fit()}dispose(){this.instance?.dispose(),this.instance=void 0}}function Ui(){const k=new $i;return Me(Ht,k),k}function Ft(){return We(Ht)}class Nt{#e=se();key;constructor(S,C){this.key=S,Z(this.#e,C,!0);{const y=localStorage.getItem(S);if(y)try{Z(this.#e,JSON.parse(y),!0)}catch{}}}get value(){return F(this.#e)}set value(S){Z(this.#e,S,!0),localStorage.setItem(this.key,JSON.stringify(S))}}const Wt=Symbol("FileSystem"),bt={type:"directory",name:"root",meta:{created:Date.now(),modified:Date.now()},children:{bin:{type:"directory",name:"bin",meta:{created:Date.now(),modified:Date.now()},children:{}},dev:{type:"directory",name:"dev",meta:{created:Date.now(),modified:Date.now()},children:{null:{type:"file",name:"null",meta:{created:Date.now(),modified:Date.now()},content:""},tty:{type:"file",name:"tty",meta:{created:Date.now(),modified:Date.now()},content:""}}},etc:{type:"directory",name:"etc",meta:{created:Date.now(),modified:Date.now()},children:{}},home:{type:"directory",name:"home",meta:{created:Date.now(),modified:Date.now()},children:{guest:{type:"directory",name:"guest",meta:{created:Date.now(),modified:Date.now()},children:{}}}},tmp:{type:"directory",name:"tmp",meta:{created:Date.now(),modified:Date.now()},children:{}},usr:{type:"directory",name:"usr",meta:{created:Date.now(),modified:Date.now()},children:{bin:{type:"directory",name:"bin",meta:{created:Date.now(),modified:Date.now()},children:{}},lib:{type:"directory",name:"lib",meta:{created:Date.now(),modified:Date.now()},children:{}}}},var:{type:"directory",name:"var",meta:{created:Date.now(),modified:Date.now()},children:{log:{type:"directory",name:"log",meta:{created:Date.now(),modified:Date.now()},children:{}}}}}};class zi{#e=new Nt("gastonos-fs",bt);constructor(){localStorage.removeItem("gemini-fs"),(!this.#e.value||this.#e.value.type!=="directory")&&(this.#e.value=bt)}get root(){return this.#e.value}getNode(S){if(S==="/")return this.root;const C=S.split("/").filter(Boolean);let y=this.root;for(let E=0;E<C.length;E++){const D=C[E];if(y.type!=="directory")return null;const b=y.children[D];if(!b)return null;if(E===C.length-1)return b;if(b.type==="directory")y=b;else return null}return y}readFile(S){const C=this.getNode(S);if(C&&C.type==="file")try{return atob(C.content)}catch(y){return console.error("Failed to decode file content",y),null}return null}writeFile(S,C){const y=S.split("/").filter(Boolean),E=y.pop();if(!E)return!1;const D="/"+y.join("/"),b=this.getNode(D);if(b&&b.type==="directory"){const i=btoa(C);return b.children[E]={type:"file",name:E,meta:{created:Date.now(),modified:Date.now()},content:i},this.save(),!0}return!1}appendFile(S,C){const y=this.getNode(S);if(y&&y.type==="file"){const D=(this.readFile(S)||"")+C;return y.content=btoa(D),y.meta.modified=Date.now(),this.save(),!0}else if(!y)return this.writeFile(S,C);return!1}mkdir(S,C=!1){const y=S.split("/").filter(Boolean);if(y.length===0)return!1;let E=this.root,D=!1;for(let b=0;b<y.length;b++){const i=y[b];let n=E.children[i];if(n){if(n.type==="file")return!1}else if(b===y.length-1||C)E.children[i]={type:"directory",name:i,meta:{created:Date.now(),modified:Date.now()},children:{}},n=E.children[i],D=!0;else return!1;if(n.type==="directory")E=n;else return!1}return D&&this.save(),!0}readdir(S){const C=this.getNode(S);return C&&C.type==="directory"?Object.keys(C.children):null}delete(S){const C=S.split("/").filter(Boolean),y=C.pop();if(!y)return!1;const E="/"+C.join("/"),D=this.getNode(E);return D&&D.type==="directory"&&D.children[y]?(delete D.children[y],this.save(),!0):!1}move(S,C){const y=this.getNode(S);if(!y)return!1;const E=o=>{const c=o.split("/").filter(Boolean),f=c.pop();return{parentPath:"/"+c.join("/"),name:f}},{parentPath:D,name:b}=E(S),i=this.getNode(D);if(!i||i.type!=="directory"||!b)return!1;let n=this.getNode(C),a=null,l;if(n&&n.type==="directory")a=n,l=b;else{const{parentPath:o,name:c}=E(C),f=this.getNode(o);f&&f.type==="directory"&&(a=f,l=c)}return a&&l?(a.children[l]=y,delete i.children[b],this.save(),!0):!1}copy(S,C){const y=this.getNode(S);if(!y)return!1;const D=(l=>{const o=JSON.parse(JSON.stringify(l));return o.meta={created:Date.now(),modified:Date.now()},o})(y),b=l=>{const o=l.split("/").filter(Boolean),c=o.pop();return{parentPath:"/"+o.join("/"),name:c}};let i=this.getNode(C),n=null,a;if(i&&i.type==="directory")n=i,a=S.split("/").filter(Boolean).pop();else{const{parentPath:l,name:o}=b(C),c=this.getNode(l);c&&c.type==="directory"&&(n=c,a=o)}return n&&a?(n.children[a]=D,this.save(),!0):!1}save(){this.#e.value=this.#e.value}}function ji(){const k=new zi;return Me(Wt,k),k}function $t(){return We(Wt)}const Ut=Symbol("THEME"),Ki={background:"#000000",foreground:"#ffffff",cursor:"#ffffff",cursorAccent:"#000000",black:"#000000",red:"#e06c75",green:"#98c379",yellow:"#d19a66",blue:"#61afef",magenta:"#c678dd",cyan:"#56b6c2",white:"#abb2bf",brightBlack:"#5c6370",brightRed:"#e06c75",brightGreen:"#98c379",brightYellow:"#d19a66",brightBlue:"#61afef",brightMagenta:"#c678dd",brightCyan:"#56b6c2",brightWhite:"#ffffff",highlight:"#3e4451",secondary:"#56b6c2",accent:"#c678dd",muted:"#7f848e",success:"#98c379",warning:"#d19a66",error:"#e06c75",info:"#56b6c2"};class qi{#e=new Nt("terminal-theme",Ki);get current(){return this.#e.value}set current(S){this.#e.value=S}}function Vi(){const k=new qi;return Me(Ut,k),k}function zt(){return We(Ut)}const Gi=Symbol("HISTORY"),qe=`${ke}/.history`;class Xi{#e;#t=se(Le([]));#i=se("");#r=se(0);constructor(S){this.#e=S,this.#s()}#s(){const S=this.#e.readFile(qe);S!==null?Z(this.#t,S.split(`
`).filter(Boolean),!0):(this.#e.writeFile(qe,""),Z(this.#t,[],!0)),Z(this.#r,F(this.#t).length,!0)}get entries(){return F(this.#t)}get current(){return F(this.#r)===F(this.#t).length?F(this.#i):F(this.#t)[F(this.#r)]}set current(S){Z(this.#i,S,!0),Z(this.#r,F(this.#t).length,!0)}add(S){const C=S.trim();C&&((F(this.#t).length===0||F(this.#t)[F(this.#t).length-1]!==C)&&(Z(this.#t,[...F(this.#t),C],!0),this.#e.appendFile(qe,C+`
`)),Z(this.#i,""),Z(this.#r,F(this.#t).length,!0))}navigate(S){if(F(this.#t).length===0)return;const C=S==="up"?-1:1,y=F(this.#r)+C;Z(this.#r,Math.max(0,Math.min(y,F(this.#t).length)),!0)}reset(){Z(this.#r,F(this.#t).length,!0)}clear(){Z(this.#t,[],!0),Z(this.#i,""),Z(this.#r,0),this.#e.writeFile(qe,"")}}function Yi(k){const S=new Xi(k);return Me(Gi,S),S}class Pe{#e=[];#t=[];#i=[];#r=!1;#s=null;write(S){this.#r||(this.#e.push(S),this.#t.length>0&&this.#t.forEach(C=>C(this.#e.shift())),this.#s&&(this.#s(),this.#s=null))}end(){this.#r=!0,this.#i.forEach(S=>S()),this.#s&&(this.#s(),this.#s=null)}read(){return this.#e.shift()||null}on(S,C){if(S==="data")for(this.#t.push(C);this.#e.length>0;)C(this.#e.shift());else S==="end"&&(this.#i.push(C),this.#r&&C())}off(S,C){S==="data"?this.#t=this.#t.filter(y=>y!==C):S==="end"&&(this.#i=this.#i.filter(y=>y!==C))}async*[Symbol.asyncIterator](){for(;!this.#r||this.#e.length>0;)this.#e.length>0?yield this.read():this.#r||await new Promise(S=>{this.#s=S})}}class Ae{constructor(S){this.output=S}write(S){this.output.write(S)}end(){}}class jt{#e=[];#t=[];#i=null;#r=!1;push(S){this.#t.push(S),this.#e.forEach(C=>C(S)),this.#i&&(this.#i(),this.#i=null)}read(){return this.#t.shift()||null}on(S,C){S==="data"&&this.#e.push(C),S==="end"&&this.#r&&C()}off(S,C){S==="data"&&(this.#e=this.#e.filter(y=>y!==C))}async*[Symbol.asyncIterator](){for(;!this.#r;)this.#t.length>0?yield this.read():await new Promise(S=>{this.#i=S})}}class Kt{#e;#t=0;#i=!1;constructor(S){this.#e=S.split(`
`)}read(){return this.#t>=this.#e.length?(this.#i=!0,null):this.#e[this.#t++]}on(S,C){if(S==="data"){let y;for(;(y=this.read())!==null;)C(y+`
`)}S==="end"&&this.#i&&C()}off(){}async*[Symbol.asyncIterator](){for(;this.#t<this.#e.length;)yield this.#e[this.#t++]+`
`;this.#i=!0}}const Ji=Object.freeze(Object.defineProperty({__proto__:null,InputInputStream:jt,Pipe:Pe,StringStream:Kt,TerminalOutputStream:Ae},Symbol.toStringTag,{value:"Module"}));function pe(k){const S={_:[]};for(let C=0;C<k.length;C++){const y=k[C];if(y.startsWith("--")){const E=y.slice(2);C+1<k.length&&!k[C+1].startsWith("-")?(S[E]=k[C+1],C++):S[E]=!0}else if(y.startsWith("-")){const E=y.slice(1);if(E.length===1)C+1<k.length&&!k[C+1].startsWith("-")?(S[E]=k[C+1],C++):S[E]=!0;else for(const D of E)S[D]=!0}else S._.push(y)}return S}const ve={bold:1,dim:2,underline:4,strikethrough:9,reset:0,fg:[38,2]},nt=k=>`\x1B[${Array.isArray(k)?k.join(";"):k}m`;function Zi(k){const S=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(k);return S?[parseInt(S[1],16),parseInt(S[2],16),parseInt(S[3],16)]:[255,255,255]}const Qi={highlight:{format:ve.bold,color:"foreground"},emphasize:{color:"secondary"},subtle:{format:ve.dim,color:"muted"},keyword:{format:ve.underline,color:"accent"},deprecated:{format:ve.strikethrough,color:"muted"},success:{format:ve.bold,color:"success"},warning:{format:ve.bold,color:"warning"},error:{format:ve.bold,color:"error"},info:{color:"info"},prompt:{format:ve.bold,color:"success"},directory:{format:ve.bold,color:"info"}};function qt(k,S){function C(o,{format:c,color:f}){return v=>{const d=S.current[f]??S.current.foreground,t=Zi(d),s=nt([...ve.fg,...t]);return`${c?nt(c):""}${s}${v}${nt(ve.reset)}`}}function y(o){let c=`${o}`;Object.entries(Qi).forEach(([v,d])=>{const t=C(v,d),s=new RegExp(`\\{${v}\\}(.*?)\\{\\/${v}\\}`,"g");c=c.replace(s,(e,r)=>t(r))});const f=/\{link:(.*?)\}(.*?)\{\/link\}/g;return c=c.replace(f,(v,d,t)=>`\x1B]8;;${d}\x1B\\${t}\x1B]8;;\x1B\\`),c=c.replace(/\n/g,`\r
`),c}function E(o){k(o)}function D(o){k(o+`\r
`)}function b(o){E(y(o))}function i(o){D(y(o))}function n(){k("\x1B[2J\x1B[H")}function a(o,c){const f=y(o);E(`\r${f}\x1B[K${c}`)}function l(){E("\b \b")}return{write:E,writeln:D,print:b,println:i,clear:n,replaceInputLine:a,removeLastChar:l}}class er{#e=new Map;#t;#i;activeStdin=null;constructor(S,C){this.#t=S,this.#i=C}register(S){const C=S(this.#t,this.#i);this.#e.set(C.name,S)}get(S){const C=this.#e.get(S);if(C)return C(this.#t,this.#i)}getAll(){return Array.from(this.#e.values()).map(S=>S(this.#t,this.#i))}async execute(S,C,y){const E=S.trim();if(!E)return;const D=E.split("|"),b=new jt;this.activeStdin=b;let i=b,n=[];for(let a=0;a<D.length;a++){const o=D[a].trim().split(/\s+/),c=o[0],f=o.slice(1);let v;if(c.startsWith("/")||c.startsWith("./")||c.startsWith("../")){const r=ae(this.#i.cwd,c),h=this.#t.getNode(r);h&&h.type==="file"&&(v=this.get(h.name))}else{const h=(this.#i.env.get("PATH")||"").split(":").filter(Boolean);for(const _ of h){const p=ae("/",_+"/"+c),g=this.#t.getNode(p);if(g&&g.type==="file"&&(v=this.get(g.name),v))break}}if(!v){C.println(`Command not found: {error}${c}{/error}`),this.activeStdin=null;return}let d,t;if(a===D.length-1)d=new Ae(C),t=C;else{const r=new Pe;d=r,t=qt(h=>r.write(h),y)}const s={args:f,stdin:i,stdout:d,stderr:new Ae(C),tty:b,output:t,terminal:this.#i},e=(async()=>{try{const r=await v.execute(s);typeof r=="string"&&t.println(r),d instanceof Pe&&d.end()}catch(r){C.println(`{error}Error executing ${c}:{/error} ${r instanceof Error?r.message:String(r)}`),d instanceof Pe&&d.end()}})();n.push(e),d instanceof Pe&&(i=d)}await Promise.all(n),this.activeStdin=null}}const tr={name:"clear",description:"Clear the terminal screen",help:`{keyword}clear{/keyword}
Clear the terminal screen and move cursor to top.

Usage:
  {keyword}clear{/keyword}

No arguments required.`,execute:({output:k})=>{k.clear()}},ir=k=>({name:"help",description:"Display available commands",help:`{keyword}help{/keyword} [COMMAND]
Display available commands or show help for a specific command.

Usage:
  {keyword}help{/keyword}          List all available commands
  {keyword}help{/keyword} COMMAND  Show detailed help for COMMAND

For more detailed documentation, use: {keyword}man{/keyword} COMMAND`,execute:async({args:S,output:C})=>{if(S.length>0){const i=S[0],n=k.get(i);if(n){if(typeof n.help=="string")return n.help;{const a=await n.help(C);return typeof a=="string"?a:""}}else return`Command not found: {error}${i}{/error}`}const y=k.getAll(),E=Math.max(...y.map(i=>i.name.length));return`{highlight}Available commands:{/highlight}

Type a command and press {keyword}Enter{/keyword} to execute it.

${y.map(i=>{const n=" ".repeat(E-i.name.length+2);return`  {keyword}${i.name}{/keyword}${n}${i.description}`}).join(`
`)}
`}}),rr=k=>({name:"history",description:"Display or manipulate the history list",help:`{keyword}history{/keyword} [-c|--clear]
Display the command history list with line numbers.

Usage:
  {keyword}history{/keyword}         Display all commands in history
  {keyword}history{/keyword} -c      Clear the history list

Options:
  -c, --clear    Clear the command history`,execute:({args:S,output:C})=>{const y=pe(S);if(y.clear||y.c){k.clear();return}const E=k.entries,D=E.length.toString().length,b=E.map((i,n)=>`  ${(n+1).toString().padStart(D," ")}  ${i}`);C.println(b.join(`
`))}});function yt(k){const S=k.type==="directory"?"d":"-",C="rwx------",y=1,E="guest",D="guest",b=k.type==="file"?new TextEncoder().encode(atob(k.content||"")).length:0,i=new Date(k.meta.modified).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"numeric",hour12:!1}),n=k.type==="directory"?`{info}${k.name}/{/info}`:k.name;return`${S}${C} ${y} ${E} ${D} ${b.toString().padStart(6)} ${i} ${n}`}const sr=(k,S)=>({name:"ls",description:"List directory contents",execute:({args:C,output:y,terminal:E})=>{const D=pe(C),b=D.a||D.all,i=D.l,n=D.d,a=D._&&D._[0]?D._[0]:null,l=a?ae(E.cwd,a):E.cwd,o=k.getNode(l);if(!o){y.println(`ls: cannot access '{warning}${l}{/warning}': No such file or directory`);return}if(o.type==="file"||n){i?y.println(yt(o)):y.println(o.name);return}if(o.type==="directory"){let c=Object.values(o.children);if(b||(c=c.filter(f=>!f.name.startsWith("."))),c.sort((f,v)=>f.type===v.type?f.name.localeCompare(v.name):f.type==="directory"?-1:1),i)c.forEach(f=>{y.println(yt(f))});else{const f=c.map(v=>v.type==="directory"?`{info}${v.name}/{/info}`:v.name);y.println(f.join("  "))}}},help:`{keyword}ls{/keyword} [-a|-d|-l] [PATH]...
List information about the FILEs (the current directory by default).

Options:
  -a, --all      do not ignore entries starting with .
  -d             list directory entries instead of contents, and do not dereference symbolic links
  -l             use a long listing format`}),nr=(k,S)=>({name:"cd",description:"Change the shell working directory",execute:({args:C,output:y,terminal:E})=>{const D=C[0]||E.env.get("HOME")||"/",b=ae(E.cwd,D),i=k.getNode(b);if(!i){y.println(`cd: {warning}${D}{/warning}: No such file or directory`);return}if(i.type!=="directory"){y.println(`cd: {warning}${D}{/warning}: Not a directory`);return}E.cwd=b},help:`{keyword}cd{/keyword} [DIRECTORY]
Change the current working directory to DIRECTORY. If DIRECTORY is not specified, change to the home directory.`}),or=k=>({name:"pwd",description:"Print name of current/working directory",execute:({output:S})=>{S.println(k.cwd)},help:`{keyword}pwd{/keyword}
Write the absolute pathname of the current working directory to the standard output.`}),ar=(k,S)=>({name:"cat",description:"Concatenate files and print on the standard output",execute:async({args:C,output:y,stdin:E})=>{if(C.length===0){for await(const D of E)y.println(D);return}for(const D of C){const b=ae(S.cwd,D),i=k.getNode(b);if(!i){y.println(`cat: {warning}${D}{/warning}: No such file or directory`);continue}if(i.type==="directory"){y.println(`cat: {warning}${D}{/warning}: Is a directory`);continue}const n=k.readFile(b);n!==null&&y.println(n)}},help:`{keyword}cat{/keyword} [FILE...]
Concatenate files and print on the standard output. If no FILE is specified, or when FILE is -, read from standard input.`}),ft=async(k,S)=>{const{stdin:C,stdout:y,tty:E,args:D,output:b,terminal:i}=k;if(!(y instanceof Ae)){await new Promise(L=>{C.on("data",H=>y.write(H)),C.on("end",()=>L());const T=C.read();T&&y.write(T)});return}let n="";if(D.length>0){const O=ae(i.cwd,D[0]),L=S.readFile(O);if(L===null){b.println(`less: {warning}${D[0]}{/warning}: No such file or directory`);return}n=L}else await new Promise(L=>{C.on("data",H=>{n+=H}),C.on("end",()=>{L()});const T=C.read();T&&(n+=T)});const a=n.split(`
`);let l=0;const c=(i.instance?.rows||20)-1,f=Math.floor(c),v=Math.floor(c/2);let d="",t=!1,s=[],e=-1;const r=[];let h=-1;function _(){a.forEach((O,L)=>{const T=/\{link:([^}]+)\}([^{]+)\{\/link\}/g;let H;for(;(H=T.exec(O))!==null;){const $=H[1].split(":"),j=$.length>1?$[0]:"unknown",U=$.length>1?$[1]:$[0],w=H[2];r.push({lineNumber:L,type:j,target:U,text:w})}})}_(),b.write("\x1B[?1049h"),b.write("\x1B[H");function p(){if(s=[],!d)return;const O=new RegExp(d,"i");a.forEach((L,T)=>{O.test(L)&&s.push(T)})}function g(){if(s.length===0)return;const O=s.findIndex(L=>L>l);O!==-1?(e=O,l=s[O]):s.length>0&&(e=0,l=s[0])}function u(){if(s.length===0)return;const O=s.slice().reverse().findIndex(L=>L<l);O!==-1?(e=s.length-1-O,l=s[e]):s.length>0&&(e=s.length-1,l=s[e])}function m(){const O=l+c;return r.filter(L=>L.lineNumber>=l&&L.lineNumber<O)}function B(){const O=a.length,L=l+1,T=Math.min(l+c,O),H=O>0?Math.round(T/O*100):100;if(t)return`Pattern: ${d}_`;const $=m();let j="";if(T>=O?j="(END)":j=`:  ${H}%  (lines ${L}-${T} of ${O})`,$.length>0)if(h>=0&&h<$.length){const U=$[h];j+=`  [Link ${h+1}/${$.length}: ${U.text}]`}else j+=`  (${$.length} links - Tab to navigate)`;return j}function A(){b.write("\x1B[2J\x1B[H"),a.slice(l,l+c).forEach(T=>b.println(T)),b.write("\x1B[7m");const L=B();b.write(L),b.write("\x1B[0m")}return A(),new Promise(O=>{const L=T=>{if(t){if(T==="\r"||T===`
`){t=!1,p(),s.length>0&&g(),A();return}else if(T==="\x1B"){t=!1,d="",A();return}else if(T===""||T==="\b"){d=d.slice(0,-1),A();return}else if(T.length===1&&T>=" "&&T<="~"){d+=T,A();return}return}if(T==="q"||T==="Q"){b.write("\x1B[?1049l"),E.off("data",L),O();return}if(T==="j"||T==="\x1B[B"||T==="")l<a.length-c&&l++,A();else if(T==="k"||T==="\x1B[A"||T==="")l>0&&l--,A();else if(T===" "||T==="f"||T===""||T==="\x1B[6~")l=Math.min(l+f,Math.max(0,a.length-c)),A();else if(T==="b"||T===""||T==="\x1B[5~")l=Math.max(0,l-f),A();else if(T==="d"||T==="")l=Math.min(l+v,Math.max(0,a.length-c)),A();else if(T==="u"||T==="")l=Math.max(0,l-v),A();else if(T==="g"||T==="<"||T==="\x1B[H")l=0,A();else if(T==="G"||T===">"||T==="\x1B[F")l=Math.max(0,a.length-c),A();else if(T==="/")t=!0,d="",A();else if(T==="n")g(),A();else if(T==="N")u(),A();else if(T==="	"){const H=m();H.length>0&&(h=(h+1)%H.length,A())}else if(T==="\x1B[Z"){const H=m();H.length>0&&(h=h<=0?H.length-1:h-1,A())}else if(T==="\r"||T===`
`){const H=m();if(h>=0&&h<H.length){const $=H[h];b.write("\x1B[?1049l"),E.off("data",L),$.type==="man"&&(b.println(`Opening man page for: {keyword}${$.target}{/keyword}`),setTimeout(async()=>{try{const j=`${Mt}/man/${$.target}.txt`,U=await fetch(j);if(U.ok){const w=await U.text(),{StringStream:M}=await bi(async()=>{const{StringStream:R}=await Promise.resolve().then(()=>Ji);return{StringStream:R}},void 0,import.meta.url);await ft({...k,stdin:new M(w),args:[]},S)}else b.println(`No manual entry for {error}${$.target}{/error}`)}catch{b.println("{error}Error loading manual page.{/error}")}},0)),O();return}}else(T==="h"||T==="H"||T==="?")&&A();(T==="j"||T==="k"||T===" "||T==="b"||T==="d"||T==="u"||T==="g"||T==="G"||T==="\x1B[A"||T==="\x1B[B")&&(h=-1)};E.on("data",L)})},hr=k=>({name:"less",description:"Opposite of more",help:`{keyword}less{/keyword} [FILE]...
View file contents or standard input in an interactive pager.

Navigation:
  {keyword}SPACE, f, PgDn{/keyword}   Scroll forward one page
  {keyword}b, PgUp{/keyword}          Scroll backward one page
  {keyword}d{/keyword}                Scroll forward half page
  {keyword}u{/keyword}                Scroll backward half page
  {keyword}j, ↓{/keyword}             Scroll down one line
  {keyword}k, ↑{/keyword}             Scroll up one line
  {keyword}g, Home{/keyword}          Jump to beginning
  {keyword}G, End{/keyword}           Jump to end

Search:
  {keyword}/{/keyword}pattern         Search forward for pattern
  {keyword}n{/keyword}                Jump to next search result
  {keyword}N{/keyword}                Jump to previous search result

Links:
  {keyword}Tab{/keyword}              Navigate to next link
  {keyword}Shift+Tab{/keyword}        Navigate to previous link
  {keyword}Enter{/keyword}            Activate selected link

Other:
  {keyword}q{/keyword}                Quit
  {keyword}h, ?{/keyword}             Help (not yet implemented)`,execute:S=>ft(S,k)}),lr=k=>({name:"man",description:"An interface to the system reference manuals",execute:async S=>{const{args:C,output:y,stdout:E,tty:D}=S;if(C.length===0){y.println("What manual page do you want?");return}const b=C[0];E instanceof Ae&&y.println(`Fetching manual for {keyword}${b}{/keyword}...`);try{const i=`${Mt}/man/${b}.txt`,n=await fetch(i);if(!n.ok){n.status===404?y.println(`No manual entry for {error}${b}{/error}`):y.println(`{error}Error loading manual page: ${n.statusText}{/error}`);return}const a=await n.text();E instanceof Ae?await ft({...S,stdin:new Kt(a),args:[]},k):E.write(a)}catch{y.println("{error}Network error loading manual page.{/error}")}},help:`{keyword}man{/keyword} [COMMAND]
Display the manual page for a command.

The manual pages are pre-formatted text files. When viewing a manual page, an internal pager (similar to 'less') will be used.
Press 'q' to quit the pager.`}),cr=(k,S)=>({name:"mkdir",description:"Create the DIRECTORY(ies), if they do not already exist.",execute:({args:C,output:y,terminal:E})=>{const D=pe(C),b=D.p||D.parents,i=D._;if(i.length===0){y.println("mkdir: missing operand"),y.println("Try 'mkdir --help' for more information.");return}for(const n of i){const a=ae(E.cwd,n),l=k.getNode(a);if(l&&l.type==="file"){y.println(`mkdir: cannot create directory '{warning}${n}{/warning}': File exists`);continue}k.mkdir(a,!!b)||y.println(`mkdir: cannot create directory '{warning}${n}{/warning}': No such file or directory`)}},help:`{keyword}mkdir{/keyword} [-p] DIRECTORY...
Create the DIRECTORY(ies), if they do not already exist.

Options:
  -p, --parents  no error if existing, make parent directories as needed`}),dr=(k,S)=>({name:"rm",description:"Remove (unlink) the FILE(s).",execute:({args:C,output:y})=>{const E=pe(C),D=E.r||E.R||E.recursive,b=E._||[];if(b.length===0){y.println("rm: missing operand");return}for(const i of b){const n=ae(S.cwd,i),a=k.getNode(n);if(!a){y.println(`rm: cannot remove '{warning}${i}{/warning}': No such file or directory`);continue}if(a.type==="directory"&&!D){const o=k.readdir(n);if(o&&o.length>0){y.println(`rm: cannot remove '{warning}${i}{/warning}': Directory not empty`);continue}}k.delete(n)||y.println(`rm: failed to remove '{warning}${i}{/warning}'`)}},help:`{keyword}rm{/keyword} [-r|-R|--recursive] FILE...
Remove (unlink) the FILE(s).

Options:
  -r, -R, --recursive  remove directories and their contents recursively.
                       Without this option, non-empty directories cannot be removed.`}),ur=(k,S)=>({name:"cp",description:"Copy SOURCE to DEST",execute:({args:C,output:y,terminal:E})=>{let D=!1;const b=[];let i;for(const l of C)l==="-r"||l==="-R"?D=!0:b.push(l);if(b.length===0){y.println("cp: missing file operand"),y.println("Try 'cp --help' for more information.");return}if(i=b.pop(),!i){y.println("cp: missing destination file operand after 'SOURCE'"),y.println("Try 'cp --help' for more information.");return}const n=ae(E.cwd,i),a=k.getNode(n);if(b.length>0&&(!a||a.type!=="directory")){y.println(`cp: target '{warning}${i}{/warning}' is not a directory`);return}for(const l of b){const o=ae(E.cwd,l),c=k.getNode(o);if(!c){y.println(`cp: cannot stat '{warning}${l}{/warning}': No such file or directory`);continue}if(c.type==="directory"&&!D){y.println(`cp: -r not specified; omitting directory '{warning}${l}{/warning}'`);continue}let f=n;if(a&&a.type==="directory"){const d=o.split("/").pop();d&&(f=`${n}/${d}`)}k.copy(o,f)||y.println(`cp: failed to copy '{warning}${l}{/warning}' to '{warning}${f}{/warning}'`)}},help:`{keyword}cp{/keyword} [-R] SOURCE... DEST
Copy SOURCE to DEST, or multiple SOURCE(s) to DIRECTORY.`}),fr=(k,S)=>({name:"mv",description:"Rename SOURCE to DEST, or move SOURCE(s) to DIRECTORY.",execute:({args:C,output:y,terminal:E})=>{if(C.length<2){y.println("mv: missing file operand"),y.println("Try 'mv --help' for more information.");return}const D=C.slice(0,C.length-1),b=C[C.length-1],i=ae(E.cwd,b),n=k.getNode(i);if(D.length>1&&(!n||n.type!=="directory")){y.println(`mv: target '{warning}${b}{/warning}' is not a directory`);return}for(const a of D){const l=ae(E.cwd,a);if(!k.getNode(l)){y.println(`mv: cannot stat '{warning}${a}{/warning}': No such file or directory`);continue}let c=i;if(n&&n.type==="directory"){const v=l.split("/").pop();v&&(c=`${i}/${v}`)}k.move(l,c)||y.println(`mv: failed to move '{warning}${a}{/warning}' to '{warning}${c}{/warning}'`)}},help:`{keyword}mv{/keyword} SOURCE... DIRECTORY
Move (rename) SOURCE to DEST, or SOURCE(s) to DIRECTORY.

Arguments:
  SOURCE...      One or more files or directories to move.
  DIRECTORY      The target directory if multiple sources, or the new name/path if a single source.`}),_r=(k,S)=>({name:"touch",description:"Update the access and modification times of each FILE to the current time.",execute:({args:C,output:y})=>{if(C.length===0){y.println("touch: missing file operand");return}for(const E of C){if(E.startsWith("-"))continue;const D=ae(S.cwd,E);k.appendFile(D,"")}},help:`{keyword}touch{/keyword} FILE...
Update the access and modification times of each FILE to the current time. A FILE is created if it does not already exist.`}),pr=()=>({name:"uname",description:"Print system information",execute:({args:k,output:S})=>{const C=pe(k),y="Linux",E="gaston-os",D="1.0.0-generic",b="#1 SMP PREEMPT Thu Nov 27 2025",i="x86_64",n="GNU/Linux";let a=[],l=!1;C.a&&(l=!0),(l||C.s)&&a.push(y),(l||C.n)&&a.push(E),(l||C.r)&&a.push(D),(l||C.v)&&a.push(b),(l||C.m)&&a.push(i),l&&a.push(n),a.length===0&&a.push(y),S.println(a.join(" "))},help:`{keyword}uname{/keyword} [-amnprsv]
Print system information. With no options, same as -s.

Options:
  -a             print all information
  -s             print the kernel name
  -n             print the network node hostname
  -r             print the kernel release
  -v             print the kernel version
  -m             print the machine hardware name`}),vr=k=>({name:"dirname",description:"Output each NAME with its last non-slash component and trailing slashes removed.",execute:({args:S,output:C})=>{if(S.length===0){C.println("dirname: missing operand");return}for(const y of S){let E=y;for(;E.length>1&&E.endsWith("/");)E=E.substring(0,E.length-1);const D=E.lastIndexOf("/");D===-1?C.println("."):D===0?C.println("/"):C.println(E.substring(0,D))}},help:`{keyword}dirname{/keyword} NAME...
Output each NAME with its last non-slash component and trailing slashes removed.

Examples:
  dirname /usr/bin            -> /usr
  dirname dir/subdir/file.txt -> dir/subdir
  dirname /                 -> /
  dirname file.txt          -> .
  dirname //usr             -> //
  dirname /usr/             -> /`}),gr=k=>({name:"basename",description:"Strip directory and suffix from filenames.",execute:({args:S,output:C})=>{if(S.length===0){C.println("basename: missing operand");return}let E=S[0].replace(/\/+$/,"");const D=E.split("/");if(E=D[D.length-1],S.length>1){const b=S[1];E.endsWith(b)&&(E=E.slice(0,-b.length))}C.println(E)},help:"{keyword}basename{/keyword} NAME [SUFFIX]"}),mr=()=>({name:"echo",description:"Write arguments to the standard output.",execute:({args:k,output:S})=>{const C=pe(k),y=C.n;C._.length>0&&S.write(C._.join(" ")),y||S.write(`
`)},help:`{keyword}echo{/keyword} [-n] [STRING...]
Write arguments to the standard output.

Options:
  -n             do not output the trailing newline`}),Sr=k=>({name:"env",description:"Print environment variables.",execute:({output:S,terminal:C})=>{for(const[y,E]of C.env.entries())S.println(`${y}=${E}`)},help:`{keyword}env{/keyword}
Print environment variables. Note: This implementation only prints, and does not set, environment variables for commands.`}),wr=k=>({name:"printenv",description:"Print environment variables.",execute:({args:S,output:C,terminal:y})=>{if(S.length===0)for(const[E,D]of y.env.entries())C.println(`${E}=${D}`);else for(const E of S){const D=y.env.get(E);D!==void 0&&C.println(D)}},help:`{keyword}printenv{/keyword} [VARIABLE...]
Print the values of the specified environment VARIABLE(s), or all environment variables if none are specified.`}),Cr=()=>({name:"date",description:"Print or set the system date and time.",execute:({args:k,output:S})=>{const C=pe(k),y=C.f||C.format,E=new Date;let D;if(y&&typeof y=="string")try{D=E.toLocaleString(void 0,JSON.parse(y))}catch{D=E.toLocaleString()}else D=E.toString();S.println(D)},help:`{keyword}date{/keyword} [-f FORMAT]
Print the system date and time.

Options:
  -f, --format   Format the date and time using a JSON string for toLocaleString options (e.g., '{"weekday":"short","year":"numeric","month":"short","day":"numeric","hour":"numeric","minute":"numeric","second":"numeric"}')`}),br=(k,S)=>({name:"test",description:"Evaluate conditional expressions.",execute:({args:C,output:y})=>{if(C.length===0)return 1;let E=1;if(C.length===2){const D=C[0],b=C[1],i=ae(S.cwd,b),n=k.getNode(i);switch(D){case"-e":n!==null&&(E=0);break;case"-f":n!==null&&n.type==="file"&&(E=0);break;case"-d":n!==null&&n.type==="directory"&&(E=0);break;default:return 1}}else if(C.length===3){const D=C[0],b=C[1],i=C[2];switch(b){case"=":D===i&&(E=0);break;case"!=":D!==i&&(E=0);break;default:return 1}}else return 1;return E},help:`{keyword}test{/keyword} EXPRESSION
Evaluate conditional EXPRESSION.

Expressions:
  -e FILE        True if FILE exists.
  -f FILE        True if FILE exists and is a regular file.
  -d FILE        True if FILE exists and is a directory.
  STRING1 = STRING2  True if the strings are equal.
  STRING1 != STRING2 True if the strings are not equal.`});async function Vt(k,S,C,y){const E=k.getNode(S);if(E&&(C(E)&&y.println(S),E.type==="directory")){const D=k.readdir(S);if(D)for(const b of D){if(b==="."||b==="..")continue;const i=`${S}/${b}`;await Vt(k,i,C,y)}}}const yr=(k,S)=>({name:"find",description:"Search for files in a directory hierarchy.",execute:async({args:C,output:y})=>{const E=pe(C);let D=E._.length>0?E._[0]:".";D=ae(S.cwd,D);let b;E.name&&(b=E.name),await Vt(k,D,n=>{let a=!0;if(b){const l=new RegExp("^"+b.replace(/\./g,"\\.").replace(/\*/g,".*").replace(/\?/g,".")+"$");a=a&&l.test(n.name)}return a},y)},help:`{keyword}find{/keyword} [PATH] [EXPRESSION]
Search for files in a directory hierarchy.

Options:
  -name PATTERN  Base of file name (shell pattern)

Examples:
  find . -name "*.txt"
  find /home/guest -name "document.pdf"`}),Er=(k,S)=>({name:"grep",description:"Print lines matching a pattern.",execute:async({args:C,output:y,stdin:E})=>{const D=pe(C),b=D.v,i=D._[0],n=D._.slice(1);if(!i)return y.println("grep: missing pattern"),1;let a;try{a=new RegExp(i)}catch(o){return y.println(`grep: invalid regular expression: ${o instanceof Error?o.message:String(o)}`),2}const l=(o,c)=>{const f=o.split(`
`);for(const v of f){const d=a.test(v);(d&&!b||!d&&b)&&y.println(c?`${c}:${v}`:v)}};if(n.length===0){let o="";for await(const c of E)o+=c;l(o)}else for(const o of n){const c=ae(S.cwd,o),f=k.getNode(c);if(!f){y.println(`grep: {warning}${o}{/warning}: No such file or directory`);continue}if(f.type==="directory"){y.println(`grep: {warning}${o}{/warning}: Is a directory`);continue}const v=k.readFile(c);v!==null&&l(v,o)}return 0},help:`{keyword}grep{/keyword} [-v] PATTERN [FILE...]
Search for PATTERN in each FILE or standard input.

Options:
  -v             Invert the sense of matching, to select non-matching lines.`}),xr=(k,S)=>({name:"head",description:"Output the first part of files.",execute:async({args:C,output:y,stdin:E})=>{const D=pe(C),b=D.n?parseInt(D.n):10,i=D._,n=(a,l)=>{const o=a.split(`
`);for(let c=0;c<Math.min(b,o.length);c++)y.println(o[c])};if(i.length===0){let a="";for await(const l of E)a+=l;n(a)}else for(const a of i){const l=ae(S.cwd,a),o=k.getNode(l);if(!o){y.println(`head: {warning}${a}{/warning}: No such file or directory`);continue}if(o.type==="directory"){y.println(`head: {warning}${a}{/warning}: Is a directory`);continue}const c=k.readFile(l);c!==null&&n(c)}},help:`{keyword}head{/keyword} [-n NUM] [FILE...]
Output the first part of files.

Options:
  -n NUM         Output the first NUM lines instead of the default 10.`}),kr=(k,S)=>({name:"tail",description:"Output the last part of files.",execute:async({args:C,output:y,stdin:E})=>{const D=pe(C),b=D.n?parseInt(D.n):10,i=D._,n=(a,l)=>{const o=a.split(`
`),c=Math.max(0,o.length-b);for(let f=c;f<o.length;f++)y.println(o[f])};if(i.length===0){let a="";for await(const l of E)a+=l;n(a)}else for(const a of i){const l=ae(S.cwd,a),o=k.getNode(l);if(!o){y.println(`tail: {warning}${a}{/warning}: No such file or directory`);continue}if(o.type==="directory"){y.println(`tail: {warning}${a}{/warning}: Is a directory`);continue}const c=k.readFile(l);c!==null&&n(c)}},help:`{keyword}tail{/keyword} [-n NUM] [FILE...]
Output the last part of files.

Options:
  -n NUM         Output the last NUM lines instead of the default 10.`}),Lr=(k,S)=>({name:"sort",description:"Sort lines of text files.",execute:async({args:C,output:y,stdin:E})=>{const b=pe(C)._,i=n=>{const a=n.split(`
`).filter(l=>l.length>0);a.sort(),a.forEach(l=>y.println(l))};if(b.length===0){let n="";for await(const a of E)n+=a;i(n)}else for(const n of b){const a=ae(S.cwd,n),l=k.getNode(a);if(!l){y.println(`sort: {warning}${n}{/warning}: No such file or directory`);continue}if(l.type==="directory"){y.println(`sort: {warning}${n}{/warning}: Is a directory`);continue}const o=k.readFile(a);o!==null&&i(o)}},help:`{keyword}sort{/keyword} [FILE...]
Sort lines of text files.

This implementation performs a basic alphabetical sort.
If no FILE is specified, or when FILE is -, read from standard input.`}),Dr=(k,S)=>({name:"uniq",description:"Report or omit repeated lines.",execute:async({args:C,output:y,stdin:E})=>{const D=C,b=i=>{const n=i.split(`
`);let a="";for(const l of n)l!==a&&(y.println(l),a=l)};if(D.length===0){let i="";for await(const n of E)i+=n;b(i)}else if(D.length===1){const i=ae(S.cwd,D[0]),n=k.getNode(i);if(!n){y.println(`uniq: {warning}${D[0]}{/warning}: No such file or directory`);return}if(n.type==="directory"){y.println(`uniq: {warning}${D[0]}{/warning}: Is a directory`);return}const a=k.readFile(i);a!==null&&b(a)}else y.println("uniq: only one input file supported for now")},help:`{keyword}uniq{/keyword} [FILE]
Report or omit repeated lines.

Compares adjacent lines and writes a single copy of each unique line to standard output.
If FILE is not specified, reads from standard input.`}),Rr=(k,S)=>({name:"wc",description:"Print newline, word, and byte counts for files.",execute:async({args:C,output:y,stdin:E})=>{const D=C,b=(i,n)=>{const l=i.split(`
`).length-1,o=i.split(/\s+/).filter(v=>v.length>0).length,c=new TextEncoder().encode(i).length,f=`${l}	${o}	${c}`;y.println(n?`${f}	${n}`:f)};if(D.length===0){let i="";for await(const n of E)i+=n;b(i)}else for(const i of D){const n=ae(S.cwd,i),a=k.getNode(n);if(!a){y.println(`wc: {warning}${i}{/warning}: No such file or directory`);continue}if(a.type==="directory"){y.println(`wc: {warning}${i}{/warning}: Is a directory`);continue}const l=k.readFile(n);l!==null&&b(l,i)}},help:`{keyword}wc{/keyword} [FILE...]
Print newline, word, and byte counts for each FILE, or from standard input if no FILE is specified.

Output format: LINES WORDS BYTES [FILE]`}),Ar=()=>({name:"whoami",description:"Print effective user ID.",execute:({output:k})=>{k.println("guest")},help:`{keyword}whoami{/keyword}
Print the effective user ID.`}),Mr=()=>({name:"id",description:"Print user and group information.",execute:({output:k})=>{k.println("uid=1000(guest) gid=1000(guest) groups=1000(guest)")},help:`{keyword}id{/keyword}
Print user and group information for the current user.

In this simulated environment, the user is 'guest' with uid 1000 and gid 1000.`});function Br(k,S,C,y){const E=(D,b="/usr/bin/")=>{const i=D(C,y);C.writeFile(`${b}${i.name}`,i.name),k.register(D)};E((D,b)=>tr,"/bin/"),E((D,b)=>ir(k)),E((D,b)=>rr(S)),E((D,b)=>or(b)),E((D,b)=>lr(D)),E((D,b)=>pr()),E((D,b)=>mr()),E((D,b)=>Ar()),E((D,b)=>Mr()),E((D,b)=>Cr()),E((D,b)=>sr(D)),E((D,b)=>nr(D)),E((D,b)=>ar(D,b)),E((D,b)=>cr(D)),E((D,b)=>dr(D,b)),E((D,b)=>ur(D)),E((D,b)=>fr(D)),E((D,b)=>_r(D,b)),E((D,b)=>vr()),E((D,b)=>gr()),E((D,b)=>hr(D)),E((D,b)=>Sr()),E((D,b)=>wr()),E((D,b)=>br(D,b)),E((D,b)=>yr(D,b)),E((D,b)=>Er(D,b)),E((D,b)=>xr(D,b)),E((D,b)=>kr(D,b)),E((D,b)=>Lr(D,b)),E((D,b)=>Dr(D,b)),E((D,b)=>Rr(D,b))}function Tr(k,S,C,y,E,D){function b(){return typeof E=="function"?E():E}async function i(n){if(!k.instance)return;if(y.activeStdin){y.activeStdin.push(n);return}const l=n.charCodeAt(0);switch(l){case 13:C.write(`\r
`);const o=S.current;o&&(S.add(o),await y.execute(o,C,D),S.reset()),C.print(b());break;case 127:S.current.length>0&&(S.current=S.current.slice(0,-1),C.removeLastChar());break;case 27:if(n.length>1)switch(n.substring(1)){case"[A":S.navigate("up"),C.replaceInputLine(b(),S.current);break;case"[B":S.navigate("down"),C.replaceInputLine(b(),S.current);break}break;default:l>=32&&l<=126&&(S.current+=n,C.write(n));break}}return{handleData:i}}function Or(k,S){return qt(C=>k.instance?.write(C),S)}var Ir=le('<div class="h-full w-full"></div>');function Pr(k,S){ge(S,!0);const C=Ft(),y=zt();let E;$e(()=>{C&&E&&(C.init(E,y.current,S.onLinkClick),S.onData&&C.instance&&C.instance.onData(S.onData),S.onReady?.())}),xi(()=>{C?.dispose()});var D=Ir();yi(D,b=>E=b,()=>E),ie(k,D),me()}const Hr=`{highlight}Welcome to Gaston Silva's Interactive Terminal{/highlight}

Type {keyword}help{/keyword} to see available commands.`;function Fr(k,S){ge(S,!1);const C=Ui(),y=$t(),E=zt(),D=Yi(y),b=new er(y,C),i=Or(C,E),n=()=>`{prompt}guest@gastonos{/prompt}:{directory}${Wi(C.cwd)}{/directory}$ `,a=Tr(C,D,i,b,n,E);function l(){i.println(Hr),i.print(n())}$e(()=>{Br(b,D,y,C)}),lt(),Pr(k,{onReady:l,get onData(){return a.handleData}}),me()}var Nr=le(`<div class="flex h-full flex-col gap-6 overflow-auto bg-gray-900 p-6 text-gray-200"><div class="flex items-center gap-4 border-b border-gray-700 pb-6"><div class="flex h-16 w-16 items-center justify-center rounded-lg bg-green-600"><svg class="h-10 w-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><rect x="2" y="4" width="20" height="16" rx="2" stroke-width="2"></rect><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l3 3-3 3m5 0h3"></path></svg></div> <div><h1 class="text-2xl font-bold text-green-400"> </h1> <p class="text-sm text-gray-400"> </p></div></div> <div class="space-y-4"><h2 class="text-lg font-semibold text-green-400">System Information</h2> <div class="grid gap-3 font-mono text-sm"><div class="flex justify-between rounded bg-gray-800 px-4 py-2"><span class="text-gray-400">Operating System:</span> <span class="font-semibold"> </span></div> <div class="flex justify-between rounded bg-gray-800 px-4 py-2"><span class="text-gray-400">Kernel:</span> <span class="font-semibold"> </span></div> <div class="flex justify-between rounded bg-gray-800 px-4 py-2"><span class="text-gray-400">Architecture:</span> <span class="font-semibold"> </span></div> <div class="flex justify-between rounded bg-gray-800 px-4 py-2"><span class="text-gray-400">Terminal:</span> <span class="font-semibold"> </span></div> <div class="flex justify-between rounded bg-gray-800 px-4 py-2"><span class="text-gray-400">Shell:</span> <span class="font-semibold"> </span></div> <div class="flex justify-between rounded bg-gray-800 px-4 py-2"><span class="text-gray-400">File System:</span> <span class="font-semibold"> </span></div> <div class="flex justify-between rounded bg-gray-800 px-4 py-2"><span class="text-gray-400">Storage:</span> <span class="font-semibold"> </span></div> <div class="flex justify-between rounded bg-gray-800 px-4 py-2"><span class="text-gray-400">Uptime:</span> <span class="font-semibold"> </span></div></div></div> <div class="space-y-2 border-t border-gray-700 pt-6"><h2 class="text-lg font-semibold text-green-400">About</h2> <p class="text-sm leading-relaxed text-gray-400">GastonOS is an interactive, OS-themed personal website built with SvelteKit. It features a
      fully functional POSIX-like terminal emulator with 30+ commands, a virtual filesystem, and a
      modern desktop environment.</p> <p class="text-sm text-gray-400">Created by <span class="font-semibold text-green-400">Gaston Silva</span></p> <p class="text-xs text-gray-500">Copyright © 2025. All rights reserved.</p></div></div>`);function Wr(k,S){ge(S,!1);const C=$t(),y={osName:"GastonOS",version:"2.0",kernel:"GastonKernel 5.15.0",architecture:"x86_64",terminal:"xterm.js 5.5.0",shell:"POSIX-like Shell",fileSystem:"Virtual FS",totalSpace:"∞ TB",usedSpace:E(),uptime:D()};function E(){let W=0,K=0;function Y(J){J.type==="directory"?(K++,Object.values(J.children).forEach(Y)):J.type==="file"&&W++}return Y(C.root),`${W} files, ${K} dirs`}function D(){const W=Date.now(),K=performance.timeOrigin,Y=W-K,J=Math.floor(Y/1e3),P=Math.floor(J/3600),x=Math.floor(J%3600/60),N=J%60;return`${P}h ${x}m ${N}s`}lt();var b=Nr(),i=X(b),n=ee(X(i),2),a=X(n),l=X(a,!0);G(a);var o=ee(a,2),c=X(o);G(o),G(n),G(i);var f=ee(i,2),v=ee(X(f),2),d=X(v),t=ee(X(d),2),s=X(t,!0);G(t),G(d);var e=ee(d,2),r=ee(X(e),2),h=X(r,!0);G(r),G(e);var _=ee(e,2),p=ee(X(_),2),g=X(p,!0);G(p),G(_);var u=ee(_,2),m=ee(X(u),2),B=X(m,!0);G(m),G(u);var A=ee(u,2),O=ee(X(A),2),L=X(O,!0);G(O),G(A);var T=ee(A,2),H=ee(X(T),2),$=X(H,!0);G(H),G(T);var j=ee(T,2),U=ee(X(j),2),w=X(U);G(U),G(j);var M=ee(j,2),R=ee(X(M),2),I=X(R,!0);G(R),G(M),G(v),G(f),He(2),G(b),_e(()=>{he(l,y.osName),he(c,`Version ${y.version}`),he(s,y.osName),he(h,y.kernel),he(g,y.architecture),he(B,y.terminal),he(L,y.shell),he($,y.fileSystem),he(w,`${y.usedSpace??""} / ${y.totalSpace}`),he(I,y.uptime)}),ie(k,b),me()}const Gt={terminal:{id:"terminal",title:"Terminal",icon:Ot,component:Fr,singleton:!1,defaultWidth:800,defaultHeight:600,resizable:!0},about:{id:"about",title:"About GastonOS",icon:It,component:Wr,singleton:!0,defaultWidth:600,defaultHeight:500,resizable:!0}};function _t(k){return Gt[k]}function $r(k){return Gt[k]?.singleton??!1}const Xt=Symbol("WindowManager");function Ur(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"win-"+Math.random().toString(36).slice(2,11)+Date.now().toString(36)}class zr{#e=se(Le([]));get windows(){return F(this.#e)}set windows(S){Z(this.#e,S,!0)}nextZIndex=10;constructor(){}openWindow(S,C,y){if($r(S)){const b=this.windows.find(i=>i.appId===S);if(b)return console.log(`[WindowManager] Singleton app ${S} already open, focusing existing window`),this.focusWindow(b.id),b.id}const E=Ur(),D={id:E,appId:S,title:C,isMinimized:!1,isMaximized:y?.initialState?.maximized??!1,isFocused:!0,zIndex:this.nextZIndex++};return this.windows.forEach(b=>b.isFocused=!1),this.windows.push(D),console.log(`[WindowManager] Opened window ${E} (${C})`,D),E}closeWindow(S){this.windows=this.windows.filter(C=>C.id!==S)}minimizeWindow(S){const C=this.windows.find(y=>y.id===S);C&&(C.isMinimized=!0,C.isFocused=!1)}restoreWindow(S){const C=this.windows.find(y=>y.id===S);C&&(C.isMinimized=!1,this.focusWindow(S))}maximizeWindow(S){const C=this.windows.find(y=>y.id===S);C&&(C.isMaximized=!0,C.isMinimized=!1,this.focusWindow(S))}unmaximizeWindow(S){const C=this.windows.find(y=>y.id===S);C&&(C.isMaximized=!1,this.focusWindow(S))}toggleMaximize(S){const C=this.windows.find(y=>y.id===S);C&&(C.isMaximized?this.unmaximizeWindow(S):this.maximizeWindow(S))}toggleMinimize(S){const C=this.windows.find(y=>y.id===S);C&&(C.isMinimized?this.restoreWindow(S):C.isFocused?this.minimizeWindow(S):this.focusWindow(S))}focusWindow(S){const C=this.windows.find(y=>y.id===S);if(C){if(C.isFocused&&!C.isMinimized&&C.zIndex===this.nextZIndex-1)return;this.windows.forEach(y=>y.isFocused=!1),C.isFocused=!0,C.isMinimized=!1,C.zIndex=this.nextZIndex++}}getWindow(S){return this.windows.find(C=>C.id===S)}}function jr(){const k=new zr;return Me(Xt,k),k}function Ge(){return We(Xt)}const Yt=Symbol("KERNEL");class Kr{#e=se(!0);get isBooting(){return F(this.#e)}set isBooting(S){Z(this.#e,S,!0)}#t=se(!1);get isShuttingDown(){return F(this.#t)}set isShuttingDown(S){Z(this.#t,S,!0)}#i=se(!1);get isFontLoaded(){return F(this.#i)}set isFontLoaded(S){Z(this.#i,S,!0)}windowManager;fileSystem;theme;constructor(){this.windowManager=jr(),this.fileSystem=ji(),this.theme=Vi(),this.loadFont()}async loadFont(){if(typeof window>"u"||!("fonts"in document)){this.isFontLoaded=!0;return}try{await document.fonts.load('400 1em "0xProto Nerd Font Mono"'),this.isFontLoaded=!0}catch(S){console.error("Failed to load font:",S),setTimeout(()=>{this.isFontLoaded=!0},2e3)}}finishBoot(){this.isBooting=!1}reboot(){this.isBooting=!0,setTimeout(()=>this.finishBoot(),3e3)}shutdown(){this.isShuttingDown=!0}}function qr(){const k=new Kr;return Me(Yt,k),k}function Jt(){return We(Yt)}const Zt=` ██████╗  █████╗ ███████╗████████╗ ██████╗ ███╗   ██╗ ██████╗ ███████╗
██╔════╝ ██╔══██╗██╔════╝╚══██╔══╝██╔═══██╗████╗  ██║██╔═══██╗██╔════╝
██║  ███╗███████║███████╗   ██║   ██║   ██║██╔██╗ ██║██║   ██║███████╗
██║   ██║██╔══██║╚════██║   ██║   ██║   ██║██║╚██╗██║██║   ██║╚════██║
╚██████╔╝██║  ██║███████║   ██║   ╚██████╔╝██║ ╚████║╚██████╔╝███████║
 ╚═════╝ ╚═╝  ╚═╝╚══════╝   ╚═╝    ╚═════╝ ╚═╝  ╚═══╝ ╚═════╝ ╚══════╝`;var Vr=le('<div class="animate-pulse text-sm"><span class="text-green-500">[ OK ]</span> </div>'),Gr=le('<div class="fixed inset-0 z-50 flex items-center justify-center bg-black font-mono text-green-400"><div class="w-full max-w-4xl px-8"><div class="mb-12"><pre class="mb-6 text-center text-xs leading-tight text-green-500 sm:text-sm md:text-base lg:text-lg"> </pre> <div class="mb-2 text-center text-sm text-green-400">GastonOS v2.0 - Virtual Terminal System</div> <div class="text-center text-xs text-gray-500">Copyright © 2025 Gaston Silva. All rights reserved.</div></div> <div class="min-h-[200px] space-y-2"></div> <div class="mt-8"><div class="mb-2 flex items-center gap-2"><span class="text-sm">Loading:</span> <div class="h-2 flex-1 overflow-hidden rounded bg-gray-800"><div class="h-full bg-green-500 transition-all duration-300"></div></div> <span class="w-12 text-right text-sm"> </span></div></div></div></div>');function Xr(k,S){ge(S,!0);const C=Jt();let y=se(0),E=se(""),D=se(!1);const b=["BIOS v1.0.0 - Initializing hardware...","CPU: Intel Core i9-13900K @ 3.00GHz","Memory: 32768MB OK","Disk: 1TB NVMe SSD detected","Loading fonts...","Loading bootloader...","Starting GastonOS v2.0...","Initializing kernel modules...","Mounting file systems...","Starting network services...","Loading terminal emulator...","Configuring user environment...","System initialization complete."];ht(()=>{C.isFontLoaded&&!F(D)&&Z(D,!0)}),$e(()=>{let r=0,h,_=1500;const p=()=>{if(r<b.length)if(Z(E,b[r],!0),r++,r>=b.length)setTimeout(()=>{S.onComplete()},800);else{const u=r<5?500+Math.random()*400:300+Math.random()*300;setTimeout(p,u)}};h=setInterval(()=>{F(y)<100&&(Z(y,F(y)+Math.random()*8),F(y)>100&&Z(y,100))},250);const g=()=>{F(D)?setTimeout(p,_):setTimeout(g,100)};return g(),()=>{clearInterval(h)}});var i=Gr(),n=X(i),a=X(n),l=X(a),o=X(l,!0);G(l),He(4),G(a);var c=ee(a,2);Ue(c,21,()=>b,dt,(r,h,_)=>{var p=be(),g=ye(p);{var u=m=>{var B=Vr(),A=ee(X(B));G(B),_e(()=>he(A,` ${F(h)??""}`)),ie(m,B)};de(g,m=>{_<=b.indexOf(F(E))&&m(u)})}ie(r,p)}),G(c);var f=ee(c,2),v=X(f),d=ee(X(v),2),t=X(d);G(d);var s=ee(d,2),e=X(s);G(s),G(v),G(f),G(n),G(i),_e(r=>{he(o,Zt),ut(t,`width: ${F(y)??""}%`),he(e,`${r??""}%`)},[()=>Math.floor(F(y))]),ie(k,i),me()}var Yr=le('<div class="animate-pulse text-sm"><span class="text-green-500">[ OK ]</span> </div>'),Jr=le('<div class="fixed inset-0 z-50 flex items-center justify-center bg-black font-mono text-green-400"><div class="w-full max-w-4xl px-8"><div class="mb-12"><pre class="mb-6 text-center text-xs leading-tight text-green-500 sm:text-sm md:text-base lg:text-lg"> </pre> <div class="mb-2 text-center text-sm text-green-400">GastonOS v2.0 - Shutting Down</div> <div class="text-center text-xs text-gray-500">Thank you for using GastonOS. See you next time!</div></div> <div class="min-h-[200px] space-y-2"></div> <div class="mt-8"><div class="mb-2 flex items-center gap-2"><span class="text-sm">Progress:</span> <div class="h-2 flex-1 overflow-hidden rounded bg-gray-800"><div class="h-full bg-green-500 transition-all duration-300"></div></div> <span class="w-12 text-right text-sm"> </span></div></div></div></div>');function Zr(k,S){ge(S,!0);let C=se(0),y=se("");const E=["Saving user session...","Closing applications...","Unmounting file systems...","Stopping network services...","Stopping kernel modules...","Shutting down system...","System halted."];$e(()=>{let s=0,e;const r=()=>{if(s<E.length)if(Z(y,E[s],!0),s++,s<E.length){const h=300+Math.random()*400;setTimeout(r,h)}else setTimeout(()=>{document.body.style.transition="opacity 2s",document.body.style.opacity="0"},1e3)};return e=setInterval(()=>{F(C)<100&&(Z(C,F(C)+Math.random()*12),F(C)>100&&Z(C,100))},200),setTimeout(r,500),()=>{clearInterval(e)}});var D=Jr(),b=X(D),i=X(b),n=X(i),a=X(n,!0);G(n),He(4),G(i);var l=ee(i,2);Ue(l,21,()=>E,dt,(s,e,r)=>{var h=be(),_=ye(h);{var p=g=>{var u=Yr(),m=ee(X(u));G(u),_e(()=>he(m,` ${F(e)??""}`)),ie(g,u)};de(_,g=>{r<=E.indexOf(F(y))&&g(p)})}ie(s,h)}),G(l);var o=ee(l,2),c=X(o),f=ee(X(c),2),v=X(f);G(f);var d=ee(f,2),t=X(d);G(d),G(c),G(o),G(b),G(D),_e(s=>{he(a,Zt),ut(v,`width: ${F(C)??""}%`),he(t,`${s??""}%`)},[()=>Math.floor(F(C))]),ie(k,D),me()}function Qr(k,S){ge(S,!0);const C=qr();var y=be(),E=ye(y);{var D=i=>{Zr(i,{})},b=i=>{var n=be(),a=ye(n);{var l=c=>{Xr(c,{onComplete:()=>C.finishBoot()})},o=c=>{var f=be(),v=ye(f);ct(v,()=>S.children),ie(c,f)};de(a,c=>{C.isBooting?c(l):c(o,!1)},!0)}ie(i,n)};de(E,i=>{C.isShuttingDown?i(D):i(b,!1)})}ie(k,y),me()}var es=Ne("<rect></rect>"),ts=Ne("<path></path>"),is=Ne('<svg fill="none" stroke="currentColor"></svg>');function Re(k,S){ge(S,!0);let C=At(S,"class",3,"h-5 w-5");var y=is();Ue(y,21,()=>S.icon.paths,dt,(E,D)=>{var b=be(),i=ye(b);{var n=l=>{var o=es();_e(()=>{fe(o,"x",F(D).x),fe(o,"y",F(D).y),fe(o,"width",F(D).width),fe(o,"height",F(D).height),fe(o,"rx",F(D).rx),fe(o,"stroke-width",F(D).strokeWidth)}),ie(l,o)},a=l=>{var o=ts();_e(()=>{fe(o,"d",F(D).d),fe(o,"stroke-linecap",F(D).strokeLinecap),fe(o,"stroke-linejoin",F(D).strokeLinejoin),fe(o,"stroke-width",F(D).strokeWidth)}),ie(l,o)};de(i,l=>{F(D).element==="rect"?l(n):l(a,!1)})}ie(E,b)}),G(y),_e(()=>{Fe(y,0,Ai(C())),fe(y,"viewBox",S.icon.viewBox)}),ie(k,y),me()}function rs(k={}){const S=k.minWidth??400,C=k.minHeight??300;let y=se(Le(k.initialWidth??800)),E=se(Le(k.initialHeight??600)),D=se(!1),b=0,i=0,n=0,a=0,l=null,o=null;function c(_){l=_}function f(_){_.button===0&&(Z(D,!0),b=_.clientX,i=_.clientY,n=F(y),a=F(E),document.addEventListener("mousemove",v),document.addEventListener("mouseup",d),document.addEventListener("keydown",t),_.preventDefault())}function v(_){if(!F(D))return;const p=_.clientX-b,g=_.clientY-i;let u=n+p,m=a+g;u=Math.max(S,u),m=Math.max(C,m),k.maxWidth&&(u=Math.min(u,k.maxWidth())),k.maxHeight&&(m=Math.min(m,k.maxHeight())),Z(y,u,!0),Z(E,m,!0)}function d(){F(D)&&(Z(D,!1),e(),h())}function t(_){_.key==="Escape"&&s()}function s(){F(D)&&(Z(y,n,!0),Z(E,a,!0),Z(D,!1),e(),h())}function e(){document.removeEventListener("mousemove",v),document.removeEventListener("mouseup",d),document.removeEventListener("keydown",t)}function r(){o&&clearTimeout(o),o=setTimeout(()=>{h()},150)}function h(){l&&setTimeout(()=>{l?.fit()},0)}return{get width(){return F(y)},get height(){return F(E)},get isResizing(){return F(D)},handleResizeStart:f,handleBrowserResize:r,setFitAddon:c,triggerFit:h}}function ss(k={}){let S=se(Le(k.initialX??0)),C=se(Le(k.initialY??0)),y=se(!1),E=0,D=0,b=0,i=0,n=0,a=0,l=0,o=0;function c(d,t){if(d.button===0){if(t){const s=t.getBoundingClientRect();if(l=s.width,o=s.height,k.boundarySelector){const e=document.querySelector(k.boundarySelector);if(e){const r=e.getBoundingClientRect();n=r.width,a=r.height}else n=window.innerWidth,a=window.innerHeight}else n=window.innerWidth,a=window.innerHeight}Z(y,!0),E=d.clientX,D=d.clientY,b=F(S),i=F(C),document.addEventListener("mousemove",f),document.addEventListener("mouseup",v)}}function f(d){if(!F(y))return;const t=d.clientX-E,s=d.clientY-D;let e=b+t,r=i+s;if(n&&l){const h=n-l,_=a-o;e=Math.max(0,Math.min(e,h)),r=Math.max(0,Math.min(r,_))}Z(S,e,!0),Z(C,r,!0)}function v(){Z(y,!1),document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",v)}return{get x(){return F(S)},get y(){return F(C)},get isDragging(){return F(y)},handleDragStart:c,setPosition:(d,t)=>{Z(S,d,!0),Z(C,t,!0)}}}var ns=le('<div class="h-4 w-4 rounded-full bg-gray-500"></div>'),os=Ne('<svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><rect x="6" y="6" width="10" height="10" rx="1" stroke-width="2"></rect><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6V4h10v10h-2"></path></svg>'),as=Ne('<svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"></path></svg>'),hs=le('<button type="button" class="absolute right-0 bottom-0 z-50 h-4 w-4 cursor-nwse-resize border-0 bg-transparent p-0" aria-label="Resize window"><svg class="h-full w-full text-gray-500 opacity-50 transition-opacity hover:opacity-100" viewBox="0 0 16 16" fill="currentColor"><path d="M14 14L14 10L16 10L16 16L10 16L10 14L14 14Z"></path><path d="M9 14L9 12L11 12L11 16L7 16L7 14L9 14Z"></path><path d="M14 9L14 7L16 7L16 11L12 11L12 9L14 9Z"></path></svg></button>'),ls=le('<div role="button" tabindex="-1"><div role="button" tabindex="-1"><div class="flex items-center gap-3"><!> <span class="text-sm font-medium text-gray-200"> </span></div> <div class="flex items-center gap-2" role="group" aria-label="Window controls"><button class="flex h-6 w-6 items-center justify-center rounded text-gray-400 transition-colors hover:bg-yellow-500 hover:text-white" aria-label="Minimize"><svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"></path></svg></button> <button class="flex h-6 w-6 items-center justify-center rounded text-gray-400 transition-colors hover:bg-green-600 hover:text-white"><!></button> <button class="flex h-6 w-6 items-center justify-center rounded text-gray-400 transition-colors hover:bg-red-600 hover:text-white" aria-label="Close"><svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div></div> <div class="flex-1 overflow-hidden bg-black"><!></div> <!></div>');function cs(k,S){ge(S,!0);let C=At(S,"title",3,"Application");const y=Ge(),E=De(()=>y.getWindow(S.id)),D=De(()=>F(E)?_t(F(E).appId):void 0),b=ss({initialX:100+Math.random()*50,initialY:100+Math.random()*50}),i=rs({minWidth:400,minHeight:300,initialWidth:800,initialHeight:600,maxWidth:()=>window.innerWidth-b.x,maxHeight:()=>window.innerHeight-b.y});ht(()=>{S.terminal?.fitAddon&&(i.setFitAddon(S.terminal.fitAddon),i.triggerFit())}),ht(()=>{F(E)?.isMaximized,i.triggerFit()});function n(){y.minimizeWindow(S.id)}function a(){y.toggleMaximize(S.id)}function l(){y.closeWindow(S.id)}function o(){y.focusWindow(S.id)}var c=be();Bt("resize",Rt,function(...d){i.handleBrowserResize?.apply(this,d)});var f=ye(c);{var v=d=>{var t=ls();let s;t.__mousedown=o;var e=X(t);let r;e.__mousedown=R=>!F(E).isMaximized&&b.handleDragStart(R,R.currentTarget.parentElement),e.__dblclick=a;var h=X(e),_=X(h);{var p=R=>{Re(R,{get icon(){return F(D).icon},class:"h-4 w-4 text-gray-400"})},g=R=>{var I=ns();ie(R,I)};de(_,R=>{F(D)?R(p):R(g,!1)})}var u=ee(_,2),m=X(u,!0);G(u),G(h);var B=ee(h,2),A=X(B);A.__click=n,A.__mousedown=R=>R.stopPropagation();var O=ee(A,2);O.__click=a,O.__mousedown=R=>R.stopPropagation();var L=X(O);{var T=R=>{var I=os();ie(R,I)},H=R=>{var I=as();ie(R,I)};de(L,R=>{F(E).isMaximized?R(T):R(H,!1)})}G(O);var $=ee(O,2);$.__click=l,$.__mousedown=R=>R.stopPropagation(),G(B),G(e);var j=ee(e,2),U=X(j);ct(U,()=>S.children??Ci),G(j);var w=ee(j,2);{var M=R=>{var I=hs();I.__mousedown=function(...W){i.handleResizeStart?.apply(this,W)},ie(R,I)};de(w,R=>{F(E).isMaximized||R(M)})}G(t),_e(()=>{s=Fe(t,1,"absolute flex flex-col overflow-hidden rounded-lg border border-gray-700 bg-gray-900 shadow-2xl",null,s,{"cursor-nw-resize":!F(E).isMaximized&&i.isResizing}),ut(t,F(E).isMaximized?`left: 0; top: 0; right: 0; bottom: 0; width: auto; height: auto; z-index: ${F(E).zIndex}; border-radius: 0; border: none;`:`left: ${b.x}px; top: ${b.y}px; width: ${i.width}px; height: ${i.height}px; z-index: ${F(E).zIndex};`),r=Fe(e,1,"flex items-center justify-between border-b border-gray-600 bg-gray-800 px-4 py-2 select-none",null,r,{"bg-gray-700":F(E).isFocused,"bg-gray-800":!F(E).isFocused,"cursor-move":!F(E).isMaximized}),he(m,C()),fe(O,"aria-label",F(E).isMaximized?"Restore":"Maximize")}),ie(d,t)};de(f,d=>{F(E)&&!F(E).isMinimized&&d(v)})}ie(k,c),me()}Ve(["mousedown","dblclick","click"]);function ds(k,S){ge(S,!0);const C=Ge(),y=De(()=>C.getWindow(S.windowId)),E=De(()=>F(y)?_t(F(y).appId):void 0),D=De(()=>F(y)?.appId==="terminal"?Ft():void 0);var b=be(),i=ye(b);{var n=a=>{const l=De(()=>F(E).component);cs(a,{get id(){return S.windowId},get title(){return F(y).title},get terminal(){return F(D)},children:(o,c)=>{var f=be(),v=ye(f);Ei(v,()=>F(l),(d,t)=>{t(d,{})}),ie(o,f)},$$slots:{default:!0}})};de(i,a=>{F(y)&&F(E)&&a(n)})}ie(k,b),me()}var us=le('<div class="absolute bottom-full left-0 mb-2 w-48 overflow-hidden rounded-lg border border-gray-600 bg-gray-800 shadow-2xl" role="menu" tabindex="-1"><button class="flex w-full items-center gap-3 px-4 py-3 text-left text-sm text-gray-300 transition-colors hover:bg-gray-700 hover:text-white" role="menuitem"><!> <span>About</span></button> <div class="border-t border-gray-700"></div> <button class="flex w-full items-center gap-3 px-4 py-3 text-left text-sm text-gray-300 transition-colors hover:bg-red-600 hover:text-white" role="menuitem"><!> <span>Power Off</span></button></div>'),fs=le('<div class="h-4 w-4 rounded-full bg-gray-500"></div>'),_s=le('<button><!> <span class="truncate font-medium"> </span></button>'),ps=le('<div class="absolute right-0 bottom-0 left-0 z-9999 flex h-10 items-center gap-1 border-t border-gray-700 bg-gray-800 px-2"><div class="relative"><button aria-label="Start Menu"><!></button> <!></div> <div class="mx-1 h-6 w-px bg-gray-700"></div> <!> <div class="flex-1"></div> <div class="px-3 font-mono text-xs text-gray-400"> </div></div>');function vs(k,S){ge(S,!0);const C=Ge(),y=Jt();let E=se(!1);function D(){Z(E,!F(E))}function b(){Z(E,!1)}function i(){C.openWindow("about","About GastonOS"),b()}function n(){y.shutdown(),b()}var a=ps();Bt("click",Rt,b);var l=X(a),o=X(l);let c;o.__click=r=>{r.stopPropagation(),D()};var f=X(o);Re(f,{get icon(){return Ti}}),G(o);var v=ee(o,2);{var d=r=>{var h=us();h.__click=m=>m.stopPropagation(),h.__keydown=m=>m.stopPropagation();var _=X(h);_.__click=i;var p=X(_);Re(p,{get icon(){return It}}),He(2),G(_);var g=ee(_,4);g.__click=n;var u=X(g);Re(u,{get icon(){return Oi}}),He(2),G(g),G(h),ie(r,h)};de(v,r=>{F(E)&&r(d)})}G(l);var t=ee(l,4);Ue(t,17,()=>C.windows,r=>r.id,(r,h)=>{const _=De(()=>_t(F(h).appId));var p=_s();let g;p.__click=()=>C.toggleMinimize(F(h).id);var u=X(p);{var m=L=>{Re(L,{get icon(){return F(_).icon},class:"h-4 w-4 min-w-4"})},B=L=>{var T=fs();ie(L,T)};de(u,L=>{F(_)?L(m):L(B,!1)})}var A=ee(u,2),O=X(A,!0);G(A),G(p),_e(()=>{g=Fe(p,1,"flex max-w-[200px] items-center gap-2 overflow-hidden rounded border px-3 py-1 text-sm transition-all duration-150 select-none",null,g,{"bg-gray-700":F(h).isFocused&&!F(h).isMinimized,"border-gray-600":F(h).isFocused&&!F(h).isMinimized,"text-gray-100":F(h).isFocused&&!F(h).isMinimized,"bg-gray-800":!F(h).isFocused||F(h).isMinimized,"border-transparent":!F(h).isFocused||F(h).isMinimized,"text-gray-400":!F(h).isFocused||F(h).isMinimized,"hover:bg-gray-700":!F(h).isFocused,"hover:text-gray-200":!F(h).isFocused}),he(O,F(h).title)}),ie(r,p)});var s=ee(t,4),e=X(s,!0);G(s),G(a),_e(r=>{c=Fe(o,1,"rounded px-3 py-1 text-gray-300 transition-colors hover:bg-gray-700 hover:text-white",null,c,{"bg-gray-700":F(E),"text-white":F(E)}),he(e,r)},[()=>new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]),ie(k,a),me()}Ve(["click","keydown"]);var gs=le('<div class="h-10 w-10 rounded bg-gray-500"></div>'),ms=le('<button class="group flex w-24 flex-col items-center gap-1 rounded p-2 transition-colors outline-none hover:bg-white/10 focus:bg-white/20"><div class="flex h-12 w-12 items-center justify-center text-gray-200 drop-shadow-lg transition-transform group-active:scale-95"><!></div> <span class="w-full truncate text-center text-xs font-medium text-white drop-shadow-md select-none"> </span></button>');function Ss(k,S){var C=ms();C.__dblclick=function(...a){S.ondblclick?.apply(this,a)};var y=X(C),E=X(y);{var D=a=>{var l=be(),o=ye(l);ct(o,()=>S.icon),ie(a,l)},b=a=>{var l=gs();ie(a,l)};de(E,a=>{S.icon?a(D):a(b,!1)})}G(y);var i=ee(y,2),n=X(i,!0);G(i),G(C),_e(()=>he(n,S.title)),ie(k,C)}Ve(["dblclick"]);var ws=le('<div class="pointer-events-auto contents"><!></div>'),Cs=le('<div class="relative h-full w-full overflow-hidden bg-gray-900 select-none" role="region" aria-label="Desktop Environment"><div class="pointer-events-none absolute inset-0 bg-[radial-gradient(circle_at_center,var(--tw-gradient-stops))] from-gray-700 via-gray-900 to-black opacity-20"></div>  <div class="absolute top-0 bottom-10 left-0 z-1 flex flex-col flex-wrap content-start items-start gap-4 p-4"><!></div> <div class="pointer-events-none absolute inset-0 bottom-10 z-10"></div> <!></div>');function bs(k,S){ge(S,!1);const C=Ge();function y(a){console.log("[Desktop] Opening terminal with options:",a),C.openWindow("terminal","Terminal",a)}$e(()=>{console.log("[Desktop] Mounted. Windows count:",C.windows.length),C.windows.length===0&&setTimeout(()=>{console.log("[Desktop] Opening default maximized terminal"),y({initialState:{maximized:!0}})},50)}),lt();var E=Cs();E.__contextmenu=a=>a.preventDefault();var D=ee(X(E),2);{const a=l=>{Re(l,{get icon(){return Ot},class:"h-full w-full text-gray-300"})};var b=X(D);Ss(b,{title:"Terminal",ondblclick:()=>y(),get icon(){return a}}),G(D)}var i=ee(D,2);Ue(i,5,()=>C.windows,a=>a.id,(a,l)=>{var o=ws(),c=X(o);ds(c,{get windowId(){return F(l).id}}),G(o),ie(a,o)}),G(i);var n=ee(i,2);vs(n,{}),G(E),ie(k,E),me()}Ve(["contextmenu"]);function Ms(k){Qr(k,{children:(S,C)=>{bs(S,{})},$$slots:{default:!0}})}export{Ms as component};
